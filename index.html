<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCCABET - Casa de Apostas Virtual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating-notification {
            animation: float 3s ease-in-out infinite;
        }
        .cell {
            transition: all 0.3s ease;
        }
        .cell:hover {
            transform: scale(1.05);
        }
        .logo-text::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #facc15, transparent);
            animation: bleed 2s infinite;
        }
        @keyframes bleed {
            0% { opacity: 0; transform: scaleX(0); }
            50% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0; transform: scaleX(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .animate-pulse {
            animation: pulse 0.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        #av-plane {
            transition: transform 0.1s ease-out;
            z-index: 10;
            will-change: transform;
        }
        #av-trail {
            transition: 
                width 0.1s ease-out,
                background-color 0.3s ease;
            z-index: 5;
        }
        .welcome-bg {
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1518895949257-7621c3c786d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1489&q=80');
            background-size: cover;
            background-position: center;
        }
        .slot-reel {
            min-width: 64px;
            min-height: 80px;
        }
        .card {
            min-width: 60px;
            min-height: 90px;
        }

        /* --- ESTILOS ATUALIZADOS DA ROLETA --- */
        .roulette-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 280px;
            height: 280px;
            margin: 1rem auto;
        }
        .roulette-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 20px solid #22c55e; /* green-500 */
            z-index: 10;
        }
        .roulette-wheel {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 8px solid #4a5568; /* gray-700 */
            background-color: #1a202c; /* gray-900 */
            transition: transform 5s ease-out;
        }
        .roulette-wheel .wheel-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 0;
            top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        .roulette-center {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #2d3748; /* gray-800 */
            border-radius: 50%;
            border: 5px solid #718096; /* gray-600 */
            z-index: 5;
        }

        @media (max-width: 640px) {
            .roulette-container {
                width: 220px;
                height: 220px;
            }
            .roulette-wheel {
                width: 200px;
                height: 200px;
            }
            #receipt-modal.fullscreen-mobile .receipt-content {
                max-width: 100%;
                height: 100%;
                border-radius: 0;
                border: none;
            }
            #receipt-modal.fullscreen-mobile .receipt-content h3 {
                font-size: 1.5rem;
            }
            #receipt-modal.fullscreen-mobile .receipt-content .receipt-item, 
            #receipt-modal.fullscreen-mobile .receipt-content .receipt-actions button {
                font-size: 1rem;
            }
        }

        /* Efeito de piscar o saldo */
        @keyframes balance-flash {
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .balance-updated-win {
            animation: balance-flash 0.5s ease-in-out;
            color: #22c55e; /* green-500 */
        }
        .balance-updated-loss {
            animation: balance-flash 0.5s ease-in-out;
            color: #ef4444; /* red-500 */
        }
        
        /* --- ESTILOS ADICIONAIS PARA NOVO LOGIN --- */
        .form-group {
            position: relative;
        }
        .error-message {
            color: #ef4444; /* red-500 */
            font-size: 0.75rem;
            position: absolute;
            bottom: -18px;
            left: 0;
            display: none;
        }
        input.invalid {
            border-color: #ef4444;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* --- ESTILOS DO PAINEL ADMIN E DONO --- */
        .admin-panel-container {
            transition: opacity 0.3s ease-in-out;
        }
        .admin-panel-content {
            max-height: 90vh;
            animation: slide-up 0.4s ease-out;
        }
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen font-sans">

    <div id="login-screen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-900 p-6 sm:p-8 rounded-xl shadow-2xl border border-blue-500 max-w-md w-full">
            <div class="flex justify-center items-center mb-6">
                <span class="text-3xl font-bold logo-text relative">LUCCA<span class="text-yellow-400">BET</span></span>
            </div>
             <div id="auth-error-message" class="hidden bg-red-900 border border-red-700 text-red-300 px-4 py-2 rounded-lg text-center text-sm mb-4"></div>

            <form id="login-form" class="space-y-4">
                <h2 class="text-xl font-bold text-center text-white mb-4">Acessar Conta</h2>
                <div class="form-group">
                    <label for="login-identifier" class="block text-sm font-medium mb-1">E-mail ou Nome de Usuário</label>
                    <input type="text" id="login-identifier" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                <div class="form-group">
                    <label for="login-password" class="block text-sm font-medium mb-1">Senha</label>
                    <input type="password" id="login-password" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-lg transition duration-300">
                    Entrar
                </button>
                <div class="text-center text-sm">
                    <span class="text-gray-400">Não tem uma conta?</span>
                    <button type="button" id="show-register" class="text-yellow-400 hover:text-yellow-300 ml-1 font-semibold">Cadastre-se</button>
                </div>
            </form>
            
            <form id="register-form" class="hidden space-y-4">
                 <h2 class="text-xl font-bold text-center text-white mb-4">Criar Nova Conta</h2>
                <div class="form-group">
                    <label for="reg-fullname" class="block text-sm font-medium mb-1">Nome Completo</label>
                    <input type="text" id="reg-fullname" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    <div class="error-message">Campo obrigatório.</div>
                </div>
                <div class="form-group">
                    <label for="reg-username" class="block text-sm font-medium mb-1">Nome de Usuário</label>
                    <input type="text" id="reg-username" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    <div class="error-message">Nome de usuário inválido.</div>
                </div>
                <div class="form-group">
                    <label for="reg-email" class="block text-sm font-medium mb-1">E-mail</label>
                    <input type="email" id="reg-email" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                     <div class="error-message">E-mail inválido.</div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="reg-birthdate" class="block text-sm font-medium mb-1">Data de Nascimento</label>
                        <input type="date" id="reg-birthdate" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                         <div class="error-message">Você deve ter +18 anos.</div>
                    </div>
                    <div class="form-group">
                        <label for="reg-password" class="block text-sm font-medium mb-1">Senha</label>
                        <input type="password" id="reg-password" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500" required>
                        <div class="error-message">Mínimo 6 caracteres.</div>
                    </div>
                </div>
                 <div class="form-group flex items-center pt-2">
                    <input type="checkbox" id="reg-terms" class="h-4 w-4 bg-gray-700 border-gray-600 text-green-600 focus:ring-green-500 rounded" required>
                    <label for="reg-terms" class="ml-2 block text-sm text-gray-300">Eu li e aceito os <a href="#" class="text-yellow-400 hover:underline">Termos de Uso</a>.</label>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-lg transition duration-300">
                    Cadastrar
                </button>
                <div class="text-center text-sm">
                    <span class="text-gray-400">Já tem uma conta?</span>
                    <button type="button" id="show-login" class="text-yellow-400 hover:text-yellow-300 ml-1 font-semibold">Faça login</button>
                </div>
            </form>
        </div>
    </div>
    <div id="main-app" class="hidden">
        <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center">
                    <span class="text-2xl font-bold ml-2 logo-text relative">LUCCA<span class="text-yellow-400">BET</span></span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="bg-gray-800 px-4 py-2 rounded-lg flex items-center">
                        <span class="text-gray-400 mr-2">Saldo:</span>
                        <span id="user-balance" class="font-bold text-green-500">CB$ 0,00</span>
                    </div>
                    <button id="deposit-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300">
                        Depositar
                    </button>
                    <button id="withdraw-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-300">
                        Saque
                    </button>
                    <div class="relative">
                        <div id="user-menu-btn" class="w-10 h-10 rounded-full cursor-pointer bg-gray-800 flex items-center justify-center text-2xl">💸</div>
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-700">
                            <a href="#" id="affiliate-link" class="block px-4 py-2 text-sm hover:bg-gray-700">Indique e Ganhe</a>
                            <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-700" onclick="alert('Histórico de apostas')">Histórico</a>
                            <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-700" onclick="alert('Configurações da conta')">Configurações</a>
                            <div class="border-t border-gray-700"></div>
                            <a href="#" id="logout-btn" class="block px-4 py-2 text-sm hover:bg-gray-700 text-yellow-400">Sair</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <nav class="bg-gray-900 border-b border-gray-800">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 overflow-x-auto">
                    <button id="home-tab" class="px-4 py-3 text-sm font-medium bg-gray-800 text-yellow-400">Início</button>
                    <button id="casino-tab" class="px-4 py-3 text-sm font-medium hover:bg-gray-800">Cassino</button>
                    <button id="games-tab" class="px-4 py-3 text-sm font-medium hover:bg-gray-800">Jogos</button>
                </div>
            </div>
        </nav>

        <main class="container mx-auto px-4 py-6">
            <div id="notifications-container" class="fixed top-20 right-4 space-y-2 z-30"></div>

            <div id="welcome-section" class="welcome-bg rounded-lg p-8 md:p-12 mb-8">
                <div class="max-w-3xl mx-auto text-center">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">Bem-vindo, <span id="welcome-username" class="text-yellow-400">Usuário</span>!</h1>
                    <p class="text-xl mb-6">Prepare-se para a melhor experiência de apostas online. Seu saldo atual: <span id="welcome-balance" class="font-bold text-green-500">CB$ 0,00</span></p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer">
                            <div class="text-yellow-400 text-3xl mb-2"><i class="fas fa-gamepad"></i></div>
                            <h3 class="font-bold mb-2">Jogos Incríveis</h3>
                            <p class="text-sm text-gray-300">Diversão e emoção em nossos jogos premium</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer">
                            <div class="text-yellow-400 text-3xl mb-2"><i class="fas fa-gem"></i></div>
                            <h3 class="font-bold mb-2">Bônus Diários</h3>
                            <p class="text-sm text-gray-300">Ganhe recompensas todos os dias</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer">
                            <div class="text-yellow-400 text-3xl mb-2"><i class="fas fa-shield-alt"></i></div>
                            <h3 class="font-bold mb-2">Segurança Total</h3>
                            <p class="text-sm text-gray-300">Seus dados e transações protegidos</p>
                        </div>
                    </div>
                    
                    <button id="start-playing-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full text-lg transition duration-300 transform hover:scale-105">
                        <i class="fas fa-play mr-2"></i> Começar a Jogar
                    </button>
                </div>
            </div>

            <div id="casino-section" class="hidden">
                 <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-dice mr-2 text-yellow-400"></i> Jogos de Cassino
                </h2>
                <!-- Conteúdo do Cassino aqui -->
            </div>

            <div id="games-section" class="hidden">
                <div class="mt-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-gamepad mr-2 text-yellow-400"></i> Campo Minado
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configuração da Partida</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo CB$1)</label>
                                    <input type="number" id="bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                
                                <div>
                                    <label for="mines-count" class="block text-sm font-medium mb-1">Número de minas (1-10)</label>
                                    <select id="mines-count" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                                        <option value="1">1 mina (1.10x)</option>
                                        <option value="2">2 minas (1.25x)</option>
                                        <option value="3" selected>3 minas (1.40x)</option>
                                        <option value="4">4 minas (1.60x)</option>
                                        <option value="5">5 minas (2.00x)</option>
                                        <option value="6">6 minas (2.50x)</option>
                                        <option value="7">7 minas (3.00x)</option>
                                        <option value="8">8 minas (3.50x)</option>
                                        <option value="9">9 minas (3.75x)</option>
                                        <option value="10">10 minas (4.00x)</option>
                                    </select>
                                </div>
                                
                                <div class="pt-2">
                                    <button id="start-game" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Iniciar Jogo
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status da Partida</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="current-bet" class="font-medium">CB$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Minas:</span>
                                        <span id="current-mines" class="font-medium">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Cliques seguros:</span>
                                        <span id="safe-clicks" class="font-medium">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Multiplicador:</span>
                                        <span id="current-multiplier" class="font-medium text-green-500">1.00x</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Ganho potencial:</span>
                                        <span id="potential-win" class="text-green-500">CB$ 0,00</span>
                                    </div>
                                </div>
                                
                                <button id="cash-out" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300 hidden">
                                    Retirar
                                </button>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold">Tabuleiro</h3>
                                    <div id="game-status" class="text-sm px-3 py-1 bg-gray-800 rounded-full">
                                        Aguardando início...
                                    </div>
                                </div>
                                
                                <div id="game-board" class="grid grid-cols-5 gap-2">
                                    <div class="text-center py-4 text-gray-600 col-span-5">
                                        Configure a partida e clique em "Iniciar Jogo"
                                    </div>
                                </div>
                                
                                <div class="mt-6 pt-4 border-t border-gray-800">
                                    <h3 class="text-lg font-bold mb-2">Como jogar</h3>
                                    <ul class="list-disc pl-5 space-y-1 text-sm text-gray-300">
                                        <li>Escolha o valor da aposta e o número de minas</li>
                                        <li>Clique em "Iniciar Jogo" para começar</li>
                                        <li>Clique nos blocos para revelá-los</li>
                                        <li>Cada bloco seguro aumenta seu multiplicador</li>
                                        <li>Se encontrar uma mina, você perde a aposta</li>
                                        <li>Clique em "Retirar" a qualquer momento para garantir seus ganhos</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-plane mr-2 text-yellow-400"></i> Aviador LUCCABET
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="av-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo CB$1)</label>
                                    <input type="number" id="av-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <button id="av-start-game" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                    Iniciar Voo
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="av-current-bet" class="font-medium">CB$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Multiplicador:</span>
                                        <span id="av-multiplier" class="font-medium text-green-500">1.00x</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Ganho:</span>
                                        <span id="av-potential-win" class="text-green-500">CB$ 0,00</span>
                                    </div>
                                </div>
                                
                                <button id="av-cash-out" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300 hidden">
                                    Retirar
                                </button>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800 h-full flex flex-col items-center justify-center">
                                <div id="av-game-area" class="relative w-full h-64 bg-gradient-to-b from-gray-900 to-black rounded-lg overflow-hidden">
                                    <div id="av-plane" class="absolute left-4 top-4 text-3xl transition-all duration-1000">
                                        ✈️
                                    </div>
                                    <div id="av-trail" class="absolute left-4 top-8 w-0 h-1 bg-yellow-400 transition-all duration-1000"></div>
                                </div>
                                <div class="mt-4 text-center">
                                    <div id="av-status" class="text-lg font-bold">Aguardando início...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-bolt mr-2 text-yellow-400"></i> Double Crash
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta Dupla</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="dc-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo CB$1)</label>
                                    <input type="number" id="dc-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <button id="dc-start-game" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                    Começar Rodada
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Controles</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <button id="dc-cashout1" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition duration-300 disabled:opacity-50" disabled>
                                            Retirar 1
                                        </button>
                                        <div id="dc-status1" class="text-center text-sm mt-2 text-gray-400">Aguardando</div>
                                    </div>
                                     <div>
                                        <button id="dc-cashout2" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded transition duration-300 disabled:opacity-50" disabled>
                                            Retirar 2
                                        </button>
                                        <div id="dc-status2" class="text-center text-sm mt-2 text-gray-400">Aguardando</div>
                                    </div>
                                </div>
                                <div class="mt-4 text-center">
                                    <span class="text-gray-400">Ganho Total:</span>
                                    <span id="dc-total-win" class="font-bold text-green-500">CB$ 0,00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800 h-full flex flex-col items-center justify-center relative">
                                <div class="absolute top-4 left-4 text-center">
                                    <div class="text-sm text-blue-400">Crash 1</div>
                                    <div id="dc-crashpoint1" class="text-xl font-bold text-blue-400">?.??x</div>
                                </div>
                                <div class="absolute top-4 right-4 text-center">
                                    <div class="text-sm text-purple-400">Crash 2</div>
                                    <div id="dc-crashpoint2" class="text-xl font-bold text-purple-400">?.??x</div>
                                </div>

                                <div id="dc-game-area" class="text-center">
                                     <div id="dc-multiplier" class="text-6xl font-bold text-yellow-400 transition-colors duration-300">1.00x</div>
                                     <div id="dc-game-status" class="text-lg font-bold mt-4">Aguardando início...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="affiliate-section" class="hidden mt-8">
                <h2 class="text-3xl font-bold mb-8 text-center text-yellow-400 flex items-center justify-center">
                    <i class="fas fa-users mr-3"></i>Indique e Ganhe
                </h2>
                <div class="max-w-4xl mx-auto bg-gray-900 rounded-lg border border-gray-800 p-6 md:p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="text-center md:text-left">
                            <h3 class="text-2xl font-bold mb-4">Convide seus amigos!</h3>
                            <p class="text-gray-400 mb-6">Compartilhe seu link exclusivo e ganhe bônus toda vez que um amigo se cadastrar e jogar.</p>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 mb-2">Seu link de afiliado:</p>
                                <div class="flex flex-col sm:flex-row items-center justify-between bg-black p-3 rounded">
                                    <span id="affiliate-user-link" class="font-mono text-sm break-all mb-2 sm:mb-0"></span>
                                    <button id="copy-affiliate-link" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300 w-full sm:w-auto">
                                        <i class="far fa-copy mr-2"></i>Copiar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h4 class="text-xl font-bold mb-4 text-center">Suas Estatísticas</h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center bg-gray-900 p-3 rounded-lg">
                                    <span class="text-gray-300"><i class="fas fa-user-check mr-2 text-blue-400"></i>Amigos Indicados:</span>
                                    <span id="friends-indicated" class="font-bold text-xl text-white">0</span>
                                </div>
                                <div class="flex justify-between items-center bg-gray-900 p-3 rounded-lg">
                                    <span class="text-gray-300"><i class="fas fa-dollar-sign mr-2 text-green-400"></i>Bônus Gerado:</span>
                                    <span id="bonus-generated" class="font-bold text-xl text-green-500">CB$ 0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="deposit-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                <div class="bg-gray-900 p-6 rounded-lg border border-blue-500 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Realizar Depósito</h3>
                        <button id="close-deposit-modal" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="deposit-amount" class="block text-sm font-medium mb-1">Valor do depósito (mínimo CB$10)</label>
                            <input type="number" id="deposit-amount" min="10" placeholder="10" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div id="pix-info-section" class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Código de Depósito (Fictício):</h4>
                            <div class="flex items-center justify-between bg-black p-3 rounded">
                                <span id="pix-key" class="font-mono">CODIGOLUCCA123</span>
                                <button id="copy-pix" class="text-yellow-400 hover:text-yellow-300">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">Envie o valor exato para este código. O saldo será creditado em alguns minutos.</p>
                        </div>
                        <button id="confirm-deposit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Confirmar Depósito
                        </button>
                    </div>
                </div>
            </div>

            <div id="withdraw-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                <div class="bg-gray-900 p-6 rounded-lg border border-blue-500 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Solicitar Saque</h3>
                        <button id="close-withdraw-modal" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="withdraw-amount" class="block text-sm font-medium mb-1">Valor do saque (mínimo CB$50)</label>
                            <input type="number" id="withdraw-amount" min="50" placeholder="50" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                            <p class="text-xs text-gray-400 mt-1">Seu saldo atual: <span id="withdraw-balance-info">CB$ 0,00</span></p>
                        </div>
                        <div>
                            <label for="withdraw-pix-key" class="block text-sm font-medium mb-1">Sua Chave de Saque</label>
                            <input type="text" id="withdraw-pix-key" placeholder="ex: seucodigo123" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <button id="confirm-withdraw" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Solicitar Saque
                        </button>
                        <p class="text-xs text-gray-500 text-center">As solicitações de saque são processadas em até 24 horas.</p>
                    </div>
                </div>
            </div>

            <div id="receipt-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
                <div class="receipt-content bg-gray-900 p-6 rounded-lg border border-blue-500 max-w-md w-full text-white">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-3">
                        <h3 class="text-xl font-bold">Comprovante de Transação</h3>
                        <button id="close-receipt-modal" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    <div id="receipt-details" class="space-y-3 text-sm">
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Tipo:</span>
                            <span id="receipt-type" class="font-bold"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Valor:</span>
                            <span id="receipt-amount" class="font-bold"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Status:</span>
                            <span id="receipt-status" class="font-bold"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Data e Hora:</span>
                            <span id="receipt-datetime" class="font-mono"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">ID da Transação:</span>
                            <span id="receipt-id" class="font-mono"></span>
                        </div>
                    </div>
                    <div class="receipt-actions mt-6 pt-4 border-t border-gray-700 flex flex-col sm:flex-row gap-2">
                        <button id="copy-receipt" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            <i class="far fa-copy mr-2"></i>Copiar Comprovante
                        </button>
                        <button id="close-receipt-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="text-lg font-bold mb-4 flex items-center logo-text relative">
                           LUCCA<span class="text-yellow-400">BET</span>
                        </h3>
                        <p class="text-sm text-gray-400">A casa de apostas mais divertida e recompensadora.</p>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Links Rápidos</h4>
                        <ul class="space-y-2 text-sm text-gray-400">
                            <li><a href="#" onclick="document.getElementById('home-tab').click(); return false;" class="hover:text-yellow-400">Início</a></li>
                            <li><a href="#" onclick="document.getElementById('casino-tab').click(); return false;" class="hover:text-yellow-400">Cassino</a></li>
                            <li><a href="#" onclick="document.getElementById('games-tab').click(); return false;" class="hover:text-yellow-400">Jogos</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Suporte</h4>
                        <ul class="space-y-2 text-sm text-gray-400">
                            <li><a href="#" class="hover:text-yellow-400">FAQ</a></li>
                            <li><a href="#" class="hover:text-yellow-400">Chat ao Vivo</a></li>
                            <li><a href="#" class="hover:text-yellow-400">Termos de Uso</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Segurança</h4>
                        <div class="flex space-x-4 mb-4">
                            <div class="w-12 h-8 bg-gray-800 rounded flex items-center justify-center">
                                <i class="fas fa-lock text-green-500"></i>
                            </div>
                            <div class="w-12 h-8 bg-gray-800 rounded flex items-center justify-center">
                                <i class="fas fa-shield-alt text-blue-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">Jogue com responsabilidade. Apenas para maiores de 18 anos.</p>
                    </div>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-6 text-sm text-gray-500 text-center">
                    <p>© 2024 LUCCABET. Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        // ================================================================== //
        // START: LÓGICA DO SISTEMA DE AUTENTICAÇÃO                         //
        // ================================================================== //
        
        // Simulação de banco de dados com localStorage
        const usersDB = {
            getUsers: () => {
                const users = localStorage.getItem('luccabet_users_v3');
                return users ? JSON.parse(users) : {};
            },
            saveUsers: (users) => {
                localStorage.setItem('luccabet_users_v3', JSON.stringify(users));
            },
            findUser: (identifier) => {
                const users = usersDB.getUsers();
                const lowerId = identifier.toLowerCase();
                return Object.values(users).find(u => u.email.toLowerCase() === lowerId || u.username.toLowerCase() === lowerId) || null;
            },
            createUser: (userData) => {
                const users = usersDB.getUsers();
                if (Object.values(users).some(u => u.email.toLowerCase() === userData.email.toLowerCase())) {
                    return { error: 'Este E-mail já está em uso.' };
                }
                if (Object.values(users).some(u => u.username.toLowerCase() === userData.username.toLowerCase())) {
                    return { error: 'Este Nome de Usuário já está em uso.' };
                }
                
                const userId = `user_${Date.now()}`;
                users[userId] = {
                    id: userId,
                    ...userData,
                    password: btoa(userData.password),
                    balance: 0,
                    createdAt: new Date().toISOString(),
                    stats: {}
                };
                
                usersDB.saveUsers(users);
                return { user: users[userId] };
            },
            updateUser: (userId, data) => {
                const users = usersDB.getUsers();
                if (!users[userId]) {
                    return { error: 'Usuário não encontrado' };
                }
                
                users[userId] = { ...users[userId], ...data };
                usersDB.saveUsers(users);
                return { user: users[userId] };
            }
        };

        let currentUser = null;

        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');
        
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');

        const authErrorMessage = document.getElementById('auth-error-message');

        const validateEmail = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

        const isOver18 = (birthdate) => {
            if (!birthdate) return false;
            const today = new Date();
            const birthDate = new Date(birthdate);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age >= 18;
        };
        
        const setFieldError = (input, message) => {
            const errorDiv = input.nextElementSibling;
            if (message) {
                input.classList.add('invalid');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            } else {
                input.classList.remove('invalid');
                errorDiv.style.display = 'none';
            }
        };
        const showAuthError = (message) => {
            authErrorMessage.textContent = message;
            authErrorMessage.classList.remove('hidden');
        }
        const hideAuthError = () => {
             authErrorMessage.classList.add('hidden');
        }

        const showAuthView = (view) => {
            hideAuthError();
            loginForm.classList.add('hidden');
            registerForm.classList.add('hidden');
            if (view === 'login') loginForm.classList.remove('hidden');
            if (view === 'register') registerForm.classList.remove('hidden');
        };

        showRegisterBtn.addEventListener('click', () => showAuthView('register'));
        showLoginBtn.addEventListener('click', () => showAuthView('login'));
        
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            hideAuthError();
            const identifier = document.getElementById('login-identifier').value.trim();
            const password = document.getElementById('login-password').value;

            const user = usersDB.findUser(identifier);
            if (!user) {
                return showAuthError('Usuário ou e-mail não encontrado.');
            }
            if (user.password !== btoa(password)) {
                 return showAuthError('Senha incorreta.');
            }
            
            startUserSession(user);
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            hideAuthError();
            let isValid = true;
            
            const fullNameInput = document.getElementById('reg-fullname');
            const usernameInput = document.getElementById('reg-username');
            const emailInput = document.getElementById('reg-email');
            const birthdateInput = document.getElementById('reg-birthdate');
            const passwordInput = document.getElementById('reg-password');
            const termsInput = document.getElementById('reg-terms');

            [fullNameInput, usernameInput, emailInput, birthdateInput, passwordInput].forEach(i => setFieldError(i, null));
            
            if (!fullNameInput.value.trim()) { setFieldError(fullNameInput, 'Nome completo é obrigatório.'); isValid = false; }
            if (!usernameInput.value.trim() || usernameInput.value.includes(' ')) { setFieldError(usernameInput, 'Nome de usuário inválido.'); isValid = false; }
            if (!validateEmail(emailInput.value)) { setFieldError(emailInput, 'Formato de e-mail inválido.'); isValid = false; }
            if (!isOver18(birthdateInput.value)) { setFieldError(birthdateInput, 'Você precisa ter mais de 18 anos.'); isValid = false; }
            if (passwordInput.value.length < 6) { setFieldError(passwordInput, 'A senha deve ter no mínimo 6 caracteres.'); isValid = false; }
            if (!termsInput.checked) { showAuthError('Você deve aceitar os Termos de Uso.'); isValid = false; }

            if (!isValid) return;

            const userData = {
                fullName: fullNameInput.value.trim(),
                username: usernameInput.value.trim(),
                email: emailInput.value.trim(),
                birthdate: birthdateInput.value,
                password: passwordInput.value,
            };
            
            const { user, error } = usersDB.createUser(userData);

            if (error) {
                return showAuthError(error);
            }
            
            showNotification('Cadastro realizado com sucesso! Bem-vindo!', 'green');
            startUserSession(user);
        });
        
        function startUserSession(user) {
            currentUser = user;
            localStorage.setItem('luccabet_current_user_v3', JSON.stringify(user));
            
            loginScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            updateUserData();
            startRandomNotifications();
            
            welcomeUsername.textContent = currentUser.username;
            homeTab.click();
        }

        function checkLoggedInUser() {
            const userData = localStorage.getItem('luccabet_current_user_v3');
            if (userData) {
                const user = JSON.parse(userData);
                const dbUser = usersDB.getUsers()[user.id];
                if (dbUser) {
                    startUserSession(dbUser);
                }
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('luccabet_current_user_v3');
            mainApp.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            
            loginForm.reset();
            registerForm.reset();
            showAuthView('login');
        }

        // ================================================================== //
        // END: LÓGICA DO SISTEMA DE AUTENTICAÇÃO                           //
        // ================================================================== //


        const betCooldowns = {};
        const BET_COOLDOWN_MS = 2000;
        
        const logoutBtn = document.getElementById('logout-btn');
        const userBalance = document.getElementById('user-balance');
        const welcomeUsername = document.getElementById('welcome-username');
        const welcomeBalance = document.getElementById('welcome-balance');
        const homeTab = document.getElementById('home-tab');
        const casinoTab = document.getElementById('casino-tab');
        const gamesTab = document.getElementById('games-tab');
        const affiliateLink = document.getElementById('affiliate-link');
        const welcomeSection = document.getElementById('welcome-section');
        const casinoSection = document.getElementById('casino-section');
        const gamesSection = document.getElementById('games-section');
        const affiliateSection = document.getElementById('affiliate-section'); 
        const startPlayingBtn = document.getElementById('start-playing-btn');

        function handleTabClick(activeTab, activeSection) {
            const tabs = [homeTab, casinoTab, gamesTab, affiliateLink];
            const sections = [welcomeSection, casinoSection, gamesSection, affiliateSection];

            tabs.forEach(tab => tab && tab.classList.remove('bg-gray-800', 'text-yellow-400'));
            sections.forEach(section => section.classList.add('hidden'));

            if(activeTab) activeTab.classList.add('bg-gray-800', 'text-yellow-400');
            activeSection.classList.remove('hidden');
        }
        
        affiliateLink.addEventListener('click', (e) => {
            e.preventDefault();
            handleTabClick(null, affiliateSection);
            document.getElementById('user-menu').classList.add('hidden');

            document.getElementById('affiliate-user-link').textContent = `https://luccabet.com/?ref=${currentUser.username.toUpperCase()}`;
            document.getElementById('friends-indicated').textContent = currentUser.stats.affiliates?.count || 0;
            document.getElementById('bonus-generated').textContent = `CB$ ${(currentUser.stats.affiliates?.bonus || 0).toFixed(2)}`;
        });

        homeTab.addEventListener('click', () => handleTabClick(homeTab, welcomeSection));
        casinoTab.addEventListener('click', () => handleTabClick(casinoTab, casinoSection));
        gamesTab.addEventListener('click', () => handleTabClick(gamesTab, gamesSection));

        startPlayingBtn.addEventListener('click', () => {
            gamesTab.click();
        });

        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            logout();
        });

        function updateUserData(isWin = null) {
            if (!currentUser) return;
            
            welcomeUsername.textContent = currentUser.username;
            const formattedBalance = `CB$ ${currentUser.balance.toFixed(2)}`;
            const balanceElements = [userBalance, welcomeBalance, document.getElementById('withdraw-balance-info')];

            balanceElements.forEach(el => {
                if(el) {
                    el.textContent = formattedBalance;
                    el.classList.remove('balance-updated-win', 'balance-updated-loss', 'text-green-500', 'text-red-500');
                    
                    if (isWin === true) {
                        el.classList.add('balance-updated-win');
                    } else if (isWin === false) {
                        el.classList.add('balance-updated-loss');
                    }
                    setTimeout(() => {
                        el.classList.remove('balance-updated-win', 'balance-updated-loss');
                        el.classList.add('text-green-500');
                    }, 500);
                }
            });
        }

        function updateUserBalance(newBalance, isWin = null) {
            if (!currentUser) return;
            
            currentUser.balance = newBalance;
            usersDB.updateUser(currentUser.id, { balance: newBalance });
            updateUserData(isWin);
        }

        const winMessages = [
            "Usuário 78*****654 ganhou CB$50.000 🔥",
            "Usuário 82*****121 faturou CB$12.700 🔥",
            "Usuário 23*****891 acertou CB$8.320 🔥",
        ];

        function startRandomNotifications() {
            setTimeout(() => {
                showRandomWinNotification();
                setInterval(showRandomWinNotification, Math.random() * 10000 + 10000);
            }, 5000);
        }

        function showRandomWinNotification() {
            const randomMessage = winMessages[Math.floor(Math.random() * winMessages.length)];
            showNotification(randomMessage, 'yellow');
        }

        function showNotification(message, color = 'blue', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `floating-notification bg-gray-900 border-l-4 border-${color}-500 px-4 py-2 rounded shadow-lg text-sm flex items-center`;
            notification.innerHTML = `<span class="mr-2">${message}</span>`;
            
            const notificationsContainer = document.getElementById('notifications-container');
            notificationsContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 1s';
                setTimeout(() => notification.remove(), 1000);
            }, duration);
        }

        // Aviator game logic
        let aviatorGame = { active: false, betAmount: 0, multiplier: 1.00, animationFrame: null, crashPoint: 0 };
        const avStartGameBtn = document.getElementById('av-start-game');
        const avCashOutBtn = document.getElementById('av-cash-out');
        // ... (other aviator elements) ...
        if(avStartGameBtn) avStartGameBtn.addEventListener('click', startAviator);
        if(avCashOutBtn) avCashOutBtn.addEventListener('click', cashOutAviator);
        
        function startAviator() {
            const gameName = 'Aviador LUCCABET';
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) return;

            const bet = parseFloat(document.getElementById('av-bet-amount').value);
            if (isNaN(bet) || bet < 1 || bet > currentUser.balance) {
                showNotification(bet > currentUser.balance ? 'Saldo insuficiente' : 'Aposta mínima CB$1.00', 'red');
                return;
            }
            
            betCooldowns[gameName] = Date.now();
            updateUserBalance(currentUser.balance - bet, false);
            
            aviatorGame = { active: true, betAmount: bet, multiplier: 1.00, crashPoint: 1 + Math.random() * 9, animationFrame: null };
            
            document.getElementById('av-start-game').classList.add('hidden');
            document.getElementById('av-cash-out').classList.remove('hidden');
            document.getElementById('av-cash-out').disabled = false;
            
            aviatorGame.animationFrame = requestAnimationFrame(updateAviatorGame);
        }

        function updateAviatorGame() {
            if (!aviatorGame.active) return;
            aviatorGame.multiplier += 0.01 + (aviatorGame.multiplier * 0.005);
            
            document.getElementById('av-multiplier').textContent = `${aviatorGame.multiplier.toFixed(2)}x`;
            document.getElementById('av-potential-win').textContent = `CB$ ${(aviatorGame.betAmount * aviatorGame.multiplier).toFixed(2)}`;
            
            if (aviatorGame.multiplier >= aviatorGame.crashPoint) {
                crashAviator();
                return;
            }
            aviatorGame.animationFrame = requestAnimationFrame(updateAviatorGame);
        }

        function crashAviator() {
            if (!aviatorGame.active) return;
            cancelAnimationFrame(aviatorGame.animationFrame);
            aviatorGame.active = false;
            
            document.getElementById('av-status').textContent = `Caiu em ${aviatorGame.crashPoint.toFixed(2)}x!`;
            showNotification(`O avião caiu!`, 'red');
            
            setTimeout(() => {
                document.getElementById('av-start-game').classList.remove('hidden');
                document.getElementById('av-cash-out').classList.add('hidden');
            }, 3000);
        }

        function cashOutAviator() {
            if (!aviatorGame.active) return;
            cancelAnimationFrame(aviatorGame.animationFrame);
            const winAmount = aviatorGame.betAmount * aviatorGame.multiplier;
            updateUserBalance(currentUser.balance + winAmount, true);
            
            aviatorGame.active = false;
            document.getElementById('av-cash-out').disabled = true;
            document.getElementById('av-status').textContent = `Retirado em ${aviatorGame.multiplier.toFixed(2)}x!`;
            showNotification(`Você ganhou CB$${winAmount.toFixed(2)}!`, 'green');

            setTimeout(() => {
                document.getElementById('av-start-game').classList.remove('hidden');
                document.getElementById('av-cash-out').classList.add('hidden');
            }, 3000);
        }

        // Mines Game Logic
        let minesGameState = { active: false, betAmount: 0, minesCount: 0, safeCellsClicked: 0, multiplier: 1, minesPositions: [], revealedCells: [] };
        if(document.getElementById('start-game')) document.getElementById('start-game').addEventListener('click', startGame);
        if(document.getElementById('cash-out')) document.getElementById('cash-out').addEventListener('click', () => cashOut(false));

        function startGame() {
            const gameName = 'Campo Minado';
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) return;

            const bet = parseFloat(document.getElementById('bet-amount').value);
            const mines = parseInt(document.getElementById('mines-count').value);
            if (isNaN(bet) || bet < 1 || bet > currentUser.balance) {
                showNotification(bet > currentUser.balance ? 'Saldo insuficiente' : 'Aposta mínima CB$1.00', 'red');
                return;
            }
            
            betCooldowns[gameName] = Date.now();
            updateUserBalance(currentUser.balance - bet, false);
            minesGameState = { active: true, betAmount: bet, minesCount: mines, safeCellsClicked: 0, multiplier: 1.0, minesPositions: [], revealedCells: [] };
            
            while (minesGameState.minesPositions.length < mines) {
                const randomPos = Math.floor(Math.random() * 25);
                if (!minesGameState.minesPositions.includes(randomPos)) minesGameState.minesPositions.push(randomPos);
            }
            
            document.getElementById('current-bet').textContent = `CB$ ${bet.toFixed(2)}`;
            document.getElementById('cash-out').classList.remove('hidden');
            renderGameBoard();
        }

        function renderGameBoard() {
            const gameBoard = document.getElementById('game-board');
            if(!gameBoard) return;
            gameBoard.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell bg-gray-800 h-16 rounded flex items-center justify-center cursor-pointer font-bold text-xl border border-gray-700 hover:bg-gray-700';
                cell.dataset.index = i;
                
                if (minesGameState.revealedCells.includes(i)) {
                     cell.innerHTML = minesGameState.minesPositions.includes(i) ? '<i class="fas fa-bomb text-red-500"></i>' : '💎';
                     cell.className = `cell h-16 rounded flex items-center justify-center font-bold text-xl border ${minesGameState.minesPositions.includes(i) ? 'bg-red-900 border-red-700' : 'bg-green-900 border-green-700'}`;
                } else if (minesGameState.active) {
                    cell.addEventListener('click', () => revealCell(i));
                }
                gameBoard.appendChild(cell);
            }
        }

        function revealCell(index) {
            if (!minesGameState.active || minesGameState.revealedCells.includes(index)) return;
            minesGameState.revealedCells.push(index);
            
            if (minesGameState.minesPositions.includes(index)) {
                minesGameState.active = false;
                showNotification('Você encontrou uma mina!', 'red');
                document.getElementById('cash-out').classList.add('hidden');
                renderGameBoard();
            } else {
                minesGameState.safeCellsClicked++;
                minesGameState.multiplier += 0.05 * minesGameState.minesCount;
                document.getElementById('potential-win').textContent = `CB$ ${(minesGameState.betAmount * minesGameState.multiplier).toFixed(2)}`;
                renderGameBoard();
            }
        }

        function cashOut() {
            if (!minesGameState.active) return;
            const winAmount = minesGameState.betAmount * minesGameState.multiplier;
            updateUserBalance(currentUser.balance + winAmount, true);
            minesGameState.active = false;
            showNotification(`Você retirou CB$${winAmount.toFixed(2)}`, 'green');
            document.getElementById('cash-out').classList.add('hidden');
            renderGameBoard();
        }
        
        // ================================================================== //
        // START: LÓGICA DO JOGO DOUBLE CRASH                               //
        // ================================================================== //
        let doubleCrashGame = {
            active: false,
            betAmount: 0,
            multiplier: 1.00,
            crashPoint1: 0,
            crashPoint2: 0,
            cashedOut1: false,
            cashedOut2: false,
            crashed1: false,
            crashed2: false,
            totalWin: 0,
            animationFrame: null,
        };

        const dcStartBtn = document.getElementById('dc-start-game');
        const dcCashout1Btn = document.getElementById('dc-cashout1');
        const dcCashout2Btn = document.getElementById('dc-cashout2');
        const dcMultiplierEl = document.getElementById('dc-multiplier');
        const dcGameStatusEl = document.getElementById('dc-game-status');
        const dcStatus1El = document.getElementById('dc-status1');
        const dcStatus2El = document.getElementById('dc-status2');
        const dcCrashPoint1El = document.getElementById('dc-crashpoint1');
        const dcCrashPoint2El = document.getElementById('dc-crashpoint2');
        const dcTotalWinEl = document.getElementById('dc-total-win');

        if(dcStartBtn) dcStartBtn.addEventListener('click', startDoubleCrash);
        if(dcCashout1Btn) dcCashout1Btn.addEventListener('click', () => cashOutDoubleCrash(1));
        if(dcCashout2Btn) dcCashout2Btn.addEventListener('click', () => cashOutDoubleCrash(2));

        function startDoubleCrash() {
            const gameName = 'Double Crash';
            if (doubleCrashGame.active || Date.now() - (betCooldowns[gameName] || 0) < 3000) {
                showNotification('Aguarde a próxima rodada.', 'yellow');
                return;
            }

            const bet = parseFloat(document.getElementById('dc-bet-amount').value);
            if (isNaN(bet) || bet < 1 || bet > currentUser.balance) {
                showNotification(bet > currentUser.balance ? 'Saldo insuficiente' : 'Aposta mínima CB$1.00', 'red');
                return;
            }

            betCooldowns[gameName] = Date.now();
            updateUserBalance(currentUser.balance - bet, false);

            const p1 = 1.1 + Math.random() * 5;
            const p2 = 1.1 + Math.random() * 10;
            
            doubleCrashGame = {
                active: true,
                betAmount: bet,
                multiplier: 1.00,
                crashPoint1: Math.min(p1, p2),
                crashPoint2: Math.max(p1, p2),
                cashedOut1: false,
                cashedOut2: false,
                crashed1: false,
                crashed2: false,
                totalWin: 0,
                animationFrame: null,
            };

            // Reset UI
            dcStartBtn.disabled = true;
            dcCashout1Btn.disabled = false;
            dcCashout2Btn.disabled = false;
            dcMultiplierEl.textContent = '1.00x';
            dcMultiplierEl.classList.remove('text-blue-500', 'text-purple-500', 'text-red-500');
            dcGameStatusEl.textContent = 'Em andamento...';
            dcStatus1El.textContent = 'Aguardando';
            dcStatus2El.textContent = 'Aguardando';
            dcCrashPoint1El.textContent = '?.??x';
            dcCrashPoint2El.textContent = '?.??x';
            dcTotalWinEl.textContent = 'CB$ 0,00';

            doubleCrashGame.animationFrame = requestAnimationFrame(updateDoubleCrashGame);
        }

        function updateDoubleCrashGame() {
            if (!doubleCrashGame.active) return;
            
            doubleCrashGame.multiplier += 0.01 + (doubleCrashGame.multiplier * 0.005);
            dcMultiplierEl.textContent = `${doubleCrashGame.multiplier.toFixed(2)}x`;

            // Check for crash 1
            if (!doubleCrashGame.crashed1 && doubleCrashGame.multiplier >= doubleCrashGame.crashPoint1) {
                doubleCrashGame.crashed1 = true;
                dcCashout1Btn.disabled = true;
                dcMultiplierEl.classList.add('text-blue-500');
                dcCrashPoint1El.textContent = `${doubleCrashGame.crashPoint1.toFixed(2)}x`;
                if (!doubleCrashGame.cashedOut1) {
                    dcStatus1El.textContent = 'Perdeu!';
                }
            }

            // Check for crash 2
            if (!doubleCrashGame.crashed2 && doubleCrashGame.multiplier >= doubleCrashGame.crashPoint2) {
                doubleCrashGame.crashed2 = true;
                dcCashout2Btn.disabled = true;
                dcMultiplierEl.classList.add('text-purple-500');
                dcCrashPoint2El.textContent = `${doubleCrashGame.crashPoint2.toFixed(2)}x`;
                if (!doubleCrashGame.cashedOut2) {
                    dcStatus2El.textContent = 'Perdeu!';
                }
            }
            
            // End game if both crashed
            if (doubleCrashGame.crashed1 && doubleCrashGame.crashed2) {
                endDoubleCrash();
                return;
            }

            doubleCrashGame.animationFrame = requestAnimationFrame(updateDoubleCrashGame);
        }

        function cashOutDoubleCrash(num) {
            if (!doubleCrashGame.active) return;
            
            const betPart = doubleCrashGame.betAmount / 2;
            const winAmount = betPart * doubleCrashGame.multiplier;

            if (num === 1 && !doubleCrashGame.cashedOut1 && !doubleCrashGame.crashed1) {
                doubleCrashGame.cashedOut1 = true;
                doubleCrashGame.totalWin += winAmount;
                dcCashout1Btn.disabled = true;
                dcStatus1El.textContent = `Ganhou ${winAmount.toFixed(2)}`;
            } else if (num === 2 && !doubleCrashGame.cashedOut2 && !doubleCrashGame.crashed2) {
                doubleCrashGame.cashedOut2 = true;
                doubleCrashGame.totalWin += winAmount;
                dcCashout2Btn.disabled = true;
                dcStatus2El.textContent = `Ganhou ${winAmount.toFixed(2)}`;
            }
            
            dcTotalWinEl.textContent = `CB$ ${doubleCrashGame.totalWin.toFixed(2)}`;

            if (doubleCrashGame.cashedOut1 && doubleCrashGame.cashedOut2) {
                endDoubleCrash();
            }
        }
        
        function endDoubleCrash() {
            cancelAnimationFrame(doubleCrashGame.animationFrame);
            doubleCrashGame.active = false;
            
            if (doubleCrashGame.totalWin > 0) {
                updateUserBalance(currentUser.balance + doubleCrashGame.totalWin, true);
                showNotification(`Você ganhou um total de CB$${doubleCrashGame.totalWin.toFixed(2)}!`, 'green');
            } else {
                showNotification('Mais sorte na próxima vez!', 'red');
            }

            dcGameStatusEl.textContent = 'Fim da Rodada';
            dcMultiplierEl.classList.add('text-red-500');
            dcStartBtn.disabled = false;
        }


        // Deposit/Withdrawal Modals
        document.getElementById('deposit-btn').addEventListener('click', () => {
            document.getElementById('deposit-modal').classList.remove('hidden');
        });
        document.getElementById('close-deposit-modal').addEventListener('click', () => {
            document.getElementById('deposit-modal').classList.add('hidden');
        });
        document.getElementById('copy-pix').addEventListener('click', () => {
            navigator.clipboard.writeText(document.getElementById('pix-key').textContent);
            showNotification('Código copiado!', 'green');
        });
        document.getElementById('confirm-deposit').addEventListener('click', () => {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            if(isNaN(amount) || amount < 10) {
                showNotification('Depósito mínimo de CB$10.', 'red');
                return;
            }
            updateUserBalance(currentUser.balance + amount, true);
            document.getElementById('deposit-modal').classList.add('hidden');
            showNotification(`Depósito de CB$${amount.toFixed(2)} confirmado!`, 'green');
            showReceipt('Depósito', amount, 'Aprovado');
        });

        document.getElementById('withdraw-btn').addEventListener('click', () => {
            document.getElementById('withdraw-modal').classList.remove('hidden');
            document.getElementById('withdraw-balance-info').textContent = `CB$ ${currentUser.balance.toFixed(2)}`;
        });
        document.getElementById('close-withdraw-modal').addEventListener('click', () => {
            document.getElementById('withdraw-modal').classList.add('hidden');
        });
        document.getElementById('confirm-withdraw').addEventListener('click', () => {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const key = document.getElementById('withdraw-pix-key').value;
            if(isNaN(amount) || amount < 50 || amount > currentUser.balance) {
                showNotification('Valor de saque inválido ou insuficiente.', 'red');
                return;
            }
            if(!key) {
                 showNotification('Insira sua chave de saque.', 'red');
                return;
            }
            updateUserBalance(currentUser.balance - amount, false);
            document.getElementById('withdraw-modal').classList.add('hidden');
            showNotification(`Saque de CB$${amount.toFixed(2)} solicitado!`, 'yellow');
            showReceipt('Saque', amount, 'Pendente');
        });

        // Receipt Modal
        const receiptModal = document.getElementById('receipt-modal');
        function showReceipt(type, amount, status) {
            document.getElementById('receipt-type').textContent = type;
            document.getElementById('receipt-amount').textContent = `CB$ ${amount.toFixed(2)}`;
            const statusEl = document.getElementById('receipt-status');
            statusEl.textContent = status;
            statusEl.className = `font-bold ${status === 'Aprovado' ? 'text-green-500' : status === 'Pendente' ? 'text-yellow-500' : 'text-red-500'}`;
            document.getElementById('receipt-datetime').textContent = new Date().toLocaleString('pt-BR');
            document.getElementById('receipt-id').textContent = `#TRX${Date.now()}`;
            receiptModal.classList.remove('hidden');
        }
        document.getElementById('close-receipt-modal').addEventListener('click', () => receiptModal.classList.add('hidden'));
        document.getElementById('close-receipt-btn').addEventListener('click', () => receiptModal.classList.add('hidden'));
        document.getElementById('copy-receipt').addEventListener('click', () => {
            const text = document.getElementById('receipt-details').innerText;
            navigator.clipboard.writeText(text);
            showNotification('Comprovante copiado!', 'green');
        });
        
        // User Menu Logic
        document.getElementById('user-menu-btn').addEventListener('click', () => {
            document.getElementById('user-menu').classList.toggle('hidden');
        });
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('user-menu');
            const btn = document.getElementById('user-menu-btn');
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // Initialize App
        checkLoggedInUser();

    </script>
</body>
</html>
