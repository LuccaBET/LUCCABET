<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCCABET - Casa de Apostas Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* General Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating-notification {
            animation: float 3s ease-in-out infinite;
        }
        .cell {
            transition: all 0.3s ease;
        }
        .cell:hover {
            transform: scale(1.05);
        }
        .logo-7 {
            position: relative;
        }
        .logo-7::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #009739, transparent); /* Green */
            animation: bleed 2s infinite;
        }
        @keyframes bleed {
            0% { opacity: 0; transform: scaleX(0); }
            50% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0; transform: scaleX(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 151, 57, 0.7); } /* Green */
            70% { box-shadow: 0 0 0 10px rgba(0, 151, 57, 0); } /* Green */
            100% { box-shadow: 0 0 0 0 rgba(0, 151, 57, 0); } /* Green */
        }
        .animate-pulse {
            animation: pulse 0.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Aviator Game Specific */
        #av-plane {
            transition: transform 0.1s ease-out;
            z-index: 10;
            will-change: transform;
        }
        #av-trail {
            transition: 
                width 0.1s ease-out,
                background-color 0.3s ease;
            z-index: 5;
        }

        /* Welcome Section Background */
        .welcome-bg {
            background: linear-gradient(rgba(0, 0, 0, 0.8), url('https://images.unsplash.com/photo-1518895949257-7621c3c786d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1489&q=80'));
            background-size: cover;
            background-position: center;
        }

        /* Slot Machine */
        .slot-reel {
            min-width: 64px;
            min-height: 80px;
        }

        /* Card Games (Blackjack, Video Poker) */
        .card {
            min-width: 60px;
            min-height: 90px;
        }

        /* Roulette Specific Styles */
        .roulette-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 280px;
            height: 280px;
            margin: 1rem auto;
        }
        .roulette-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 20px solid #009739; /* Green */
            z-index: 10;
        }
        .roulette-wheel {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 8px solid #4a5568; /* gray-700 */
            background-color: #1a202c; /* gray-900 */
            transition: transform 5s ease-out;
        }
        .roulette-wheel .wheel-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 0;
            top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        .roulette-center {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #2d3748; /* gray-800 */
            border-radius: 50%;
            border: 5px solid #718096; /* gray-600 */
            z-index: 5;
        }

        /* Mobile Responsiveness for Modals */
        @media (max-width: 640px) {
            .roulette-container {
                width: 220px;
                height: 220px;
            }
            .roulette-wheel {
                width: 200px;
                height: 200px;
            }
            #receipt-modal.fullscreen-mobile .receipt-content {
                max-width: 100%;
                height: 100%;
                border-radius: 0;
                border: none;
            }
            #receipt-modal.fullscreen-mobile .receipt-content h3 {
                font-size: 1.5rem;
            }
            #receipt-modal.fullscreen-mobile .receipt-content .receipt-item, 
            #receipt-modal.fullscreen-mobile .receipt-content .receipt-actions button {
                font-size: 1rem;
            }
        }

        /* Balance Update Animation */
        @keyframes balance-flash {
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .balance-updated-win {
            animation: balance-flash 0.5s ease-in-out;
            color: #22c55e; /* green-500 */
        }
        .balance-updated-loss {
            animation: balance-flash 0.5s ease-in-out;
            color: #ef4444; /* red-500 */
        }
        
        /* Admin/Owner Panel */
        .admin-panel-container {
            transition: opacity 0.3s ease-in-out;
        }
        .admin-panel-content {
            max-height: 90vh;
            animation: slide-up 0.4s ease-out;
        }
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .ceo-stat-card {
            border-left: 4px solid #009739; /* Green */
            transition: all 0.2s ease-in-out;
        }
        .ceo-stat-card:hover {
            transform: translateY(-5px);
            background-color: #1f2937; /* gray-800 */
        }
        .ceo-button {
            transition: all 0.2s ease-in-out;
        }
        .ceo-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 151, 57, 0.4); /* Green */
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 140px;
            background-color: #009739; /* Green */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -70px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #009739 transparent transparent transparent; /* Green */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Redeem Code Section */
        #redeem-section .redeem-card {
             transition: all 0.3s ease-in-out;
        }
        #redeem-section .redeem-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        #redeem-message {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        #redeem-message.show {
            max-height: 100px;
            opacity: 1;
            margin-top: 1rem;
        }
        
        /* Pending Withdrawal Notification */
        .notification-bell {
            position: relative;
            cursor: pointer;
            animation: ring-bell 1s 1s ease-in-out;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -8px;
            background-color: #009739; /* Green */
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid #1f2937;
        }
        @keyframes ring-bell {
            0%, 100% { transform: rotate(0); }
            10%, 30%, 50%, 70%, 90% { transform: rotate(15deg); }
            20%, 40%, 60%, 80% { transform: rotate(-15deg); }
        }

        /* Double Crash Game Styles */
        .crash-game-area {
            position: relative;
            width: 100%;
            height: 200px; /* Adjusted height for two graphs */
            background-color: #1a202c; /* gray-900 */
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 10px;
        }
        .crash-graph-container {
            position: relative;
            width: 48%; /* Two graphs side-by-side */
            height: 100%;
            border: 1px solid #4a5568; /* gray-700 */
            border-radius: 4px;
            overflow: hidden;
        }
        .crash-graph {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(0, 151, 57, 0.3), transparent); /* Green gradient */
            transform-origin: bottom left;
            transition: transform 0.05s linear; /* Smooth graph movement */
        }
        .crash-graph.crashed {
            background: linear-gradient(to top, rgba(255, 0, 0, 0.5), transparent); /* More intense red on crash */
        }
        .crash-multiplier {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            z-index: 1;
        }
        .crash-multiplier.crashed {
            color: #ef4444; /* red-500 */
        }
        .crash-status-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            z-index: 2;
        }

        /* Profile Settings Modal */
        .avatar-option {
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }
        .avatar-option.selected {
            border-color: #009739; /* Green */
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">

    <div id="login-screen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-900 p-6 sm:p-8 rounded-xl shadow-2xl border border-green-600 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center">
                    <span class="text-5xl font-bold text-green-600 logo-7">7</span>
                    <span class="text-3xl font-bold ml-2">LUCCA<span class="text-green-600">BET</span></span>
                </div>
            </div>
             <div id="auth-error-message" class="hidden bg-red-900 border border-red-700 text-red-300 px-4 py-2 rounded-lg text-center text-sm mb-4"></div>

            <form id="login-form" class="space-y-4">
                <h2 class="text-xl font-bold text-center text-white mb-4">Acessar Conta</h2>
                <div class="form-group">
                    <label for="login-identifier" class="block text-sm font-medium mb-1">E-mail</label>
                    <input type="text" id="login-identifier" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" required>
                </div>
                <div class="form-group">
                    <label for="login-password" class="block text-sm font-medium mb-1">Senha</label>
                    <input type="password" id="login-password" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" required>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-lg transition duration-300">
                    Entrar
                </button>
                <div class="text-center text-sm">
                    <span class="text-gray-400">Não tem uma conta?</span>
                    <button type="button" id="show-register" class="text-green-500 hover:text-green-400 ml-1 font-semibold">Cadastre-se</button>
                </div>
            </form>
            
            <form id="register-form" class="hidden space-y-4">
                 <h2 class="text-xl font-bold text-center text-white mb-4">Criar Nova Conta</h2>
                <div class="form-group">
                    <label for="reg-fullname" class="block text-sm font-medium mb-1">Nome Completo</label>
                    <input type="text" id="reg-fullname" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" required>
                    <div class="error-message">Campo obrigatório.</div>
                </div>
                <div class="form-group">
                    <label for="reg-email" class="block text-sm font-medium mb-1">E-mail</label>
                    <input type="email" id="reg-email" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" required>
                     <div class="error-message">E-mail inválido.</div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="reg-birthdate" class="block text-sm font-medium mb-1">Data de Nascimento</label>
                        <input type="date" id="reg-birthdate" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" required>
                         <div class="error-message">Você deve ter +18 anos.</div>
                    </div>
                    <div class="form-group">
                        <label for="reg-password" class="block text-sm font-medium mb-1">Senha</label>
                        <input type="password" id="reg-password" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" required>
                        <div class="error-message">Mínimo 6 caracteres.</div>
                    </div>
                </div>
                 <div class="form-group flex items-center pt-2">
                    <input type="checkbox" id="reg-terms" class="h-4 w-4 bg-gray-700 border-gray-600 text-green-600 focus:ring-green-500 rounded" required>
                    <label for="reg-terms" class="ml-2 block text-sm text-gray-300">Eu li e aceito os <a href="#" class="text-green-500 hover:underline">Termos de Uso</a>.</label>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-lg transition duration-300">
                    Cadastrar
                </button>
                <div class="text-center text-sm">
                    <span class="text-gray-400">Já tem uma conta?</span>
                    <button type="button" id="show-login" class="text-green-500 hover:text-green-400 ml-1 font-semibold">Faça login</button>
                </div>
            </form>
        </div>
    </div>
    <div id="main-app" class="hidden">
        <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center">
                    <span class="text-4xl font-bold text-green-600 logo-7">7</span>
                    <span class="text-2xl font-bold ml-2">LUCCA<span class="text-green-600">BET</span></span>
                    <span class="bg-yellow-500 text-black text-xs px-2 py-1 rounded ml-3"></span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="bg-gray-800 px-4 py-2 rounded-lg flex items-center">
                        <span class="text-gray-400 mr-2">Saldo:</span>
                        <span id="user-balance" class="font-bold text-green-500">R$ 0,00</span>
                    </div>
                    <button id="toggle-music" class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition duration-300">
                        Música Desligada 🎵
                    </button>
                    <button id="deposit-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300">
                        Depositar
                    </button>
                    <button id="withdraw-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300">
                        Saque
                    </button>
                    <div class="relative">
                        <div id="user-menu-btn" class="w-10 h-10 rounded-full cursor-pointer bg-gray-800 flex items-center justify-center text-2xl">💸</div>
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-700">
                            <a href="#" id="affiliate-link" class="block px-4 py-2 text-sm hover:bg-gray-700">Indique e Ganhe</a>
                            <a href="#" id="history-link" class="block px-4 py-2 text-sm hover:bg-gray-700">Histórico de Apostas</a>
                            <a href="#" id="settings-link" class="block px-4 py-2 text-sm hover:bg-gray-700">Configurações</a>
                            <div class="border-t border-gray-700"></div>
                            <a href="#" id="logout-btn" class="block px-4 py-2 text-sm hover:bg-gray-700 text-green-500">Sair</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <nav class="bg-gray-900 border-b border-gray-800">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 overflow-x-auto">
                    <button id="home-tab" class="px-4 py-3 text-sm font-medium bg-gray-800 text-green-500">Início</button>
                    <button id="casino-tab" class="px-4 py-3 text-sm font-medium hover:bg-gray-800">Cassino</button>
                    <button id="games-tab" class="px-4 py-3 text-sm font-medium hover:bg-gray-800">Jogos</button>
                    <button id="exclusive-tab" class="px-4 py-3 text-sm font-medium hover:bg-gray-800">Exclusivos LUCCABET</button>
                    <button id="vantagens-tab" class="px-4 py-3 text-sm font-medium hover:bg-gray-800">APOSTAS FUTEBOL DIGITAL</button>
                </div>
            </div>
        </nav>

        <main class="container mx-auto px-4 py-6">
            <div id="notifications-container" class="fixed top-20 right-4 space-y-2 z-30"></div>

            <div id="welcome-section" class="welcome-bg rounded-lg p-8 md:p-12 mb-8">
                <div class="max-w-3xl mx-auto text-center">
                    <h2 class="text-2xl md:text-3xl font-bold mb-4 text-yellow-400">LUCCABET A CASA DE APOSTAS DO MAIOR JOGADOR DA HISTORIA DO VIRTUAL LUCCA BURROWS</h2>
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">Bem-vindo, <span id="welcome-username" class="text-green-500">Usuário</span>!</h1>
                    <p class="text-xl mb-6">Prepare-se para a melhor experiência de apostas online. Seu saldo atual: <span id="welcome-balance" class="font-bold text-green-500">R$ 0,00</span></p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer" onclick="document.getElementById('vantagens-tab').click()">
                            <div class="text-yellow-500 text-3xl mb-2"><i class="fas fa-star"></i></div>
                            <h3 class="font-bold mb-2">Bônus Hoje</h3>
                            <p class="text-sm text-gray-300">Aproveite as ofertas especiais do dia!</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer" onclick="document.getElementById('exclusive-tab').click()">
                            <div class="text-green-500 text-3xl mb-2"><i class="fas fa-gamepad"></i></div>
                            <h3 class="font-bold mb-2">Jogos Exclusivos</h3>
                            <p class="text-sm text-gray-300">Diversão e emoção em nossos jogos premium</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer" onclick="document.getElementById('games-tab').click()">
                            <div class="text-blue-500 text-3xl mb-2"><i class="fas fa-bomb"></i></div>
                            <h3 class="font-bold mb-2">Mines</h3>
                            <p class="text-sm text-gray-300">Desafie a sorte e encontre os diamantes!</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer" onclick="document.getElementById('exclusive-tab').click()">
                            <div class="text-green-500 text-3xl mb-2"><i class="fas fa-gamepad"></i></div>
                            <h3 class="font-bold mb-2">Jogos Exclusivos</h3>
                            <p class="text-sm text-gray-300">Diversão e emoção em nossos jogos premium</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer" onclick="document.getElementById('vantagens-tab').click()">
                            <div class="text-green-500 text-3xl mb-2"><i class="fas fa-gem"></i></div>
                            <h3 class="font-bold mb-2">Bônus Diários</h3>
                            <p class="text-sm text-gray-300">Ganhe recompensas todos os dias</p>
                        </div>
                        <div class="bg-gray-900 bg-opacity-70 p-4 rounded-lg border border-gray-700 cursor-pointer" onclick="document.getElementById('vantagens-tab').click()">
                            <div class="text-green-500 text-3xl mb-2"><i class="fas fa-shield-alt"></i></div>
                            <h3 class="font-bold mb-2">Segurança Total</h3>
                            <p class="text-sm text-gray-300">Seus dados e transações protegidos</p>
                        </div>
                    </div>
                    
                    <button id="start-playing-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full text-lg transition duration-300 transform hover:scale-105">
                        <i class="fas fa-play mr-2"></i> Começar a Jogar
                    </button>
                </div>
            </div>

            <div id="casino-section" class="hidden">
                <div class="mt-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-coins mr-2 text-green-500"></i> Caça-Níqueis LUCCABET
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="slot-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="slot-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                
                                <div>
                                    <label for="auto-spin-count" class="block text-sm font-medium mb-1">Giros automáticos (1-100)</label>
                                    <input type="number" id="auto-spin-count" min="1" max="100" value="10" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                
                                <div class="grid grid-cols-2 gap-2 pt-2">
                                    <button id="spin-slot" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Girar (1x)
                                    </button>
                                    <button id="auto-spin-slot" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Girar Auto
                                    </button>
                                </div>
                                <button id="stop-auto-spin" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded transition duration-300 hidden">
                                    Parar Giros
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status da Partida</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="slot-current-bet" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Prêmio:</span>
                                        <span id="slot-win-amount" class="font-medium text-green-500">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Último Resultado:</span>
                                        <span id="slot-last-result" class="font-medium">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Giros Restantes:</span>
                                        <span id="slot-spins-left" class="font-medium">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold">Caça-Níqueis</h3>
                                    <div id="slot-status" class="text-sm px-3 py-1 bg-gray-800 rounded-full">
                                        Pronto para jogar
                                    </div>
                                </div>
                                
                                <div class="slot-machine bg-gray-800 p-4 rounded-lg">
                                    <div class="slots flex justify-center gap-4 mb-6">
                                        <div class="slot-reel bg-gray-700 rounded flex items-center justify-center text-4xl">🍒</div>
                                        <div class="slot-reel bg-gray-700 rounded flex items-center justify-center text-4xl">7️⃣</div>
                                        <div class="slot-reel bg-gray-700 rounded flex items-center justify-center text-4xl">💰</div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 pt-4 border-t border-gray-800">
                                    <h3 class="text-lg font-bold mb-2">Como jogar</h3>
                                    <ul class="list-disc pl-5 space-y-1 text-sm text-gray-300">
                                        <li>Escolha o valor da aposta</li>
                                        <li>Clique em "Girar Rodas" para jogar</li>
                                        <li>3 símbolos iguais = vitória</li>
                                        <li>🍒🍒🍒 = 2x | 7️⃣7️⃣7️⃣ = 10x | 💰💰💰 = 15x</li>
                                        <li>Qualquer combinação de 7️⃣ e 💰 = 5x</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-circle-notch mr-2 text-green-500"></i> Roleta LUCCABET
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="roulette-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="roulette-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-1">Apostar em:</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-bet-type="red" class="roulette-bet-btn bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded transition duration-300">
                                            Vermelho (2x)
                                        </button>
                                        <button data-bet-type="black" class="roulette-bet-btn bg-gray-800 hover:bg-gray-700 text-white py-2 px-4 rounded transition duration-300">
                                            Preto (2x)
                                        </button>
                                        <button data-bet-type="green" class="roulette-bet-btn bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded transition duration-300 col-span-2">
                                            Verde (14x)
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="roulette-current-bet" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Tipo:</span>
                                        <span id="roulette-bet-type" class="font-medium">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Resultado:</span>
                                        <span id="roulette-result" class="font-medium">-</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Prêmio:</span>
                                        <span id="roulette-win-amount" class="text-green-500">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800 h-full flex flex-col items-center justify-center">
                                <div class="roulette-container">
                                    <div class="roulette-pointer"></div>
                                    <div id="roulette-wheel-graphic" class="roulette-wheel">
                                        </div>
                                    <div class="roulette-center"></div>
                                </div>
                                <div id="roulette-status" class="text-lg font-bold mt-4">Faça sua aposta</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-club mr-2 text-green-500"></i> Blackjack LUCCABET
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="blackjack-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="blackjack-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                
                                <button id="blackjack-start" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                    Iniciar Jogo
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="blackjack-current-bet" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Dealer:</span>
                                        <span id="blackjack-dealer-score" class="font-medium">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Jogador:</span>
                                        <span id="blackjack-player-score" class="font-medium">-</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Resultado:</span>
                                        <span id="blackjack-result" class="text-green-500">-</span>
                                    </div>
                                </div>
                                
                                <div id="blackjack-actions" class="mt-4 grid grid-cols-2 gap-2 hidden">
                                    <button id="blackjack-hit" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                                        Pedir Carta
                                    </button>
                                    <button id="blackjack-stand" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                                        Parar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold">Mesa de Blackjack</h3>
                                    <div id="blackjack-status" class="text-sm px-3 py-1 bg-gray-800 rounded-full">
                                        Aguardando aposta
                                    </div>
                                </div>
                                
                                <div class="blackjack-table space-y-8">
                                    <div class="dealer-cards">
                                        <h4 class="text-md font-medium mb-2">Dealer: <span id="dealer-count">?</span></h4>
                                        <div class="flex gap-2">
                                            <div class="card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl">?</div>
                                            <div id="dealer-cards-container" class="flex gap-2"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="player-cards">
                                        <h4 class="text-md font-medium mb-2">Você: <span id="player-count">0</span></h4>
                                        <div id="player-cards-container" class="flex gap-2"></div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 pt-4 border-t border-gray-800">
                                    <h3 class="text-lg font-bold mb-2">Como jogar</h3>
                                    <ul class="list-disc pl-5 space-y-1 text-sm text-gray-300">
                                        <li>Obtenha uma mão mais próxima de 21 que o dealer sem estourar</li>
                                        <li>Cartas valem seu valor numérico, figuras valem 10, Ás vale 1 ou 11</li>
                                        <li>Blackjack (Ás + 10) paga 3:2</li>
                                        <li>Vitória normal paga 1:1</li>
                                        <li>Se o dealer estourar, todos os jogadores que não estouraram ganham</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-spade mr-2 text-green-500"></i> Video Poker LUCCABET
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="poker-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="poker-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                
                                <button id="poker-deal" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                    Distribuir Cartas
                                </button>
                                
                                <button id="poker-draw" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300 hidden">
                                    Trocar Cartas
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="poker-current-bet" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Mão:</span>
                                        <span id="poker-hand" class="font-medium">-</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Prêmio:</span>
                                        <span id="poker-win-amount" class="text-green-500">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Pagamentos</h3>
                                <ul class="text-sm text-gray-300 space-y-1">
                                    <li>Royal Flush - 250x</li>
                                    <li>Straight Flush - 50x</li>
                                    <li>Quadra - 25x</li>
                                    <li>Full House - 9x</li>
                                    <li>Flush - 6x</li>
                                    <li>Sequência - 4x</li>
                                    <li>Trinca - 3x</li>
                                    <li>Dois Pares - 2x</li>
                                    <li>Par de Valetes+ - 1x</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold">Video Poker</h3>
                                    <div id="poker-status" class="text-sm px-3 py-1 bg-gray-800 rounded-full">
                                        Faça sua aposta
                                    </div>
                                </div>
                                
                                <div class="poker-hand flex justify-center gap-2 mb-8">
                                    <div class="card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl">?</div>
                                    <div class="card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl">?</div>
                                    <div class="card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl">?</div>
                                    <div class="card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl">?</div>
                                    <div class="card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl">?</div>
                                </div>
                                
                                <div class="mt-6 pt-4 border-t border-gray-800">
                                    <h3 class="text-lg font-bold mb-2">Como jogar</h3>
                                    <ul class="list-disc pl-5 space-y-1 text-sm text-gray-300">
                                        <li>Faça sua aposta e clique em "Distribuir Cartas"</li>
                                        <li>Selecione as cartas que deseja manter clicando nelas</li>
                                        <li>Clique em "Trocar Cartas" para receber novas cartas</li>
                                        <li>O prêmio é pago de acordo com a força da sua mão final</li>
                                        <li>O jogo usa um baralho padrão de 52 cartas</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="games-section" class="hidden">
                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-gamepad mr-2 text-green-500"></i> Campo Minado
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configuração da Partida</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                
                                <div>
                                    <label for="mines-count" class="block text-sm font-medium mb-1">Número de minas (1-10)</label>
                                    <select id="mines-count" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                        <option value="1">1 mina (1.10x)</option>
                                        <option value="2">2 minas (1.25x)</option>
                                        <option value="3" selected>3 minas (1.40x)</option>
                                        <option value="4">4 minas (1.60x)</option>
                                        <option value="5">5 minas (2.00x)</option>
                                        <option value="6">6 minas (2.50x)</option>
                                        <option value="7">7 minas (3.00x)</option>
                                        <option value="8">8 minas (3.50x)</option>
                                        <option value="9">9 minas (3.75x)</option>
                                        <option value="10">10 minas (4.00x)</option>
                                    </select>
                                </div>
                                
                                <div class="pt-2">
                                    <button id="start-game" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Iniciar Jogo
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status da Partida</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="current-bet" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Minas:</span>
                                        <span id="current-mines" class="font-medium">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Cliques seguros:</span>
                                        <span id="safe-clicks" class="font-medium">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Multiplicador:</span>
                                        <span id="current-multiplier" class="font-medium text-green-500">1.00x</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Ganho potencial:</span>
                                        <span id="potential-win" class="text-green-500">R$ 0,00</span>
                                    </div>
                                </div>
                                
                                <button id="cash-out" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300 hidden">
                                    Retirar
                                </button>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold">Tabuleiro</h3>
                                    <div id="game-status" class="text-sm px-3 py-1 bg-gray-800 rounded-full">
                                        Aguardando início...
                                    </div>
                                </div>
                                
                                <div id="game-board" class="grid grid-cols-5 gap-2">
                                    <div class="text-center py-4 text-gray-600">
                                        Configure a partida e clique em "Iniciar Jogo"
                                    </div>
                                </div>
                                
                                <div class="mt-6 pt-4 border-t border-gray-800">
                                    <h3 class="text-lg font-bold mb-2">Como jogar</h3>
                                    <ul class="list-disc pl-5 space-y-1 text-sm text-gray-300">
                                        <li>Escolha o valor da aposta e o número de minas</li>
                                        <li>Clique em "Iniciar Jogo" para começar</li>
                                        <li>Clique nos blocos para revelá-los</li>
                                        <li>Cada bloco seguro aumenta seu multiplicador</li>
                                        <li>Se encontrar uma mina, você perde a aposta</li>
                                        <li>Clique em "Retirar" a qualquer momento para garantir seus ganhos</li>
                                        <li>Quanto mais minas, maior o multiplicador inicial</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-plane mr-2 text-green-500"></i> Aviador LUCCA
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="av-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="av-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                <button id="av-start-game" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                    Iniciar Voo
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta:</span>
                                        <span id="av-current-bet" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Multiplicador:</span>
                                        <span id="av-multiplier" class="font-medium text-green-500">1.00x</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Ganho:</span>
                                        <span id="av-potential-win" class="text-green-500">R$ 0,00</span>
                                    </div>
                                </div>
                                
                                <button id="av-cash-out" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300 hidden">
                                    Retirar
                                </button>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800 h-full flex flex-col items-center justify-center">
                                <div id="av-game-area" class="relative w-full h-64 bg-gradient-to-b from-gray-900 to-black rounded-lg overflow-hidden">
                                    <div id="av-plane" class="absolute left-4 top-4 text-3xl transition-all duration-1000">
                                        ✈️
                                    </div>
                                    <div id="av-trail" class="absolute left-4 top-8 w-0 h-1 bg-green-600 transition-all duration-1000"></div>
                                </div>
                                <div class="mt-4 text-center">
                                    <div id="av-status" class="text-lg font-bold">Aguardando início...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-dice mr-2 text-green-500"></i> Dados LUCCABET
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Apostar no Dado</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="dice-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="dice-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                <div>
                                    <label for="dice-number" class="block text-sm font-medium mb-1">Escolha um número (1-6)</label>
                                    <select id="dice-number" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                    </select>
                                </div>
                                <button id="dice-roll" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                    Girar Dado
                                </button>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800 h-full flex flex-col items-center justify-center">
                                <div class="text-6xl mb-4" id="dice-display">
                                    <i class="fas fa-dice-d6 text-gray-600"></i>
                                </div>
                                <div id="dice-result" class="text-xl font-bold mb-2"></div>
                                <div id="dice-status" class="text-sm text-gray-400">Configure sua aposta e clique em "Girar Dado"</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Double Crash Game Section -->
                <div class="mt-12">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-green-500"></i> Double Crash LUCCA
                    </h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-900 p-6 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-bold mb-4">Configurar Aposta</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="dc-bet-amount" class="block text-sm font-medium mb-1">Valor da aposta (mínimo R$1)</label>
                                    <input type="number" id="dc-bet-amount" min="1" value="1" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="dc-bet-graph1" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Apostar no Gráfico 1
                                    </button>
                                    <button id="dc-bet-graph2" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Apostar no Gráfico 2
                                    </button>
                                    <button id="dc-bet-both" class="col-span-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded transition duration-300">
                                        Apostar em Ambos
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <h3 class="text-lg font-bold mb-2">Status</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta Gráfico 1:</span>
                                        <span id="dc-current-bet-graph1" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Aposta Gráfico 2:</span>
                                        <span id="dc-current-bet-graph2" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Multiplicador 1:</span>
                                        <span id="dc-multiplier-graph1" class="font-medium text-green-500">1.00x</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Multiplicador 2:</span>
                                        <span id="dc-multiplier-graph2" class="font-medium text-green-500">1.00x</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Ganho Potencial 1:</span>
                                        <span id="dc-potential-win-graph1" class="text-green-500">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between font-bold">
                                        <span>Ganho Potencial 2:</span>
                                        <span id="dc-potential-win-graph2" class="text-green-500">R$ 0,00</span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-2 mt-4">
                                    <button id="dc-cash-out-graph1" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300" disabled>
                                        Retirar G1
                                    </button>
                                    <button id="dc-cash-out-graph2" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition duration-300" disabled>
                                        Retirar G2
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-gray-900 p-6 rounded-lg border border-gray-800 h-full flex flex-col items-center justify-center">
                                <div id="dc-game-area" class="crash-game-area">
                                    <div class="crash-graph-container">
                                        <div id="crash-graph-1" class="crash-graph"></div>
                                        <div id="crash-multiplier-1" class="crash-multiplier">1.00x</div>
                                        <div id="crash-status-overlay-1" class="crash-status-overlay hidden">Aguardando...</div>
                                    </div>
                                    <div class="crash-graph-container">
                                        <div id="crash-graph-2" class="crash-graph"></div>
                                        <div id="crash-multiplier-2" class="crash-multiplier">1.00x</div>
                                        <div id="crash-status-overlay-2" class="crash-status-overlay hidden">Aguardando...</div>
                                    </div>
                                </div>
                                <div class="mt-4 text-center">
                                    <div id="dc-overall-status" class="text-lg font-bold">Aguardando apostas...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="exclusive-section" class="hidden">
                <div class="bg-gray-900 p-4 md:p-6 rounded-lg border-2 border-green-800">
                    <h2 class="text-3xl font-bold mb-4 text-center text-green-500 flex items-center justify-center">
                        <i class="fas fa-star mr-3"></i>Exclusivos LUCCABET
                    </h2>
                    <p class="text-center text-gray-300 max-w-3xl mx-auto">
                        Fique ligado! Novos jogos exclusivos estão chegando em breve para você!
                    </p>
                </div>
            </div>

            <div id="vantagens-section" class="hidden">
                 <div class="grid grid-cols-1 md:grid-cols-1 lg:grid-cols-1 gap-8">
                    <div class="bg-gray-900 p-6 rounded-lg border border-blue-700 shadow-lg text-center flex flex-col justify-center">
                        <div class="text-blue-500 text-5xl mb-4"><i class="fas fa-futbol"></i></div>
                        <h3 class="text-xl font-bold mb-2">APOSTAS FUTEBOL DIGITAL</h3>
                        <p class="text-gray-400 mb-4">Sem jogos importantes da CBFD hoje</p>
                    </div>
                </div>
            </div>


            <div id="affiliate-section" class="hidden mt-8">
                <h2 class="text-3xl font-bold mb-8 text-center text-green-500 flex items-center justify-center">
                    <i class="fas fa-users mr-3"></i>Indique e Ganhe
                </h2>
                <div class="max-w-4xl mx-auto bg-gray-900 rounded-lg border border-gray-800 p-6 md:p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="text-center md:text-left">
                            <h3 class="text-2xl font-bold mb-4">Convide seus amigos!</h3>
                            <p class="text-gray-400 mb-6">Compartilhe seu link exclusivo e ganhe bônus toda vez que um amigo se cadastrar e jogar. Quanto mais amigos você convida, mais você ganha!</p>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 mb-2">Seu link de afiliado:</p>
                                <div class="flex flex-col sm:flex-row items-center justify-between bg-black p-3 rounded">
                                    <span id="affiliate-user-link" class="font-mono text-sm break-all mb-2 sm:mb-0"></span>
                                    <button id="copy-affiliate-link" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300 w-full sm:w-auto">
                                        <i class="far fa-copy mr-2"></i>Copiar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h4 class="text-xl font-bold mb-4 text-center">Suas Estatísticas</h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center bg-gray-900 p-3 rounded-lg">
                                    <span class="text-gray-300"><i class="fas fa-user-check mr-2 text-blue-400"></i>Amigos Indicados:</span>
                                    <span id="friends-indicated" class="font-bold text-xl text-white">0</span>
                                </div>
                                <div class="flex justify-between items-center bg-gray-900 p-3 rounded-lg">
                                    <span class="text-gray-300"><i class="fas fa-dollar-sign mr-2 text-green-400"></i>Bônus Gerado:</span>
                                    <span id="bonus-generated" class="font-bold text-xl text-green-500">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="deposit-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
                <div class="bg-gray-900 p-6 rounded-lg border border-green-600 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Realizar Depósito</h3>
                        <button id="close-deposit-modal" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="deposit-amount" class="block text-sm font-medium mb-1">Valor do depósito (mínimo R$10)</label>
                            <input type="number" id="deposit-amount" min="10" placeholder="10" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                        </div>
                        <div>
                            <label for="payment-method" class="block text-sm font-medium mb-1">Método de Pagamento</label>
                            <select id="payment-method" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                                <option value="pix" selected>PIX</option>
                                <option value="boleto">Boleto</option>
                                <option value="cartao">Cartão de Crédito</option>
                            </select>
                        </div>
                        <div id="pix-info-section" class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-medium mb-2">Chave PIX (E-mail):</h4>
                            <div class="flex items-center justify-between bg-black p-3 rounded">
                                <span id="pix-key" class="font-mono">pix@luccabet.com</span>
                                <button id="copy-pix" class="text-green-500 hover:text-green-400">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">Envie o valor exato para esta chave PIX. O saldo será creditado em alguns minutos.</p>
                        </div>
                        <div id="boleto-info-section" class="hidden bg-gray-800 p-4 rounded-lg">
                            <!-- Boleto form will be injected here -->
                        </div>
                         <div id="cartao-info-section" class="hidden bg-gray-800 p-4 rounded-lg">
                            <!-- Credit Card form will be injected here -->
                        </div>
                        <button id="confirm-deposit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Confirmar Depósito
                        </button>
                    </div>
                </div>
            </div>

            <div id="withdraw-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
                <div class="bg-gray-900 p-6 rounded-lg border border-green-600 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Solicitar Saque</h3>
                        <button id="close-withdraw-modal" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="withdraw-amount" class="block text-sm font-medium mb-1">Valor do saque (mínimo R$50)</label>
                            <input type="number" id="withdraw-amount" min="50" placeholder="50" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                            <p class="text-xs text-gray-400 mt-1">Seu saldo atual: <span id="withdraw-balance-info">R$ 0,00</span></p>
                        </div>
                        <div>
                            <label for="withdraw-pix-key" class="block text-sm font-medium mb-1">Sua Chave PIX (e-mail ou celular)</label>
                            <input type="text" id="withdraw-pix-key" placeholder="seu.email@exemplo.com" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                        </div>
                        <button id="confirm-withdraw" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Solicitar Saque
                        </button>
                        <p class="text-xs text-gray-500 text-center">As solicitações de saque são processadas em até 24 horas úteis.</p>
                    </div>
                </div>
            </div>

            <div id="receipt-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
                <div class="receipt-content bg-gray-900 p-6 rounded-lg border border-green-600 max-w-md w-full text-white">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-3">
                        <h3 class="text-xl font-bold">Comprovante de Transação</h3>
                        <button id="close-receipt-modal" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    <div id="receipt-details" class="space-y-3 text-sm">
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Tipo:</span>
                            <span id="receipt-type" class="font-bold"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Valor:</span>
                            <span id="receipt-amount" class="font-bold"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Status:</span>
                            <span id="receipt-status" class="font-bold"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">Data e Hora:</span>
                            <span id="receipt-datetime" class="font-mono"></span>
                        </div>
                        <div class="receipt-item flex justify-between">
                            <span class="text-gray-400">ID da Transação:</span>
                            <span id="receipt-id" class="font-mono"></span>
                        </div>
                    </div>
                    <div class="receipt-actions mt-6 pt-4 border-t border-gray-700 flex flex-col sm:flex-row gap-2">
                        <button id="copy-receipt" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            <i class="far fa-copy mr-2"></i>Copiar Comprovante
                        </button>
                        <button id="close-receipt-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bet History Modal -->
            <div id="bet-history-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                <div class="bg-gray-900 p-6 rounded-lg border border-gray-700 max-w-2xl w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Histórico de Apostas</h3>
                        <button id="close-history-modal" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="overflow-x-auto max-h-96">
                        <table class="w-full text-sm text-left text-gray-400">
                            <thead class="text-xs uppercase bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-4 py-2">Data</th>
                                    <th scope="col" class="px-4 py-2">Jogo</th>
                                    <th scope="col" class="px-4 py-2">Aposta</th>
                                    <th scope="col" class="px-4 py-2">Resultado</th>
                                </tr>
                            </thead>
                            <tbody id="bet-history-list">
                                <!-- History items will be injected here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-4">
                        <button id="clear-history-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">Limpar Histórico</button>
                    </div>
                </div>
            </div>

            <!-- Profile Settings Modal -->
            <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                <div class="bg-gray-900 p-6 rounded-lg border border-gray-700 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Configurações de Conta</h3>
                        <button id="close-settings-modal" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="profile-username" class="block text-sm font-medium mb-1">Nome de Exibição</label>
                            <input type="text" id="profile-username" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Escolha seu Avatar</label>
                            <div id="avatar-options" class="grid grid-cols-5 gap-3">
                                <!-- Avatar options will be dynamically loaded here -->
                            </div>
                        </div>
                        <button id="save-profile-changes" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            Salvar Alterações
                        </button>
                    </div>
                </div>
            </div>

        </main>

        <div id="stats-panel" class="hidden fixed right-0 top-1/2 -translate-y-1/2 bg-gray-900 bg-opacity-90 backdrop-blur-sm border-l-2 border-t-2 border-b-2 border-green-600 rounded-l-lg shadow-2xl p-4 w-64 text-sm z-40">
            <h3 class="text-lg font-bold mb-3 text-center text-green-500 flex items-center justify-center"><i class="fas fa-chart-bar mr-2"></i>Estatísticas</h3>
            <div class="space-y-2">
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Jogo:</span>
                    <span id="stats-game-name" class="font-bold text-white">Nenhum</span>
                </div>
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Apostas:</span>
                    <span id="stats-total-bets" class="font-bold text-white">0</span>
                </div>
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Vitórias:</span>
                    <span id="stats-wins" class="font-bold text-green-500">0</span>
                </div>
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Derrotas:</span>
                    <span id="stats-losses" class="font-bold text-red-500">0</span>
                </div>
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Winrate:</span>
                    <span id="stats-winrate" class="font-bold text-yellow-500">0.00%</span>
                </div>
                <div class="border-t border-gray-700 my-2"></div>
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Saldo Inicial:</span>
                    <span id="stats-initial-balance" class="font-bold text-white">R$ 0,00</span>
                </div>
                <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                    <span class="text-gray-400">Saldo Atual:</span>
                    <span id="stats-current-balance" class="font-bold text-green-500">R$ 0,00</span>
                </div>
            </div>
        </div>
        
        <button id="toggle-stats-btn" class="hidden fixed bottom-4 right-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full shadow-lg z-50 transition-transform transform hover:scale-110">
            📊 Estatísticas
        </button>


        <footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="text-lg font-bold mb-4 flex items-center">
                            <span class="text-2xl font-bold text-green-600 logo-7 mr-2">7</span>
                            LUCCA<span class="text-green-600">BET</span>
                        </h3>
                        <p class="text-sm text-gray-400">A casa de apostas mais arriscada e recompensadora do Brasil.</p>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Links Rápidos</h4>
                        <ul class="space-y-2 text-sm text-gray-400">
                            <li><a href="#" onclick="document.getElementById('home-tab').click(); return false;" class="hover:text-green-500">Início</a></li>
                            <li><a href="#" onclick="document.getElementById('casino-tab').click(); return false;" class="hover:text-green-500">Cassino</a></li>
                            <li><a href="#" onclick="document.getElementById('exclusive-tab').click(); return false;" class="hover:text-green-500">Exclusivos LUCCABET</a></li>
                            <li><a href="#" onclick="document.getElementById('vantagens-tab').click(); return false;" class="hover:text-green-500">APOSTAS FUTEBOL DIGITAL</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Suporte</h4>
                        <ul class="space-y-2 text-sm text-gray-400">
                            <li><a href="#" class="hover:text-green-500">FAQ</a></li>
                            <li><a href="#" class="hover:text-green-500">Chat ao Vivo</a></li>
                            <li><a href="#" onclick="document.getElementById('vantagens-tab').click(); return false;" class="hover:text-green-500">E-mail</a></li>
                            <li><a href="#" class="hover:text-green-500">Termos de Uso</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Segurança</h4>
                        <div class="flex space-x-4 mb-4">
                            <div class="w-12 h-8 bg-gray-800 rounded flex items-center justify-center">
                                <i class="fas fa-lock text-green-500"></i>
                            </div>
                            <div class="w-12 h-8 bg-gray-800 rounded flex items-center justify-center">
                                <i class="fas fa-shield-alt text-blue-500"></i>
                            </div>
                            <div class="w-12 h-8 bg-gray-800 rounded flex items-center justify-center">
                                <i class="fas fa-user-secret text-yellow-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">Jogue com responsabilidade. Apenas para maiores de 18 anos.</p>
                    </div>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-6 text-sm text-gray-500 text-center">
                    <div id="user-location-info" class="mb-4 text-xs font-mono">
                        Buscando localização...
                    </div>
                    <p>© 2023 LUCCABET. Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <audio id="bg-music" loop class="hidden">
        <source src="https://cdn.pixabay.com/download/audio/2022/10/16/audio_2e7f7fa0e6.mp3?filename=lofi-study-112191.mp3" type="audio/mpeg">
    </audio>
    <audio id="notification-sound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_c6ccf3232b.mp3" class="hidden"></audio>
    
    <div id="ceo-loading-screen" class="hidden fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-[100]">
        <div class="text-center animate-pulse">
            <h2 class="text-3xl font-bold text-white">👑 Hello CEO, preparando sua mesa de comando...</h2>
        </div>
    </div>

    <div id="owner-panel" class="hidden admin-panel-container fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[99] p-4">
        <div class="admin-panel-content bg-gray-900 p-6 rounded-2xl border-2 border-green-700 shadow-2xl max-w-7xl w-full overflow-y-auto">
            <div class="flex justify-between items-center mb-6 border-b-2 border-green-800 pb-4">
                <div class="flex items-center gap-4">
                     <div class="tooltip">
                        <h2 class="text-3xl font-bold text-white"><i class="fas fa-crown text-green-500 mr-3"></i>Painel do Dono</h2>
                        <span class="tooltiptext">Comando Supremo 🧠</span>
                    </div>
                    <div id="ceo-notification-bell" class="notification-bell text-2xl text-yellow-400">
                        <i class="fas fa-bell"></i>
                        <span id="ceo-notification-badge" class="notification-badge hidden">0</span>
                    </div>
                </div>
                <button onclick="document.getElementById('owner-panel').classList.add('hidden')" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="font-bold text-xl mb-4 text-green-400"><i class="fas fa-chart-line mr-2"></i>Visão Geral</h3>
                        <div class="space-y-3">
                            <div class="ceo-stat-card bg-gray-900 p-3 rounded-lg flex justify-between items-center"><span><i class="fas fa-wallet mr-2 text-green-400"></i>Saldo Total</span> <span id="ceo-total-balance" class="font-bold"></span></div>
                            <div class="ceo-stat-card bg-gray-900 p-3 rounded-lg flex justify-between items-center"><span><i class="fas fa-users mr-2 text-blue-400"></i>Total Usuários</span> <span id="ceo-total-users" class="font-bold"></span></div>
                            <div class="ceo-stat-card bg-gray-900 p-3 rounded-lg flex justify-between items-center"><span><i class="fas fa-user-clock mr-2 text-yellow-400"></i>Usuários Online</span> <span id="ceo-online-users" class="font-bold"></span></div>
                            <div class="ceo-stat-card bg-gray-900 p-3 rounded-lg flex justify-between items-center"><span><i class="fas fa-dollar-sign mr-2 text-yellow-400"></i>Lucro (7d)</span> <span id="ceo-profit-7d" class="font-bold"></span></div>
                            <div class="ceo-stat-card bg-gray-900 p-3 rounded-lg flex justify-between items-center"><span><i class="fas fa-money-bill-trend-up mr-2 text-blue-400"></i>Apostado (Hoje)</span> <span id="ceo-bet-today" class="font-bold"></span></div>
                        </div>
                    </div>
                     <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="font-bold text-xl mb-4 text-green-400"><i class="fas fa-money-check-dollar mr-2"></i>Financeiro</h3>
                        <div class="space-y-3">
                           <button onclick="ceo_openBalanceModal('add')" class="ceo-button w-full bg-green-600 hover:bg-green-700 font-bold py-3 px-4 rounded-lg"><i class="fas fa-plus-circle mr-2"></i>Injetar Saldo</button>
                           <button onclick="ceo_openBalanceModal('remove')" class="ceo-button w-full bg-red-600 hover:bg-red-700 font-bold py-3 px-4 rounded-lg"><i class="fas fa-minus-circle mr-2"></i>Remover Saldo</button>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-gray-800 p-4 rounded-lg h-full">
                        <h3 id="ceo-withdrawals-title" class="font-bold text-xl mb-4 text-green-400"><i class="fas fa-hourglass-half mr-2"></i>Saques Pendentes</h3>
                        <div id="ceo-withdrawals-list" class="space-y-2 max-h-96 overflow-y-auto pr-2">
                            </div>
                    </div>
                </div>

                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="font-bold text-xl mb-4 text-green-400"><i class="fas fa-gift mr-2"></i>Gerar Bônus</h3>
                        <div class="space-y-3">
                            <input type="number" id="ceo-bonus-amount" placeholder="Valor do Bônus (R$)" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded">
                            <button onclick="ceo_generateBonus()" class="ceo-button w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-4 rounded-lg"><i class="fas fa-ticket-alt mr-2"></i>Criar Código</button>
                            <div id="ceo-bonus-result" class="text-center font-mono mt-2 p-2 bg-gray-900 rounded"></div>
                        </div>
                    </div>
                     <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="font-bold text-xl mb-4 text-green-400"><i class="fas fa-shield-halved mr-2"></i>Logs de Auditoria</h3>
                         <div id="ceo-audit-log" class="space-y-2 max-h-60 overflow-y-auto pr-2 text-xs">
                             <p class="text-gray-500">Nenhuma ação registrada.</p>
                         </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="hidden admin-panel-container fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[99] p-4">
        <div class="admin-panel-content bg-gray-900 p-6 rounded-lg border border-blue-600 max-w-4xl w-full overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                 <div class="flex items-center gap-4">
                    <h3 class="text-xl font-bold"><i class="fas fa-user-shield mr-2"></i>Painel de Admin</h3>
                    <div id="admin-notification-bell" class="notification-bell text-xl text-yellow-400">
                        <i class="fas fa-bell"></i>
                        <span id="admin-notification-badge" class="notification-badge hidden">0</span>
                    </div>
                </div>
                <button onclick="document.getElementById('admin-panel').classList.add('hidden')" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <div class="space-y-4">
                <h4 id="admin-withdrawals-title" class="text-lg font-semibold">Saques Pendentes</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead><tr class="border-b border-gray-700"><th class="text-left p-2">Data</th><th class="text-left p-2">Usuário</th><th class="text-left p-2">Valor</th><th class="text-left p-2">Chave PIX</th><th class="text-left p-2">Ação</th></tr></thead>
                        <tbody id="admin-withdrawals-list"></tbody>
                    </table>
                </div>
                 <h4 class="text-lg font-semibold mt-6">Usuários</h4>
                <div class="overflow-x-auto max-h-64">
                    <table class="w-full text-sm">
                        <thead><tr class="border-b border-gray-700"><th class="text-left p-2">Nome</th><th class="text-left p-2">Email</th><th class="text-left p-2">Saldo</th></tr></thead>
                        <tbody id="admin-users-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        // ================================================================== //
        // START: LÓGICA DO NOVO SISTEMA DE AUTENTICAÇÃO                    //
        // ================================================================== //
        
        // Database simulation using localStorage
        const usersDB = {
            getUsers: () => {
                const users = localStorage.getItem('luccabet_users_v2'); // Use a new key for the new structure
                return users ? JSON.parse(users) : {};
            },
            saveUsers: (users) => {
                localStorage.setItem('luccabet_users_v2', JSON.stringify(users));
            },
            // Find user by any unique identifier (email)
            findUser: (identifier) => {
                const users = usersDB.getUsers();
                return Object.values(users).find(u => u.email === identifier) || null;
            },
            // Create a new, verified user
            createUser: (userData) => {
                const users = usersDB.getUsers();
                if (usersDB.findUser(userData.email)) {
                    return { error: 'Este E-mail já está em uso.' };
                }
                
                // Using email as the primary key
                users[userData.email] = {
                    ...userData,
                    password: btoa(userData.password), // Basic encoding as requested
                    balance: 0,
                    verified: true, // Users are now verified by default
                    createdAt: new Date().toISOString(),
                    stats: {},
                    betHistory: [], // Initialize bet history
                    profileAvatar: '💸' // Default avatar
                };
                
                usersDB.saveUsers(users);
                return { user: users[userData.email] };
            },
            // Update any user data
            updateUser: (email, data) => {
                const users = usersDB.getUsers();
                // Find user by email as it's the primary key now
                const userToUpdate = Object.values(users).find(u => u.email === email);
                if (!userToUpdate) {
                    return { error: 'Usuário não encontrado' };
                }
                
                users[email] = { ...userToUpdate, ...data };
                usersDB.saveUsers(users);
                return { user: users[email] };
            }
        };

        // Current user session
        let currentUser = null;

        // DOM Elements for Auth
        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');
        
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');

        const authErrorMessage = document.getElementById('auth-error-message');

        // Validation Helper Functions
        const validateEmail = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

        const isOver18 = (birthdate) => {
            const today = new Date();
            const birthDate = new Date(birthdate);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age >= 18;
        };
        
        // --- Form utility to show/hide errors ---
        const setFieldError = (input, message) => {
            const errorDiv = input.nextElementSibling;
            if (message) {
                input.classList.add('invalid');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            } else {
                input.classList.remove('invalid');
                errorDiv.style.display = 'none';
            }
        };
        const showAuthError = (message) => {
            authErrorMessage.textContent = message;
            authErrorMessage.classList.remove('hidden');
        }
        const hideAuthError = () => {
             authErrorMessage.classList.add('hidden');
        }

        // Auth View Management
        const showAuthView = (view) => {
            hideAuthError();
            loginForm.classList.add('hidden');
            registerForm.classList.add('hidden');
            if (view === 'login') loginForm.classList.remove('hidden');
            if (view === 'register') registerForm.classList.remove('hidden');
        };

        showRegisterBtn.addEventListener('click', () => showAuthView('register'));
        showLoginBtn.addEventListener('click', () => showAuthView('login'));
        
        // --- Login Logic ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            hideAuthError();
            const identifier = document.getElementById('login-identifier').value.trim();
            const password = document.getElementById('login-password').value;

            const user = usersDB.findUser(identifier);
            if (!user) {
                return showAuthError('Usuário não encontrado.');
            }
            if (user.password !== btoa(password)) {
                 return showAuthError('Senha incorreta.');
            }
            
            // Login successful
            startUserSession(user);
        });

        // --- Registration Logic ---
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            hideAuthError();
            let isValid = true;
            
            // Get and validate inputs
            const fullNameInput = document.getElementById('reg-fullname');
            const emailInput = document.getElementById('reg-email');
            const birthdateInput = document.getElementById('reg-birthdate');
            const passwordInput = document.getElementById('reg-password');
            const termsInput = document.getElementById('reg-terms');

            // Reset errors
            [fullNameInput, emailInput, birthdateInput, passwordInput].forEach(i => setFieldError(i, null));
            
            // Validation checks
            if (!fullNameInput.value.trim()) { setFieldError(fullNameInput, 'Nome completo é obrigatório.'); isValid = false; }
            if (!validateEmail(emailInput.value)) { setFieldError(emailInput, 'Formato de e-mail inválido.'); isValid = false; }
            if (!isOver18(birthdateInput.value)) { setFieldError(birthdateInput, 'Você precisa ter mais de 18 anos.'); isValid = false; }
            if (passwordInput.value.length < 6) { setFieldError(passwordInput, 'A senha deve ter no mínimo 6 caracteres.'); isValid = false; }
            if (!termsInput.checked) { showAuthError('Você deve aceitar os Termos de Uso.'); isValid = false; }

            if (!isValid) return;

            const userData = {
                fullName: fullNameInput.value.trim(),
                email: emailInput.value.trim(),
                birthdate: birthdateInput.value,
                password: passwordInput.value,
                username: fullNameInput.value.trim().split(' ')[0] // Use first name as username
            };
            
            const { user, error } = usersDB.createUser(userData);

            if (error) {
                return showAuthError(error);
            }
            
            // Registration successful, start session immediately
            showNotification('Cadastro realizado com sucesso! Bem-vindo!', 'green');
            startUserSession(user);
        });
        
        // --- Session Management ---
        function startUserSession(user) {
            currentUser = user;
            localStorage.setItem('luccabet_current_user_v2', JSON.stringify(user));
            
            loginScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            // --- CÓDIGO EXISTENTE PARA INICIAR O APP ---
            updateUserData();
            startRandomNotifications();
            updateUserLocationTime();
            
            if (!currentUser.stats) {
                currentUser.stats = {};
                usersDB.updateUser(currentUser.email, { stats: currentUser.stats });
            }
            // Ensure betHistory is initialized
            if (!currentUser.betHistory) {
                currentUser.betHistory = [];
                usersDB.updateUser(currentUser.email, { betHistory: currentUser.betHistory });
            }
            // Ensure profileAvatar is initialized
            if (!currentUser.profileAvatar) {
                currentUser.profileAvatar = '💸';
                usersDB.updateUser(currentUser.email, { profileAvatar: currentUser.profileAvatar });
            }

            sessionStorage.setItem('luccabet_initial_balance', currentUser.balance);
            initializeStatsPanel();
            document.getElementById('toggle-stats-btn').classList.remove('hidden');

            welcomeUsername.textContent = currentUser.username;
            updateProfileUI(); // Update profile avatar and name in header
            homeTab.click();

            // Check for pending boleto payments
            checkBoletoPayments();
        }

        function checkLoggedInUser() {
            const userData = localStorage.getItem('luccabet_current_user_v2');
            if (userData) {
                const user = JSON.parse(userData);
                // Re-validate user from DB in case data is stale
                const dbUser = usersDB.findUser(user.email);
                if (dbUser) {
                    startUserSession(dbUser);
                }
            }
            // --- INICIALIZAÇÕES GLOBAIS EXISTENTES ---
            createRouletteWheel();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('luccabet_current_user_v2');
            sessionStorage.removeItem('luccabet_initial_balance');
            mainApp.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            
            document.getElementById('stats-panel').classList.add('hidden');
            document.getElementById('toggle-stats-btn').classList.add('hidden');

            loginForm.reset();
            registerForm.reset();
            showAuthView('login');
        }

        // ================================================================== //
        // END: LÓGICA DO NOVO SISTEMA DE AUTENTICAÇÃO                        //
        // ================================================================== //


        // --- O RESTANTE DO SEU CÓDIGO JAVASCRIPT PERMANECE AQUI ---
        // (Sem alterações, apenas as funções de auth acima foram substituídas/adicionadas)

        const betCooldowns = {};
        const BET_COOLDOWN_MS = 2000;
        let activeGameForStats = 'Nenhum';
        
        let generatedBonusCodes = JSON.parse(localStorage.getItem('luccabet_bonus_codes_v2') || '[]');

        // DOM Elements (rest of the app)
        const logoutBtn = document.getElementById('logout-btn');
        const userBalance = document.getElementById('user-balance');
        const welcomeUsername = document.getElementById('welcome-username');
        const welcomeBalance = document.getElementById('welcome-balance');
        const homeTab = document.getElementById('home-tab');
        const casinoTab = document.getElementById('casino-tab');
        const gamesTab = document.getElementById('games-tab');
        const exclusiveTab = document.getElementById('exclusive-tab');
        const vantagensTab = document.getElementById('vantagens-tab'); 
        const affiliateLink = document.getElementById('affiliate-link');
        const historyLink = document.getElementById('history-link'); // New
        const settingsLink = document.getElementById('settings-link'); // New
        const userMenuBtn = document.getElementById('user-menu-btn'); // New
        const welcomeSection = document.getElementById('welcome-section');
        const casinoSection = document.getElementById('casino-section');
        const gamesSection = document.getElementById('games-section');
        const exclusiveSection = document.getElementById('exclusive-section');
        const vantagensSection = document.getElementById('vantagens-section');
        const affiliateSection = document.getElementById('affiliate-section'); 
        const startPlayingBtn = document.getElementById('start-playing-btn');

        
        // Navigation Helper Function
        function handleTabClick(activeTab, activeSection) {
            const tabs = [homeTab, casinoTab, gamesTab, exclusiveTab, vantagensTab]; // Removed affiliateLink from here
            const sections = [welcomeSection, casinoSection, gamesSection, exclusiveSection, vantagensSection, affiliateSection];

            tabs.forEach(tab => tab && tab.classList.remove('bg-gray-800', 'text-green-500'));
            sections.forEach(section => section.classList.add('hidden'));

            if(activeTab) activeTab.classList.add('bg-gray-800', 'text-green-500');
            activeSection.classList.remove('hidden');
        }
        
        // Navigation Handler for Affiliate Section
        affiliateLink.addEventListener('click', (e) => {
            e.preventDefault();
            handleTabClick(null, affiliateSection); // No tab to highlight in the main nav
            document.getElementById('user-menu').classList.add('hidden'); // Hide dropdown

            // Populate Affiliate Data
            document.getElementById('affiliate-user-link').textContent = `https://luccabet.com/?ref=${currentUser.username.toUpperCase()}`;
            document.getElementById('friends-indicated').textContent = Math.floor(Math.random() * 100);
            document.getElementById('bonus-generated').textContent = `R$ ${(Math.random() * 500).toFixed(2)}`;
        });

        // Navigation between sections
        homeTab.addEventListener('click', () => handleTabClick(homeTab, welcomeSection));
        casinoTab.addEventListener('click', () => handleTabClick(casinoTab, casinoSection));
        gamesTab.addEventListener('click', () => handleTabClick(gamesTab, gamesSection));
        exclusiveTab.addEventListener('click', () => handleTabClick(exclusiveTab, exclusiveSection));
        vantagensTab.addEventListener('click', () => handleTabClick(vantagensTab, vantagensSection));

        startPlayingBtn.addEventListener('click', () => {
            gamesTab.click();
        });

        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            logout();
        });

        // Update user data in the UI
        function updateUserData(isWin = null) {
            if (!currentUser) return;
            
            // MODIFICATION: Use the new user object structure
            welcomeUsername.textContent = currentUser.username;
            const formattedBalance = `R$ ${currentUser.balance.toFixed(2)}`;
            const balanceElements = [userBalance, welcomeBalance, document.getElementById('withdraw-balance-info')];

            balanceElements.forEach(el => {
                if(el) {
                    el.textContent = formattedBalance;
                    el.classList.remove('balance-updated-win', 'balance-updated-loss', 'text-green-500');
                    
                    if (isWin === true) {
                        el.classList.add('balance-updated-win');
                        setTimeout(() => el.classList.remove('balance-updated-win'), 500);
                    } else if (isWin === false) {
                        el.classList.add('balance-updated-loss');
                         setTimeout(() => el.classList.remove('balance-updated-loss'), 500);
                    }
                    setTimeout(() => el.classList.add('text-green-500'), 500);
                }
            });
            const statsCurrentBalance = document.getElementById('stats-current-balance');
            if(statsCurrentBalance) {
                statsCurrentBalance.textContent = formattedBalance;
            }
        }

        // Update user balance (call this whenever balance changes)
        function updateUserBalance(newBalance, isWin = null) {
            if (!currentUser) return;
            
            currentUser.balance = newBalance;
            localStorage.setItem('luccabet_current_user_v2', JSON.stringify(currentUser));
            usersDB.updateUser(currentUser.email, { balance: newBalance });
            updateUserData(isWin);
        }

        // Add bet to history
        function addBetToHistory(game, betAmount, result, winLossAmount) {
            if (!currentUser) return;
            const historyEntry = {
                date: new Date().toLocaleString('pt-BR'),
                game: game,
                bet: `R$ ${betAmount.toFixed(2)}`,
                result: result,
                winLoss: `R$ ${winLossAmount.toFixed(2)}`
            };
            currentUser.betHistory.unshift(historyEntry); // Add to the beginning
            // Keep history to a reasonable size, e.g., last 50 entries
            if (currentUser.betHistory.length > 50) {
                currentUser.betHistory.pop();
            }
            usersDB.updateUser(currentUser.email, { betHistory: currentUser.betHistory });
        }

        // Sample win messages
        const winMessages = [
            "Usuário 78*****654 ganhou R$50.000  🔥",
            "Usuário 82*****121 faturou R$12.700 🔥",
            "Usuário 23*****891 acertou R$8.320  🔥",
            "Usuário 45*****112 retirou R$25.150  🔥",
            "Usuário 67*****334 multiplicou R$3.200 em 5x  🔥",
            "Usuário 91*****556 ganhou R$15.750  🔥",
            "Usuário 12*****778 faturou R$7.890  🔥"
        ];

        function startRandomNotifications() {
            setTimeout(() => {
                showRandomWinNotification();
                setInterval(showRandomWinNotification, Math.random() * 10000 + 10000);
            }, 5000);
        }

        function showRandomWinNotification() {
            const randomMessage = winMessages[Math.floor(Math.random() * winMessages.length)];
            showNotification(randomMessage, 'yellow');
        }

        function showNotification(message, color = 'red', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `floating-notification bg-gray-900 border-l-4 border-${color}-500 px-4 py-2 rounded shadow-lg text-sm flex items-center`;
            notification.innerHTML = `<span class="mr-2">${message}</span>`;
            
            const notificationsContainer = document.getElementById('notifications-container');
            notificationsContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 1s';
                setTimeout(() => notification.remove(), 1000);
            }, duration);
        }

        function initializeStatsPanel() {
            const statsPanel = document.getElementById('stats-panel');
            if(!statsPanel || !currentUser) return;

            const initialBalance = sessionStorage.getItem('luccabet_initial_balance') || currentUser.balance;
            if(document.getElementById('stats-initial-balance')) {
                 document.getElementById('stats-initial-balance').textContent = `R$ ${parseFloat(initialBalance).toFixed(2)}`;
            }
            updateStatsUI('Nenhum'); 
        }

        function updateStats(gameName, didWin) {
            if (!currentUser) return;
            
            if (!currentUser.stats[gameName]) {
                currentUser.stats[gameName] = { wins: 0, losses: 0 };
            }

            if (didWin) {
                currentUser.stats[gameName].wins++;
            } else {
                currentUser.stats[gameName].losses++;
            }

            usersDB.updateUser(currentUser.email, { stats: currentUser.stats });
            updateStatsUI(gameName); 
        }

        function updateStatsUI(gameName) {
            activeGameForStats = gameName;
            const statsPanel = document.getElementById('stats-panel');
            if (!statsPanel || !currentUser) return;

            const stats = currentUser.stats[gameName] || { wins: 0, losses: 0 };
            const wins = stats.wins;
            const losses = stats.losses;
            const totalGames = wins + losses;
            const winrate = totalGames > 0 ? (wins / totalGames) * 100 : 0;
            
            document.getElementById('stats-game-name').textContent = gameName;
            document.getElementById('stats-total-bets').textContent = totalGames;
            document.getElementById('stats-wins').textContent = wins;
            document.getElementById('stats-losses').textContent = losses;
            document.getElementById('stats-winrate').textContent = `${winrate.toFixed(2)}%`;
            document.getElementById('stats-current-balance').textContent = `R$ ${currentUser.balance.toFixed(2)}`;
        }

        // Aviator game configuration
        const aviatorConfig = {
            minBet: 1,
            maxMultiplier: 10,
            baseCrashPoint: 1.2,
            volatility: 3
        };

        let aviatorGame = {
            active: false,
            betAmount: 0,
            multiplier: 1.00,
            animationFrame: null,
            crashPoint: 0,
            startTime: 0,
            duration: 0
        };

        const avStartGameBtn = document.getElementById('av-start-game');
        const avCashOutBtn = document.getElementById('av-cash-out');
        const avBetAmountInput = document.getElementById('av-bet-amount');
        const avMultiplierDisplay = document.getElementById('av-multiplier');
        const avPotentialWinDisplay = document.getElementById('av-potential-win');
        const avStatusDisplay = document.getElementById('av-status');
        const avPlane = document.getElementById('av-plane');
        const avTrail = document.getElementById('av-trail');

        if(avStartGameBtn) avStartGameBtn.addEventListener('click', startAviator);
        if(avCashOutBtn) avCashOutBtn.addEventListener('click', cashOutAviator);

        function startAviator() {
            const gameName = 'Aviador LUCCA';
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                showNotification('Aguarde um momento entre as apostas.', 'yellow');
                return;
            }

            const bet = parseFloat(avBetAmountInput.value);
            
            if (isNaN(bet) || bet < aviatorConfig.minBet) {
                showNotification(`O valor mínimo para aposta é R$${aviatorConfig.minBet.toFixed(2)}`, 'red');
                return;
            }
            if (bet > currentUser.balance) {
                showNotification('Saldo insuficiente para esta aposta', 'red');
                return;
            }
            
            updateStatsUI(gameName);
            console.log(`[${gameName}] New Game Seed:`, Math.random());
            avStartGameBtn.disabled = true;
            betCooldowns[gameName] = Date.now();
            setTimeout(() => { if(!aviatorGame.active) avStartGameBtn.disabled = false; }, BET_COOLDOWN_MS); // Fix: Only re-enable if game is not active
            
            updateUserBalance(currentUser.balance - bet, false);
            
            aviatorGame = {
                active: true, betAmount: bet, multiplier: 1.00, crashPoint: calculateCrashPoint(),
                animationFrame: null, startTime: Date.now(), duration: 0
            };
            
            avStatusDisplay.textContent = 'O avião está decolando...';
            avStartGameBtn.classList.add('hidden');
            avCashOutBtn.classList.remove('hidden');
            avCashOutBtn.disabled = false;
            avMultiplierDisplay.textContent = '1.00x';
            avPotentialWinDisplay.textContent = `R$ ${bet.toFixed(2)}`;
            
            // Reset plane position and trail
            avPlane.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
            avTrail.style.width = '0';
            avTrail.style.backgroundColor = 'green';
            
            aviatorGame.startTime = Date.now();
            aviatorGame.animationFrame = requestAnimationFrame(updateAviatorGame);
        }

        function calculateCrashPoint() {
            const e = Math.pow(2, aviatorConfig.volatility);
            const r = Math.random() * (aviatorConfig.volatility * 0.5) + 0.5;
            return (Math.pow(e, r) - 1) / (e - 1) * (aviatorConfig.maxMultiplier - aviatorConfig.baseCrashPoint) + aviatorConfig.baseCrashPoint;
        }

        function updateAviatorGame() {
            if (!aviatorGame.active) return;
            
            const currentTime = Date.now();
            aviatorGame.duration = (currentTime - aviatorGame.startTime) / 1000;
            
            aviatorGame.multiplier = 1 + (aviatorGame.duration * 0.5) + Math.pow(aviatorGame.duration, 2) * 0.1;
            
            avMultiplierDisplay.textContent = `${Math.min(aviatorGame.multiplier, 999).toFixed(2)}x`;
            avPotentialWinDisplay.textContent = `R$ ${(aviatorGame.betAmount * aviatorGame.multiplier).toFixed(2)}`;
            
            const progress = Math.min(aviatorGame.multiplier / aviatorConfig.maxMultiplier, 1); // Use maxMultiplier for visual scaling
            const xPos = progress * 200;
            const yPos = -Math.sin(progress * Math.PI) * 50;
            
            avPlane.style.transform = `translateX(${xPos}px) translateY(${yPos}px) rotate(${progress * 10}deg)`;
            avTrail.style.width = `${xPos}px`;
            avTrail.style.height = '2px';
            avTrail.style.transform = `translateY(${yPos + 25}px)`;
            
            if (aviatorGame.multiplier >= aviatorGame.crashPoint) {
                crashAviator();
                return;
            }
            
            aviatorGame.animationFrame = requestAnimationFrame(updateAviatorGame);
        }

        function crashAviator() {
            if (!aviatorGame.active) return;
            
            cancelAnimationFrame(aviatorGame.animationFrame);
            aviatorGame.active = false;
            
            avPlane.style.transform += ' rotate(180deg)';
            avTrail.style.backgroundColor = 'red';
            
            avStatusDisplay.textContent = `O avião caiu em ${aviatorGame.crashPoint.toFixed(2)}x!`;
            showNotification(`O avião caiu em ${aviatorGame.crashPoint.toFixed(2)}x!`, 'red');
            
            updateStats('Aviador LUCCA', false);
            addBetToHistory('Aviador LUCCA', aviatorGame.betAmount, `Caiu em ${aviatorGame.crashPoint.toFixed(2)}x`, -aviatorGame.betAmount);

            setTimeout(() => {
                // Reset plane and trail to initial state for next game
                avPlane.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
                avTrail.style.width = '0';
                avTrail.style.backgroundColor = 'green';
                avStartGameBtn.classList.remove('hidden');
                avStartGameBtn.disabled = false;
                avCashOutBtn.classList.add('hidden');
                avStatusDisplay.textContent = 'Pronto para decolar!';
            }, 3000);
        }

        function cashOutAviator() {
            if (!aviatorGame.active) return;
            
            cancelAnimationFrame(aviatorGame.animationFrame);
            const winAmount = aviatorGame.betAmount * aviatorGame.multiplier;
            updateUserBalance(currentUser.balance + winAmount, true);
            
            aviatorGame.active = false;
            avCashOutBtn.disabled = true;
            avStatusDisplay.textContent = `Você retirou em ${aviatorGame.multiplier.toFixed(2)}x! Ganhou R$${winAmount.toFixed(2)}`;
            showNotification(`Você ganhou R$${winAmount.toFixed(2)} no Aviador!`, 'green');
            
            updateStats('Aviador LUCCA', true);
            addBetToHistory('Aviador LUCCA', aviatorGame.betAmount, `Retirou em ${aviatorGame.multiplier.toFixed(2)}x`, winAmount - aviatorGame.betAmount);

            avPlane.classList.add('animate-pulse');
            avTrail.style.backgroundColor = 'green';
            
            setTimeout(() => {
                // Reset plane and trail to initial state for next game
                avPlane.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
                avPlane.classList.remove('animate-pulse');
                avTrail.style.width = '0';
                avTrail.style.backgroundColor = 'green';
                avStartGameBtn.classList.remove('hidden');
                avStartGameBtn.disabled = false;
                avCashOutBtn.classList.add('hidden');
                avStatusDisplay.textContent = 'Pronto para decolar!';
            }, 3000);
        }

        // Dice Game Functions
        function rollDice() {
            const gameName = 'Dados LUCCABET';
            const rollButton = document.getElementById('dice-roll');
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                showNotification('Aguarde um momento entre as apostas.', 'yellow');
                return;
            }
            
            const bet = parseFloat(document.getElementById('dice-bet-amount').value);
            const chosenNumber = parseInt(document.getElementById('dice-number').value);
            
            if (isNaN(bet) || bet < 1) {
                showNotification('O valor mínimo para aposta é R$1,00', 'red');
                return;
            }
            if (bet > currentUser.balance) {
                showNotification('Saldo insuficiente para esta aposta', 'red');
                return;
            }

            updateStatsUI(gameName);
            console.log(`[${gameName}] New Game Seed:`, Math.random());
            rollButton.disabled = true;
            betCooldowns[gameName] = Date.now();
            setTimeout(() => { rollButton.disabled = false; }, BET_COOLDOWN_MS);

            updateUserBalance(currentUser.balance - bet, false);
            
            document.getElementById('dice-display').innerHTML = '<i class="fas fa-dice-d6 text-gray-600 animate-spin"></i>';
            document.getElementById('dice-status').textContent = 'Girando...';
            
            setTimeout(() => {
                const result = Math.floor(Math.random() * 6) + 1;
                document.getElementById('dice-display').innerHTML = `<i class="fas fa-dice-${['one', 'two', 'three', 'four', 'five', 'six'][result - 1]} text-green-500"></i>`;
                const didWin = result === chosenNumber;
                let winLossAmount = -bet;

                if (didWin) {
                    const winAmount = bet * 5;
                    winLossAmount = winAmount - bet;
                    updateUserBalance(currentUser.balance + winAmount, true);
                    document.getElementById('dice-result').textContent = `Você acertou! Ganhou R$${winAmount.toFixed(2)}`;
                    document.getElementById('dice-result').className = 'text-xl font-bold text-green-500';
                    showNotification(`Você ganhou R$${winAmount.toFixed(2)} nos Dados!`, 'green');
                } else {
                    document.getElementById('dice-result').textContent = `Você errou! Perdeu R$${bet.toFixed(2)}`;
                    document.getElementById('dice-result').className = 'text-xl font-bold text-red-500';
                }
                
                updateStats(gameName, didWin);
                addBetToHistory(gameName, bet, `Resultado: ${result} (Escolha: ${chosenNumber})`, winLossAmount);
                document.getElementById('dice-status').textContent = `O dado caiu no número ${result}`;
            }, 1500);
        }

        // Slot Machine Game
        const slotSymbols = ["🍒", "7️⃣", "💰"];
        const slotPaytable = {
            "🍒🍒🍒": 2, "7️⃣7️⃣7️⃣": 10, "💰💰💰": 15, "7️⃣7️⃣💰": 5, "7️⃣💰💰": 5, "💰💰7️⃣": 5, "💰7️⃣7️⃣": 5
        };

        let slotGame = { spinning: false, betAmount: 0, autoSpins: 0, autoSpinInterval: null };

        if(document.getElementById('spin-slot')) document.getElementById('spin-slot').addEventListener('click', () => spinSlot(false));
        if(document.getElementById('auto-spin-slot')) document.getElementById('auto-spin-slot').addEventListener('click', startAutoSpin);
        if(document.getElementById('stop-auto-spin')) document.getElementById('stop-auto-spin').addEventListener('click', stopAutoSpin);

        function spinSlot(isAuto = false) {
            const gameName = 'Caça-Níqueis LUCCABET';
            const spinButton = document.getElementById('spin-slot');

            if (!isAuto) {
                if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                    showNotification('Aguarde um momento entre as apostas.', 'yellow');
                    return;
                }
                betCooldowns[gameName] = Date.now();
                spinButton.disabled = true;
                setTimeout(() => { spinButton.disabled = false; }, BET_COOLDOWN_MS);
            }

            const bet = parseFloat(document.getElementById('slot-bet-amount').value);
            if (isNaN(bet) || bet < 1 || bet > currentUser.balance) {
                showNotification(bet > currentUser.balance ? 'Saldo insuficiente' : 'Aposta mínima R$1.00', 'red');
                if(!isAuto) { spinButton.disabled = false; }
                stopAutoSpin(); // Stop auto-spin if conditions are not met
                return;
            }
            if (slotGame.spinning) return;
            
            updateStatsUI(gameName);
            console.log(`[${gameName}] New Game Seed:`, Math.random());

            slotGame.spinning = true;
            slotGame.betAmount = bet;
            updateUserBalance(currentUser.balance - bet, false);
            
            document.getElementById('slot-current-bet').textContent = `R$ ${bet.toFixed(2)}`;
            document.getElementById('slot-win-amount').textContent = 'R$ 0,00';
            document.getElementById('slot-last-result').textContent = '-';
            document.getElementById('slot-status').textContent = 'Girando...';
            
            const reels = document.querySelectorAll('.slot-reel');
            let finalSymbols = [];
            for(let i = 0; i < 3; i++) {
                finalSymbols.push(slotSymbols[Math.floor(Math.random() * slotSymbols.length)]);
            }

            reels.forEach((reel, index) => {
                let interval = setInterval(() => {
                    reel.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                }, 50);
                setTimeout(() => {
                    clearInterval(interval);
                    reel.textContent = finalSymbols[index];
                    if (index === reels.length - 1) {
                        finishSlotSpin(finalSymbols);
                    }
                }, 1000 + index * 300);
            });
        }

        function startAutoSpin() {
            const bet = parseFloat(document.getElementById('slot-bet-amount').value);
            const spins = parseInt(document.getElementById('auto-spin-count').value);
            
            if (isNaN(bet) || bet < 1 || isNaN(spins) || spins < 1 || spins > 100) {
                showNotification('Verifique o valor da aposta e o número de giros.', 'red');
                return;
            }
             if (bet * spins > currentUser.balance) {
                showNotification('Saldo insuficiente para todos os giros automáticos.', 'red');
                return;
            }
            
            slotGame.autoSpins = spins;
            document.getElementById('slot-spins-left').textContent = spins;
            document.getElementById('auto-spin-slot').classList.add('hidden');
            document.getElementById('stop-auto-spin').classList.remove('hidden');
            
            function autoSpinLoop() {
                if(slotGame.autoSpins > 0) {
                    spinSlot(true);
                    slotGame.autoSpins--;
                    document.getElementById('slot-spins-left').textContent = slotGame.autoSpins;
                    // Ensure a delay between auto spins
                    slotGame.autoSpinInterval = setTimeout(autoSpinLoop, 2500); 
                } else {
                    stopAutoSpin();
                }
            }
            autoSpinLoop();
        }

        function stopAutoSpin() {
            clearTimeout(slotGame.autoSpinInterval);
            slotGame.autoSpins = 0;
            document.getElementById('auto-spin-slot').classList.remove('hidden');
            document.getElementById('stop-auto-spin').classList.add('hidden');
            document.getElementById('slot-spins-left').textContent = '0';
            slotGame.spinning = false; // Ensure spinning state is reset
        }

        function finishSlotSpin(result) {
            slotGame.spinning = false;
            let winMultiplier = 0;
            const key = result.join('');
            let winLossAmount = -slotGame.betAmount;
            
            if (result[0] === result[1] && result[1] === result[2]) {
                 winMultiplier = slotPaytable[key] || 0;
            } else {
                const sevenCount = result.filter(s => s === '7️⃣').length;
                const moneyCount = result.filter(s => s === '💰').length;
                // Check for combinations of 7s and Money bags
                if (sevenCount + moneyCount === 3 && (sevenCount > 0 && moneyCount > 0)) {
                     winMultiplier = slotPaytable["7️⃣7️⃣💰"]; // Use a generic prize for mixed high symbols
                }
            }
            
            const didWin = winMultiplier > 0;
            if (didWin) {
                const winAmount = slotGame.betAmount * winMultiplier;
                winLossAmount = winAmount - slotGame.betAmount;
                updateUserBalance(currentUser.balance + winAmount, true);
                document.getElementById('slot-win-amount').textContent = `R$ ${winAmount.toFixed(2)}`;
                document.getElementById('slot-last-result').textContent = 'GANHOU!';
                document.getElementById('slot-status').textContent = 'Vitória!';
            } else {
                document.getElementById('slot-win-amount').textContent = 'R$ 0,00';
                document.getElementById('slot-last-result').textContent = 'PERDEU';
                document.getElementById('slot-status').textContent = 'Sem prêmio';
            }
            updateStats('Caça-Níqueis LUCCABET', didWin);
            addBetToHistory('Caça-Níqueis LUCCABET', slotGame.betAmount, didWin ? 'Vitória' : 'Derrota', winLossAmount);
        }
        
        const rouletteNumbers = [
            { number: 0, color: 'green' }, { number: 32, color: 'red' }, { number: 15, color: 'black' }, { number: 19, color: 'red' }, { number: 4, color: 'black' },
            { number: 21, color: 'red' }, { number: 2, color: 'black' }, { number: 25, color: 'red' }, { number: 17, color: 'black' }, { number: 34, color: 'red' },
            { number: 6, color: 'black' }, { number: 27, color: 'red' }, { number: 13, color: 'black' }, { number: 36, color: 'red' }, { number: 11, color: 'black' },
            { number: 30, color: 'red' }, { number: 8, color: 'black' }, { number: 23, color: 'red' }, { number: 10, color: 'black' }, { number: 5, color: 'red' },
            { number: 24, color: 'black' }, { number: 16, color: 'red' }, { number: 33, color: 'black' }, { number: 1, color: 'red' }, { number: 20, color: 'black' },
            { number: 14, color: 'red' }, { number: 31, color: 'black' }, { number: 9, color: 'red' }, { number: 22, color: 'black' }, { number: 18, color: 'red' },
            { number: 29, color: 'black' }, { number: 7, color: 'red' }, { number: 28, color: 'black' }, { number: 12, color: 'red' }, { number: 35, color: 'black' },
            { number: 3, color: 'red' }, { number: 26, color: 'black' }
        ];

        let rouletteGame = { spinning: false, betAmount: 0, betType: null, currentRotation: 0 };
        const wheelElement = document.getElementById('roulette-wheel-graphic');
        
        function createRouletteWheel() {
            if(!wheelElement) return;
            const segmentAngle = 360 / rouletteNumbers.length;
            const colorMap = { 'red': '#ef4444', 'black': '#1f2937', 'green': '#22c55e' };
            // Update roulette colors to match Brazil theme
            const brazilColorMap = { 'red': '#009739', 'black': '#005792', 'green': '#FFD700' }; // Green, Blue, Yellow

            wheelElement.innerHTML = '';
            rouletteNumbers.forEach((item, index) => {
                const slice = document.createElement('div');
                slice.className = 'wheel-slice';
                // Calculate rotation for each slice
                const rotation = segmentAngle * index;
                // Apply rotation and skew to form the pie slice
                slice.style.transform = `rotate(${rotation}deg) skewY(${90 - segmentAngle}deg)`;
                // Set background color for the slice
                // Use Brazil colors for red/black/green
                let sliceColor = '';
                if (item.color === 'red') {
                    sliceColor = brazilColorMap['red']; // Green
                } else if (item.color === 'black') {
                    sliceColor = brazilColorMap['black']; // Blue
                } else if (item.color === 'green') {
                    sliceColor = brazilColorMap['green']; // Yellow
                }
                slice.style.backgroundColor = sliceColor;
                // Add number to the slice, rotated back to be upright
                slice.innerHTML = `<span style="transform: skewY(${-(90 - segmentAngle)}deg) rotate(${-rotation}deg);">${item.number}</span>`;
                wheelElement.appendChild(slice);
            });
        }

        document.querySelectorAll('.roulette-bet-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const gameName = 'Roleta LUCCABET';
                if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                    showNotification('Aguarde um momento entre as apostas.', 'yellow');
                    return;
                }
                if (rouletteGame.spinning) return;
                
                const bet = parseFloat(document.getElementById('roulette-bet-amount').value);
                const betType = this.dataset.betType;
                if (isNaN(bet) || bet < 1) {
                    showNotification('Aposta mínima R$1.00', 'red');
                    return;
                }
                if (bet > currentUser.balance) {
                    showNotification('Saldo insuficiente', 'red');
                    return;
                }
                
                updateStatsUI(gameName);
                console.log(`[${gameName}] New Game Seed:`, Math.random());
                betCooldowns[gameName] = Date.now();

                rouletteGame.spinning = true;
                rouletteGame.betAmount = bet;
                rouletteGame.betType = betType;
                updateUserBalance(currentUser.balance - bet, false);
                
                document.getElementById('roulette-current-bet').textContent = `R$ ${bet.toFixed(2)}`;
                document.getElementById('roulette-bet-type').textContent = this.textContent.trim();
                document.getElementById('roulette-result').textContent = '-';
                document.getElementById('roulette-win-amount').textContent = 'R$ 0,00';
                document.getElementById('roulette-status').textContent = 'Girando roleta...';
                document.querySelectorAll('.roulette-bet-btn').forEach(b => b.disabled = true);
                
                spinRoulette();
            });
        });

        function spinRoulette() {
            const winningIndex = Math.floor(Math.random() * rouletteNumbers.length);
            const winningResult = rouletteNumbers[winningIndex];

            const segmentAngle = 360 / rouletteNumbers.length;
            // Calculate target rotation to land on the winning segment
            // We want the pointer to point to the middle of the winning segment
            // The wheel rotates clockwise, so we subtract from 360
            const targetRotation = 360 - (winningIndex * segmentAngle + segmentAngle / 2); 
            const extraRotations = 360 * 5; // Ensure multiple full rotations for visual effect
            const finalRotation = rouletteGame.currentRotation + extraRotations + targetRotation;

            wheelElement.style.transform = `rotate(${finalRotation}deg)`;
            rouletteGame.currentRotation = finalRotation; // Store the new rotation for next spin

            setTimeout(() => {
                finishRouletteSpin(winningResult);
            }, 5000); // Match CSS transition duration
        }
        
        function finishRouletteSpin(result) {
            rouletteGame.spinning = false;
            
            const resultText = `${result.number} ${result.color === 'red' ? 'Vermelho' : result.color === 'black' ? 'Preto' : 'Verde'}`;
            document.getElementById('roulette-result').textContent = resultText;
            
            let hasWon = (rouletteGame.betType === result.color);
            let winLossAmount = -rouletteGame.betAmount;

            if (hasWon) {
                let winMultiplier = (result.color === 'green') ? 14 : 2;
                const winAmount = rouletteGame.betAmount * winMultiplier;
                winLossAmount = winAmount - rouletteGame.betAmount;
                updateUserBalance(currentUser.balance + winAmount, true);
                document.getElementById('roulette-win-amount').textContent = `R$ ${winAmount.toFixed(2)}`;
                document.getElementById('roulette-status').textContent = 'Você ganhou!';
            } else {
                document.getElementById('roulette-win-amount').textContent = 'R$ 0,00';
                document.getElementById('roulette-status').textContent = 'Você perdeu';
            }
            
            updateStats('Roleta LUCCABET', hasWon);
            addBetToHistory('Roleta LUCCABET', rouletteGame.betAmount, `Resultado: ${resultText}`, winLossAmount);
            document.querySelectorAll('.roulette-bet-btn').forEach(b => b.disabled = false);
        }

        // Blackjack Game
        const cardValues = { 'A': 11, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 10, 'Q': 10, 'K': 10 };
        let blackjackGame = { active: false, betAmount: 0, deck: [], dealerHand: [], playerHand: [], dealerScore: 0, playerScore: 0 };

        if(document.getElementById('blackjack-start')) document.getElementById('blackjack-start').addEventListener('click', startBlackjack);
        if(document.getElementById('blackjack-hit')) document.getElementById('blackjack-hit').addEventListener('click', hitBlackjack);
        if(document.getElementById('blackjack-stand')) document.getElementById('blackjack-stand').addEventListener('click', standBlackjack);

        function startBlackjack() {
            const gameName = 'Blackjack LUCCABET';
            const startButton = document.getElementById('blackjack-start');
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                showNotification('Aguarde um momento entre as apostas.', 'yellow');
                return;
            }

            const bet = parseFloat(document.getElementById('blackjack-bet-amount').value);
            if (isNaN(bet) || bet < 1) {
                showNotification('Aposta mínima R$1.00', 'red');
                return;
            }
            if (bet > currentUser.balance) {
                showNotification('Saldo insuficiente para esta aposta', 'red');
                return;
            }
            
            updateStatsUI(gameName);
            console.log(`[${gameName}] New Game Seed:`, Math.random());
            startButton.disabled = true;
            betCooldowns[gameName] = Date.now();
            setTimeout(() => { startButton.disabled = false; }, BET_COOLDOWN_MS); // Re-enable after cooldown

            blackjackGame = { active: true, betAmount: bet, deck: createDeck(), dealerHand: [], playerHand: [], dealerScore: 0, playerScore: 0 };
            
            updateUserBalance(currentUser.balance - bet, false);
            
            // Initial deal
            blackjackGame.playerHand.push(drawCard());
            blackjackGame.dealerHand.push(drawCard()); // Dealer's first card (visible)
            blackjackGame.playerHand.push(drawCard());
            blackjackGame.dealerHand.push(drawCard()); // Dealer's second card (hidden)
            
            updateBlackjackUI();
            
            // Check for immediate Blackjack
            if (calculateScore(blackjackGame.playerHand) === 21) {
                setTimeout(standBlackjack, 1000); // Player has Blackjack, auto-stand
            }
        }

        function createDeck() {
            const suits = ['H', 'D', 'C', 'S']; // Hearts, Diamonds, Clubs, Spades
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const deck = [];
            for (const suit of suits) { for (const value of values) { deck.push({ suit, value }); } }
            // Shuffle the deck (Fisher-Yates algorithm)
            for (let i = deck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [deck[i], deck[j]] = [deck[j], deck[i]]; }
            return deck;
        }

        function drawCard() { return blackjackGame.deck.pop(); }
        
        function calculateScore(hand) {
            let score = 0; 
            let aces = 0;
            for (const card of hand) { 
                score += cardValues[card.value]; 
                if (card.value === 'A') aces++; 
            }
            // Adjust for Aces if score is over 21
            while (score > 21 && aces > 0) { 
                score -= 10; 
                aces--; 
            }
            return score;
        }

        function hitBlackjack() {
            if (!blackjackGame.active) return;
            blackjackGame.playerHand.push(drawCard());
            updateBlackjackUI();
            if (calculateScore(blackjackGame.playerHand) > 21) {
                endBlackjack('Você estourou!'); // Player busts
            }
        }

        function standBlackjack() {
            if (!blackjackGame.active) return;
            // Dealer hits until score is 17 or more
            while(calculateScore(blackjackGame.dealerHand) < 17) {
                 blackjackGame.dealerHand.push(drawCard());
            }
            const playerScore = calculateScore(blackjackGame.playerHand);
            const dealerScore = calculateScore(blackjackGame.dealerHand);

            let result;
            if (playerScore > 21) result = 'Você estourou!'; // Should already be caught by hitBlackjack
            else if (dealerScore > 21) result = 'Dealer estourou!';
            else if (playerScore > dealerScore) result = 'Você ganhou!';
            else if (dealerScore > playerScore) result = 'Dealer ganhou!';
            else result = 'Empate!';

            // Special case for Blackjack (Ace + 10-value card on first two cards)
            if (playerScore === 21 && blackjackGame.playerHand.length === 2 && result !== 'Empate!') {
                result = 'Blackjack!';
            }

            endBlackjack(result);
        }

        function endBlackjack(resultText) {
            blackjackGame.active = false;
            let winAmount = 0;
            let didWin = false;
            let winLossAmount = -blackjackGame.betAmount;

            if (resultText === 'Blackjack!') { 
                winAmount = blackjackGame.betAmount * 2.5; // Blackjack pays 3:2
                didWin = true; 
            }
            else if (resultText === 'Você ganhou!' || resultText === 'Dealer estourou!') { 
                winAmount = blackjackGame.betAmount * 2; // Normal win pays 1:1
                didWin = true; 
            }
            else if (resultText === 'Empate!') { 
                winAmount = blackjackGame.betAmount; // Push, return bet
                winLossAmount = 0; // No loss, no gain
            }

            if (winAmount > 0) {
                updateUserBalance(currentUser.balance + winAmount, didWin);
            }
            
            // Update stats only if it's not a push
            if (resultText !== 'Empate!') {
                updateStats('Blackjack LUCCABET', didWin);
            }
            addBetToHistory('Blackjack LUCCABET', blackjackGame.betAmount, resultText, winLossAmount);

            updateBlackjackUI(true, resultText); // Show all cards and final result
            document.getElementById('blackjack-start').disabled = false; // Re-enable start button
        }

        function updateBlackjackUI(isFinished = false, resultText = '') {
            blackjackGame.playerScore = calculateScore(blackjackGame.playerHand);
            
            const dealerCardsContainer = document.getElementById('dealer-cards-container');
            const playerCardsContainer = document.getElementById('player-cards-container');
            dealerCardsContainer.innerHTML = '';
            playerCardsContainer.innerHTML = '';

            // Render player's cards
            blackjackGame.playerHand.forEach(card => {
                const c = document.createElement('div');
                c.className = 'card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl';
                c.textContent = card.value;
                playerCardsContainer.appendChild(c);
            });
             
            // Render dealer's cards
            if(isFinished) {
                blackjackGame.dealerScore = calculateScore(blackjackGame.dealerHand);
                blackjackGame.dealerHand.forEach(card => {
                    const c = document.createElement('div');
                    c.className = 'card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl';
                    c.textContent = card.value;
                    dealerCardsContainer.appendChild(c);
                });
            } else {
                // Show first card, hide second
                const c1 = document.createElement('div');
                c1.className = 'card bg-gray-700 text-white rounded-md flex items-center justify-center font-bold text-xl';
                c1.textContent = '?'; // Hidden card
                dealerCardsContainer.appendChild(c1);
                const c2 = document.createElement('div');
                c2.className = 'card bg-white text-black rounded-md flex items-center justify-center font-bold text-xl';
                c2.textContent = blackjackGame.dealerHand[1].value; // Visible card
                dealerCardsContainer.appendChild(c2);
            }

            document.getElementById('blackjack-player-score').textContent = blackjackGame.playerScore;
            document.getElementById('blackjack-dealer-score').textContent = isFinished ? blackjackGame.dealerScore : '?';
            document.getElementById('blackjack-actions').classList.toggle('hidden', isFinished); // Hide/show hit/stand buttons
            document.getElementById('blackjack-status').textContent = isFinished ? 'Fim de Jogo' : 'Sua vez';
            document.getElementById('blackjack-result').textContent = resultText;
            document.getElementById('blackjack-current-bet').textContent = `R$ ${blackjackGame.betAmount.toFixed(2)}`;
        }

        const pokerHands = {
            'ROYAL_FLUSH': 250, 'STRAIGHT_FLUSH': 50, 'FOUR_OF_A_KIND': 25, 'FULL_HOUSE': 9, 
            'FLUSH': 6, 'STRAIGHT': 4, 'THREE_OF_A_KIND': 3, 'TWO_PAIR': 2, 'JACKS_OR_BETTER': 1
        };
        let pokerGame = { active: false, betAmount: 0, deck: [], hand: [], heldCardsIndexes: [] };

        if(document.getElementById('poker-deal')) document.getElementById('poker-deal').addEventListener('click', dealPoker);
        if(document.getElementById('poker-draw')) document.getElementById('poker-draw').addEventListener('click', drawPoker);

        function dealPoker() {
            const gameName = 'Video Poker LUCCABET';
            const dealButton = document.getElementById('poker-deal');
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                showNotification('Aguarde um momento entre as apostas.', 'yellow');
                return;
            }

            const bet = parseFloat(document.getElementById('poker-bet-amount').value);
            if (pokerGame.active) return; // Prevent dealing if game is already active
            if (isNaN(bet) || bet < 1) {
                showNotification('Aposta mínima R$1.00', 'red');
                return;
            }
            if (bet > currentUser.balance) {
                showNotification('Saldo insuficiente', 'red');
                return;
            }
            
            updateStatsUI(gameName);
            console.log(`[${gameName}] New Game Seed:`, Math.random());
            betCooldowns[gameName] = Date.now();

            pokerGame = { active: true, betAmount: bet, deck: createPokerDeck(), hand: [], heldCardsIndexes: [] };
            updateUserBalance(currentUser.balance - bet, false);
            
            // Deal initial 5 cards
            for (let i = 0; i < 5; i++) pokerGame.hand.push(pokerGame.deck.pop());
            
            updatePokerUI();
            dealButton.classList.add('hidden');
            dealButton.disabled = true;
            document.getElementById('poker-draw').classList.remove('hidden');
            document.getElementById('poker-draw').disabled = false;
        }

        function createPokerDeck() {
            const suits = ['♠', '♥', '♦', '♣']; 
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            let deck = [];
            for (const suit of suits) { for (const value of values) { deck.push({ suit, value }); } }
            // Shuffle the deck
            for (let i = deck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [deck[i], deck[j]] = [deck[j], deck[i]]; }
            return deck;
        }

        function drawPoker() {
            if (!pokerGame.active) return;
            
            // Replace non-held cards
            for (let i = 0; i < 5; i++) {
                if (!pokerGame.heldCardsIndexes.includes(i)) {
                    pokerGame.hand[i] = pokerGame.deck.pop();
                }
            }
            
            const handEvaluation = evaluatePokerHand(pokerGame.hand);
            const handRank = handEvaluation.name;
            const winMultiplier = pokerHands[handRank] || 0;
            const didWin = winMultiplier > 0;
            let winLossAmount = -pokerGame.betAmount;
            
            if (didWin) {
                const winAmount = pokerGame.betAmount * winMultiplier;
                winLossAmount = winAmount - pokerGame.betAmount;
                updateUserBalance(currentUser.balance + winAmount, true);
                updatePokerUI(true, handRank, winAmount, handEvaluation.highlightedIndexes);
            } else {
                 updatePokerUI(true, handRank, 0, handEvaluation.highlightedIndexes);
            }
            
            updateStats('Video Poker LUCCABET', didWin);
            addBetToHistory('Video Poker LUCCABET', pokerGame.betAmount, formatPokerHand(handRank), winLossAmount);
            pokerGame.active = false;
            
            // Reset buttons for next round
            const dealButton = document.getElementById('poker-deal');
            dealButton.classList.remove('hidden');
            dealButton.disabled = false;
            document.getElementById('poker-draw').classList.add('hidden');
            document.getElementById('poker-draw').disabled = true;
        }
        
        function updatePokerUI(isFinished = false, handRank = 'NONE', winAmount = 0, highlightedIndexes = []) {
            document.getElementById('poker-current-bet').textContent = `R$ ${pokerGame.betAmount.toFixed(2)}`;
            document.getElementById('poker-status').textContent = isFinished ? 'Fim do Jogo' : 'Segure as cartas desejadas';
            document.getElementById('poker-hand').textContent = isFinished ? formatPokerHand(handRank) : '-';
            document.getElementById('poker-win-amount').textContent = isFinished ? `R$ ${winAmount.toFixed(2)}` : 'R$ 0.00';

            const pokerHandEl = document.querySelector('.poker-hand');
            pokerHandEl.innerHTML = '';
            
            pokerGame.hand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                const isHeld = pokerGame.heldCardsIndexes.includes(index);
                const isHighlighted = highlightedIndexes.includes(index);
                
                let cardClasses = 'card bg-white rounded-md flex items-center justify-center font-bold text-xl transition-all duration-200';
                cardClasses += (card.suit === '♥' || card.suit === '♦') ? ' text-red-600' : ' text-black';
                cardClasses += pokerGame.active ? ' cursor-pointer' : ' cursor-default';
                
                if (isFinished && isHighlighted) {
                     cardClasses += ' border-4 border-green-500 scale-105';
                } else if (isHeld) {
                    cardClasses += ' border-4 border-yellow-400 transform -translate-y-2';
                } else {
                    cardClasses += ' border-4 border-transparent';
                }
                
                cardEl.className = cardClasses;
                cardEl.textContent = `${card.value}${card.suit}`;
                
                cardEl.addEventListener('click', () => {
                    if (pokerGame.active) { // Only allow holding if game is active (after deal, before draw)
                        const idx = pokerGame.heldCardsIndexes.indexOf(index);
                        if (idx > -1) {
                            pokerGame.heldCardsIndexes.splice(idx, 1); // Unhold
                        } else {
                            pokerGame.heldCardsIndexes.push(index); // Hold
                        }
                        updatePokerUI(); // Re-render to show hold state
                    }
                });
                pokerHandEl.appendChild(cardEl);
            });
        }

        function evaluatePokerHand(hand) {
            // Helper to map card values to a sortable order (T for 10)
            const cardOrder = '23456789TJQKA'; 
            const values = hand.map(c => c.value === '10' ? 'T' : c.value).sort((a, b) => cardOrder.indexOf(a) - cardOrder.indexOf(b));
            const suits = hand.map(c => c.suit);

            // Count occurrences of each card value
            const valueCounts = values.reduce((acc, v) => ({ ...acc, [v]: (acc[v] || 0) + 1 }), {});
            // Get counts and sort them descending (e.g., [3, 1, 1] for Three of a Kind)
            const counts = Object.values(valueCounts).sort((a,b) => b-a);
            
            // Check for Flush (all same suit)
            const isFlush = new Set(suits).size === 1;
            // Check for Straight (consecutive values)
            // Handle A-5 straight (A,2,3,4,5) as a special case
            const isStraight = values.every((v, i) => i === 0 || cardOrder.indexOf(v) === cardOrder.indexOf(values[i-1]) + 1) || 
                               (JSON.stringify(values.map(v=>cardOrder.indexOf(v)).sort((a,b)=>a-b)) === JSON.stringify([0,1,2,3,12])); // A,2,3,4,5 (A is 12 in cardOrder)
            
            // Helper to get original indexes of cards with a specific value
            function getIndexesForValue(val) {
                const targetValue = val === 'T' ? '10' : val;
                return hand.map((card, i) => card.value === targetValue ? i : -1).filter(i => i !== -1);
            }

            // Evaluate hands in descending order of rank
            if (isStraight && isFlush) {
                const highCard = values[4];
                return { name: highCard === 'A' ? 'ROYAL_FLUSH' : 'STRAIGHT_FLUSH', highlightedIndexes: [0,1,2,3,4] };
            }
            if (counts[0] === 4) {
                const quadValue = Object.keys(valueCounts).find(k => valueCounts[k] === 4);
                return { name: 'FOUR_OF_A_KIND', highlightedIndexes: getIndexesForValue(quadValue) };
            }
            if (counts[0] === 3 && counts[1] === 2) {
                return { name: 'FULL_HOUSE', highlightedIndexes: [0,1,2,3,4] };
            }
            if (isFlush) return { name: 'FLUSH', highlightedIndexes: [0,1,2,3,4] };
            if (isStraight) return { name: 'STRAIGHT', highlightedIndexes: [0,1,2,3,4] };
            if (counts[0] === 3) {
                const triValue = Object.keys(valueCounts).find(k => valueCounts[k] === 3);
                return { name: 'THREE_OF_A_KIND', highlightedIndexes: getIndexesForValue(triValue) };
            }
            if (counts[0] === 2 && counts[1] === 2) {
                const pairValues = Object.keys(valueCounts).filter(k => valueCounts[k] === 2);
                return { name: 'TWO_PAIR', highlightedIndexes: [...getIndexesForValue(pairValues[0]), ...getIndexesForValue(pairValues[1])] };
            }
            if (counts[0] === 2) {
                const pairValue = Object.keys(valueCounts).find(k => valueCounts[k] === 2);
                // Jacks or Better requires a pair of Jacks, Queens, Kings, or Aces
                if (['J', 'Q', 'K', 'A'].includes(pairValue)) {
                    return { name: 'JACKS_OR_BETTER', highlightedIndexes: getIndexesForValue(pairValue) };
                }
            }
            return { name: 'NONE', highlightedIndexes: [] };
        }

        function formatPokerHand(handRank) {
            const names = {
                'ROYAL_FLUSH':'Royal Flush',
                'STRAIGHT_FLUSH':'Straight Flush',
                'FOUR_OF_A_KIND':'Quadra',
                'FULL_HOUSE':'Full House',
                'FLUSH':'Flush',
                'STRAIGHT':'Sequência',
                'THREE_OF_A_KIND':'Trinca',
                'TWO_PAIR':'Dois Pares',
                'JACKS_OR_BETTER':'Par de Valetes ou Maior',
                'NONE':'Sem combinação'
            };
            return names[handRank] || 'Desconhecido';
        }

        // Mines Game Functions
        let minesGameState = { active: false, betAmount: 0, minesCount: 0, safeCellsClicked: 0, multiplier: 1, minesPositions: [], revealedCells: [] };
        // Multiplier values based on number of mines
        const minesMultiplierValues = { 1:1.10, 2:1.25, 3:1.40, 4:1.60, 5:2.00, 6:2.50, 7:3.00, 8:3.50, 9:3.75, 10:4.00 };

        if(document.getElementById('start-game')) document.getElementById('start-game').addEventListener('click', startGame);
        if(document.getElementById('cash-out')) document.getElementById('cash-out').addEventListener('click', () => cashOut(false));

        function startGame() {
            const gameName = 'Campo Minado';
            const startButton = document.getElementById('start-game');
            if (Date.now() - (betCooldowns[gameName] || 0) < BET_COOLDOWN_MS) {
                showNotification('Aguarde um momento entre as apostas.', 'yellow');
                return;
            }

            const bet = parseFloat(document.getElementById('bet-amount').value);
            const mines = parseInt(document.getElementById('mines-count').value);
            if (isNaN(bet) || bet < 1) {
                showNotification('Aposta mínima de R$1,00', 'red');
                return;
            }
            if (bet > currentUser.balance) {
                showNotification('Saldo insuficiente', 'red');
                return;
            }
            
            updateStatsUI(gameName);
            console.log(`[${gameName}] New Game Seed:`, Math.random());
            startButton.disabled = true;
            betCooldowns[gameName] = Date.now();
            setTimeout(() => { if (!minesGameState.active) startButton.disabled = false; }, BET_COOLDOWN_MS);

            updateUserBalance(currentUser.balance - bet, false);
            minesGameState = { active: true, betAmount: bet, minesCount: mines, safeCellsClicked: 0, multiplier: minesMultiplierValues[mines], minesPositions: [], revealedCells: [] };
            
            // Generate unique random positions for mines
            while (minesGameState.minesPositions.length < mines) {
                const randomPos = Math.floor(Math.random() * 25); // 25 cells in a 5x5 grid
                if (!minesGameState.minesPositions.includes(randomPos)) minesGameState.minesPositions.push(randomPos);
            }
            
            document.getElementById('current-bet').textContent = `R$ ${bet.toFixed(2)}`;
            document.getElementById('current-mines').textContent = mines;
            document.getElementById('safe-clicks').textContent = '0';
            document.getElementById('current-multiplier').textContent = `${minesGameState.multiplier.toFixed(2)}x`;
            document.getElementById('potential-win').textContent = `R$ ${(bet * minesGameState.multiplier).toFixed(2)}`;
            document.getElementById('game-status').textContent = 'Jogo em andamento';
            document.getElementById('game-status').className = 'text-sm px-3 py-1 bg-yellow-600 rounded-full';
            document.getElementById('cash-out').classList.remove('hidden');
            renderGameBoard();
        }

        function renderGameBoard() {
            const gameBoard = document.getElementById('game-board');
            if(!gameBoard) return;
            gameBoard.innerHTML = ''; // Clear previous board
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell bg-gray-800 h-16 rounded flex items-center justify-center cursor-pointer font-bold text-xl border border-gray-700 hover:bg-gray-700';
                cell.dataset.index = i;
                
                if (minesGameState.revealedCells.includes(i)) {
                    // If cell is revealed, show content
                    cell.innerHTML = minesGameState.minesPositions.includes(i) ? '<i class="fas fa-bomb text-red-500"></i>' : '💎';
                    cell.className = `cell h-16 rounded flex items-center justify-center font-bold text-xl border ${minesGameState.minesPositions.includes(i) ? 'bg-red-900 border-red-700' : 'bg-green-900 border-green-700'}`;
                } else if (minesGameState.active) {
                    // Only add click listener if game is active and cell is not revealed
                    cell.addEventListener('click', () => revealCell(i));
                }
                gameBoard.appendChild(cell);
            }
        }

        function revealCell(index) {
            if (!minesGameState.active || minesGameState.revealedCells.includes(index)) return;
            minesGameState.revealedCells.push(index);
            
            let winLossAmount = -minesGameState.betAmount; // Default to loss

            if (minesGameState.minesPositions.includes(index)) {
                // Hit a mine - game over
                minesGameState.active = false;
                document.getElementById('game-status').textContent = 'Você perdeu!';
                document.getElementById('game-status').className = 'text-sm px-3 py-1 bg-red-600 rounded-full';
                document.getElementById('cash-out').classList.add('hidden');
                document.getElementById('start-game').disabled = false; // Re-enable start button
                updateStats('Campo Minado', false);
                addBetToHistory('Campo Minado', minesGameState.betAmount, 'Perdeu (Mina)', winLossAmount);
                // Reveal all mines at the end of the game
                minesGameState.minesPositions.forEach(pos => {
                    if (!minesGameState.revealedCells.includes(pos)) {
                        minesGameState.revealedCells.push(pos);
                    }
                });
                renderGameBoard();
            } else {
                // Safe cell - increase multiplier
                minesGameState.safeCellsClicked++;
                // Multiplier increases based on initial mines count
                minesGameState.multiplier += 0.1 * minesGameState.minesCount; 
                document.getElementById('safe-clicks').textContent = minesGameState.safeCellsClicked;
                document.getElementById('current-multiplier').textContent = `${minesGameState.multiplier.toFixed(2)}x`;
                document.getElementById('potential-win').textContent = `R$ ${(minesGameState.betAmount * minesGameState.multiplier).toFixed(2)}`;
                renderGameBoard();
                // If all non-mine cells are revealed, auto cash out
                if (minesGameState.revealedCells.length + minesGameState.minesCount === 25) {
                    cashOut(true);
                }
            }
        }

        function cashOut(allRevealed) {
            if (!minesGameState.active) return;
            const winAmount = minesGameState.betAmount * minesGameState.multiplier;
            const winLossAmount = winAmount - minesGameState.betAmount;
            updateUserBalance(currentUser.balance + winAmount, true);
            minesGameState.active = false;
            document.getElementById('game-status').textContent = allRevealed ? 'Todos revelados!' : 'Você retirou!';
            document.getElementById('game-status').className = 'text-sm px-3 py-1 bg-green-600 rounded-full';
            document.getElementById('cash-out').classList.add('hidden');
            document.getElementById('start-game').disabled = false; // Re-enable start button
            updateStats('Campo Minado', true);
            addBetToHistory('Campo Minado', minesGameState.betAmount, `Retirou em ${minesGameState.multiplier.toFixed(2)}x`, winLossAmount);
            // Reveal remaining cells for visual clarity
            for (let i = 0; i < 25; i++) {
                if (!minesGameState.revealedCells.includes(i)) {
                    minesGameState.revealedCells.push(i);
                }
            }
            renderGameBoard();
        }

        // --- START: Double Crash Game Logic ---
        const doubleCrashConfig = {
            minBet: 1,
            maxMultiplier: 100, // Max possible multiplier for a single graph
            baseCrashPoint: 1.01, // Minimum crash point
            volatility: 3 // Higher volatility means more unpredictable crashes
        };

        let doubleCrashGame = {
            active: false,
            betAmount: 0,
            graphs: [
                { id: 1, multiplier: 1.00, crashPoint: 0, crashed: false, betPlaced: false, cashedOut: false, betAmount: 0 },
                { id: 2, multiplier: 1.00, crashPoint: 0, crashed: false, betPlaced: false, cashedOut: false, betAmount: 0 }
            ],
            animationFrame: null,
            startTime: 0,
            duration: 0,
            totalBets: 0 // To track if any bets are placed
        };

        // DOM Elements for Double Crash
        const dcBetAmountInput = document.getElementById('dc-bet-amount');
        const dcBetGraph1Btn = document.getElementById('dc-bet-graph1');
        const dcBetGraph2Btn = document.getElementById('dc-bet-graph2');
        const dcBetBothBtn = document.getElementById('dc-bet-both');
        const dcCashOutGraph1Btn = document.getElementById('dc-cash-out-graph1');
        const dcCashOutGraph2Btn = document.getElementById('dc-cash-out-graph2');

        const dcCurrentBetGraph1 = document.getElementById('dc-current-bet-graph1');
        const dcCurrentBetGraph2 = document.getElementById('dc-current-bet-graph2');
        const dcMultiplierGraph1 = document.getElementById('dc-multiplier-graph1');
        const dcMultiplierGraph2 = document.getElementById('dc-multiplier-graph2');
        const dcPotentialWinGraph1 = document.getElementById('dc-potential-win-graph1');
        const dcPotentialWinGraph2 = document.getElementById('dc-potential-win-graph2');
        const dcOverallStatus = document.getElementById('dc-overall-status');

        const crashGraph1El = document.getElementById('crash-graph-1');
        const crashMultiplier1El = document.getElementById('crash-multiplier-1');
        const crashStatusOverlay1El = document.getElementById('crash-status-overlay-1');
        const crashGraph2El = document.getElementById('crash-graph-2');
        const crashMultiplier2El = document.getElementById('crash-multiplier-2');
        const crashStatusOverlay2El = document.getElementById('crash-status-overlay-2');

        // Event Listeners for Double Crash
        if(dcBetGraph1Btn) dcBetGraph1Btn.addEventListener('click', () => placeDoubleCrashBet(1));
        if(dcBetGraph2Btn) dcBetGraph2Btn.addEventListener('click', () => placeDoubleCrashBet(2));
        if(dcBetBothBtn) dcBetBothBtn.addEventListener('click', () => placeDoubleCrashBet(0)); // 0 for both
        if(dcCashOutGraph1Btn) dcCashOutGraph1Btn.addEventListener('click', () => cashOutDoubleCrash(1));
        if(dcCashOutGraph2Btn) dcCashOutGraph2Btn.addEventListener('click', () => cashOutDoubleCrash(2));

        function calculateDoubleCrashPoint() {
            // Generates a random crash point for a graph
            // Uses a logarithmic distribution to favor lower multipliers but allow high ones
            const random = Math.random();
            const crashPoint = doubleCrashConfig.baseCrashPoint + Math.log(random * (Math.exp(doubleCrashConfig.volatility) - 1) + 1) / doubleCrashConfig.volatility * (doubleCrashConfig.maxMultiplier - doubleCrashConfig.baseCrashPoint);
            return Math.max(doubleCrashConfig.baseCrashPoint, crashPoint); // Ensure it's at least baseCrashPoint
        }

        function resetDoubleCrashUI() {
            // Resets the UI elements for a new round
            dcBetAmountInput.value = doubleCrashConfig.minBet;
            dcBetAmountInput.disabled = false;

            dcBetGraph1Btn.disabled = false;
            dcBetGraph2Btn.disabled = false;
            dcBetBothBtn.disabled = false;

            dcCashOutGraph1Btn.disabled = true;
            dcCashOutGraph2Btn.disabled = true;
            dcCashOutGraph1Btn.textContent = 'Retirar G1';
            dcCashOutGraph2Btn.textContent = 'Retirar G2';
            dcCashOutGraph1Btn.classList.remove('bg-gray-600', 'bg-red-600');
            dcCashOutGraph1Btn.classList.add('bg-green-600', 'hover:bg-green-700');
            dcCashOutGraph2Btn.classList.remove('bg-gray-600', 'bg-red-600');
            dcCashOutGraph2Btn.classList.add('bg-green-600', 'hover:bg-green-700');


            dcCurrentBetGraph1.textContent = 'R$ 0,00';
            dcCurrentBetGraph2.textContent = 'R$ 0,00';
            dcMultiplierGraph1.textContent = '1.00x';
            dcMultiplierGraph2.textContent = '1.00x';
            dcPotentialWinGraph1.textContent = 'R$ 0,00';
            dcPotentialWinGraph2.textContent = 'R$ 0,00';
            dcOverallStatus.textContent = 'Aguardando apostas...';

            crashGraph1El.style.transform = 'scaleY(0)';
            crashGraph1El.classList.remove('crashed');
            crashMultiplier1El.textContent = '1.00x';
            crashMultiplier1El.classList.remove('crashed');
            crashStatusOverlay1El.classList.add('hidden');

            crashGraph2El.style.transform = 'scaleY(0)';
            crashGraph2El.classList.remove('crashed');
            crashMultiplier2El.textContent = '1.00x';
            crashMultiplier2El.classList.remove('crashed');
            crashStatusOverlay2El.classList.add('hidden');
        }

        function placeDoubleCrashBet(graphIndex) {
            const gameName = 'Double Crash LUCCA';
            if (doubleCrashGame.active) {
                showNotification('O jogo já está em andamento. Aguarde a próxima rodada.', 'yellow');
                return;
            }

            const bet = parseFloat(dcBetAmountInput.value);
            if (isNaN(bet) || bet < doubleCrashConfig.minBet) {
                showNotification(`A aposta mínima é R$${doubleCrashConfig.minBet.toFixed(2)}`, 'red');
                return;
            }

            let cost = 0;
            if (graphIndex === 0) { // Bet on both
                cost = bet * 2;
            } else {
                cost = bet;
            }

            if (cost > currentUser.balance) {
                showNotification('Saldo insuficiente para esta aposta.', 'red');
                return;
            }

            // Deduct bet amount
            updateUserBalance(currentUser.balance - cost, false);

            // Initialize game state if first bet
            if (doubleCrashGame.totalBets === 0) {
                doubleCrashGame.active = true;
                doubleCrashGame.startTime = Date.now();
                doubleCrashGame.graphs[0].crashPoint = calculateDoubleCrashPoint();
                doubleCrashGame.graphs[1].crashPoint = calculateDoubleCrashPoint();
                dcOverallStatus.textContent = 'Jogo iniciado!';
                doubleCrashGame.animationFrame = requestAnimationFrame(updateDoubleCrashGame);
            }

            // Assign bet to specific graph(s)
            if (graphIndex === 1 || graphIndex === 0) {
                doubleCrashGame.graphs[0].betPlaced = true;
                doubleCrashGame.graphs[0].betAmount = bet;
                dcCurrentBetGraph1.textContent = `R$ ${bet.toFixed(2)}`;
                dcCashOutGraph1Btn.disabled = false;
            }
            if (graphIndex === 2 || graphIndex === 0) {
                doubleCrashGame.graphs[1].betPlaced = true;
                doubleCrashGame.graphs[1].betAmount = bet;
                dcCurrentBetGraph2.textContent = `R$ ${bet.toFixed(2)}`;
                dcCashOutGraph2Btn.disabled = false;
            }
            
            doubleCrashGame.totalBets++;
            dcBetAmountInput.disabled = true; // Disable bet amount input once game starts
            dcBetGraph1Btn.disabled = true;
            dcBetGraph2Btn.disabled = true;
            dcBetBothBtn.disabled = true;

            updateStatsUI(gameName);
            console.log(`[${gameName}] New Round Started. Graph 1 Crash: ${doubleCrashGame.graphs[0].crashPoint.toFixed(2)}x, Graph 2 Crash: ${doubleCrashGame.graphs[1].crashPoint.toFixed(2)}x`);
        }

        function updateDoubleCrashGame() {
            if (!doubleCrashGame.active) return;

            const currentTime = Date.now();
            doubleCrashGame.duration = (currentTime - doubleCrashGame.startTime) / 1000;

            let allCrashedOrCashedOut = true;

            doubleCrashGame.graphs.forEach((graph, index) => {
                if (graph.crashed || graph.cashedOut) {
                    // If already crashed or cashed out, no need to update
                    return;
                }

                // Calculate multiplier based on time (can be adjusted for different curves)
                graph.multiplier = 1 + (doubleCrashGame.duration * 0.5) + Math.pow(doubleCrashGame.duration, 2) * 0.1;
                graph.multiplier = Math.min(graph.multiplier, doubleCrashConfig.maxMultiplier); // Cap at max multiplier

                const multiplierDisplay = index === 0 ? dcMultiplierGraph1 : dcMultiplierGraph2;
                const potentialWinDisplay = index === 0 ? dcPotentialWinGraph1 : dcPotentialWinGraph2;
                const graphEl = index === 0 ? crashGraph1El : crashGraph2El;
                const multiplierTextEl = index === 0 ? crashMultiplier1El : crashMultiplier2El;

                multiplierDisplay.textContent = `${graph.multiplier.toFixed(2)}x`;
                potentialWinDisplay.textContent = `R$ ${(graph.betAmount * graph.multiplier).toFixed(2)}`;

                // Update graph visual (scaleY based on multiplier)
                const scaleY = Math.min(graph.multiplier / (doubleCrashConfig.maxMultiplier / 2), 1); // Scale from 0 to 1
                graphEl.style.transform = `scaleY(${scaleY})`;
                multiplierTextEl.textContent = `${graph.multiplier.toFixed(2)}x`;

                // Check for crash
                if (graph.multiplier >= graph.crashPoint) {
                    crashDoubleCrash(index + 1); // Pass 1 or 2 for graph index
                } else {
                    allCrashedOrCashedOut = false; // At least one graph is still active
                }
            });

            // If all graphs have either crashed or been cashed out, end the round
            if (allCrashedOrCashedOut) {
                endDoubleCrashRound();
            } else {
                doubleCrashGame.animationFrame = requestAnimationFrame(updateDoubleCrashGame);
            }
        }

        function cashOutDoubleCrash(graphIndex) {
            const graph = doubleCrashGame.graphs[graphIndex - 1];
            if (!graph.betPlaced || graph.crashed || graph.cashedOut) {
                showNotification('Não há aposta ativa para retirar neste gráfico.', 'red');
                return;
            }

            const winAmount = graph.betAmount * graph.multiplier;
            const winLossAmount = winAmount - graph.betAmount;
            updateUserBalance(currentUser.balance + winAmount, true);
            graph.cashedOut = true;

            const cashOutBtn = graphIndex === 1 ? dcCashOutGraph1Btn : dcCashOutGraph2Btn;
            cashOutBtn.disabled = true;
            cashOutBtn.textContent = `Retirado ${graph.multiplier.toFixed(2)}x`;
            cashOutBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            cashOutBtn.classList.add('bg-gray-600');

            const multiplierDisplay = graphIndex === 1 ? dcMultiplierGraph1 : dcMultiplierGraph2;
            multiplierDisplay.classList.add('text-yellow-400'); // Indicate cashed out

            showNotification(`Você retirou R$${winAmount.toFixed(2)} do Gráfico ${graphIndex} em ${graph.multiplier.toFixed(2)}x!`, 'green');
            updateStats('Double Crash LUCCA', true);
            addBetToHistory('Double Crash LUCCA', graph.betAmount, `Retirou G${graphIndex} @ ${graph.multiplier.toFixed(2)}x`, winLossAmount);

            // Check if all graphs are now finished (crashed or cashed out)
            if (doubleCrashGame.graphs.every(g => g.crashed || g.cashedOut)) {
                endDoubleCrashRound();
            }
        }

        function crashDoubleCrash(graphIndex) {
            const graph = doubleCrashGame.graphs[graphIndex - 1];
            if (graph.crashed || graph.cashedOut) return; // Already crashed or cashed out

            graph.crashed = true;
            const graphEl = graphIndex === 1 ? crashGraph1El : crashGraph2El;
            const multiplierTextEl = graphIndex === 1 ? crashMultiplier1El : crashMultiplier2El;
            const statusOverlayEl = graphIndex === 1 ? crashStatusOverlay1El : crashStatusOverlay2El;
            const cashOutBtn = graphIndex === 1 ? dcCashOutGraph1Btn : dcCashOutGraph2Btn;

            graphEl.classList.add('crashed');
            multiplierTextEl.classList.add('crashed');
            statusOverlayEl.classList.remove('hidden');
            statusOverlayEl.textContent = `CRASHED @ ${graph.crashPoint.toFixed(2)}x`;
            
            cashOutBtn.disabled = true; // Cannot cash out after crash
            cashOutBtn.textContent = `Crashed`;
            cashOutBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            cashOutBtn.classList.add('bg-red-600');

            if (graph.betPlaced && !graph.cashedOut) {
                // Player lost bet on this graph
                showNotification(`Gráfico ${graphIndex} caiu em ${graph.crashPoint.toFixed(2)}x! Você perdeu R$${graph.betAmount.toFixed(2)}`, 'red');
                updateStats('Double Crash LUCCA', false);
                addBetToHistory('Double Crash LUCCA', graph.betAmount, `Crashed G${graphIndex} @ ${graph.crashPoint.toFixed(2)}x`, -graph.betAmount);
            } else if (!graph.betPlaced) {
                // No bet placed on this graph, just notify crash
                showNotification(`Gráfico ${graphIndex} caiu em ${graph.crashPoint.toFixed(2)}x!`, 'yellow');
            }

            // Check if all graphs are now finished (crashed or cashed out)
            if (doubleCrashGame.graphs.every(g => g.crashed || g.cashedOut)) {
                endDoubleCrashRound();
            }
        }

        function endDoubleCrashRound() {
            if (!doubleCrashGame.active) return;

            cancelAnimationFrame(doubleCrashGame.animationFrame);
            doubleCrashGame.active = false;
            doubleCrashGame.totalBets = 0; // Reset total bets for next round

            dcOverallStatus.textContent = 'Rodada finalizada. Aguardando novas apostas...';

            // Reset game state for next round after a delay
            setTimeout(() => {
                doubleCrashGame.graphs.forEach(graph => {
                    graph.multiplier = 1.00;
                    graph.crashed = false;
                    graph.betPlaced = false;
                    graph.cashedOut = false;
                    graph.betAmount = 0;
                });
                resetDoubleCrashUI();
            }, 5000); // Wait 5 seconds before resetting UI for next round
        }
        // --- END: Double Crash Game Logic ---


        // Initialize App
        checkLoggedInUser();

        // Close user menu when clicking outside
        document.addEventListener('click', (e) => {
            const userMenu = document.getElementById('user-menu');
            const userMenuBtn = document.getElementById('user-menu-btn');
            if (userMenuBtn && userMenu && !userMenu.contains(e.target) && !userMenuBtn.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Toggle user menu
        userMenuBtn.addEventListener('click', () => {
            document.getElementById('user-menu').classList.toggle('hidden');
        });

        // Deposit Modal
        document.getElementById('deposit-btn').addEventListener('click', () => {
            document.getElementById('deposit-modal').classList.remove('hidden');
            // Ensure PIX is selected by default and its section is visible
            document.getElementById('payment-method').value = 'pix';
            document.getElementById('pix-info-section').classList.remove('hidden');
            document.getElementById('boleto-info-section').classList.add('hidden');
            document.getElementById('cartao-info-section').classList.add('hidden');
            document.getElementById('confirm-deposit').classList.remove('hidden'); // Ensure confirm button is visible
        });
        document.getElementById('close-deposit-modal').addEventListener('click', () => {
            document.getElementById('deposit-modal').classList.add('hidden');
        });

        document.getElementById('payment-method').addEventListener('change', (e) => {
            document.getElementById('pix-info-section').classList.add('hidden');
            document.getElementById('boleto-info-section').classList.add('hidden');
            document.getElementById('cartao-info-section').classList.add('hidden');
            document.getElementById('confirm-deposit').classList.remove('hidden'); // Show confirm button by default

            if(e.target.value === 'pix') {
                document.getElementById('pix-info-section').classList.remove('hidden');
            } else if (e.target.value === 'boleto') {
                renderBoletoForm();
                document.getElementById('boleto-info-section').classList.remove('hidden');
                document.getElementById('confirm-deposit').classList.add('hidden'); // Hide default confirm for boleto
            } else if (e.target.value === 'cartao') {
                renderCreditCardForm();
                document.getElementById('cartao-info-section').classList.remove('hidden');
            }
        });

        document.getElementById('copy-pix').addEventListener('click', () => {
            const pixKey = document.getElementById('pix-key').textContent;
            navigator.clipboard.writeText(pixKey);
            const copyBtn = document.getElementById('copy-pix');
            const originalIcon = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check text-green-500"></i>';
            setTimeout(() => {
                copyBtn.innerHTML = originalIcon;
            }, 2000);
        });
        
        function handleDeposit() {
            const amountInput = document.getElementById('deposit-amount');
            const amount = parseFloat(amountInput.value);
            const paymentMethod = document.getElementById('payment-method').value;

            if (isNaN(amount) || amount < 10) {
                showNotification('O valor mínimo de depósito é R$10,00.', 'red');
                return;
            }

            let transaction = {
                id: `TRX${Date.now()}-${Math.floor(Math.random() * 1000)}`,
                userId: currentUser.email,
                amount: amount,
                date: new Date().toISOString(),
                status: 'Aprovado',
                type: 'Depósito',
                method: paymentMethod
            };

            if (paymentMethod === 'pix') {
                updateUserBalance(currentUser.balance + amount, true);
                showNotification(`Depósito de R$${amount.toFixed(2)} via PIX confirmado!`, 'green');
                showReceipt('Depósito - PIX', amount, 'Aprovado', transaction.id);
                saveTransaction(transaction);
                document.getElementById('deposit-modal').classList.add('hidden');
                amountInput.value = ''; 
            } else if (paymentMethod === 'cartao') {
                processCreditCardDeposit(amount, transaction);
            } else if (paymentMethod === 'boleto') {
                // Boleto is handled by renderBoletoForm and confirmBoleto
            }
        }
        document.getElementById('confirm-deposit').addEventListener('click', handleDeposit);

        // --- Transaction History (luccabet_transactions_v2) ---
        function getTransactions() {
            const transactions = localStorage.getItem('luccabet_transactions_v2');
            return transactions ? JSON.parse(transactions) : [];
        }

        function saveTransaction(transaction) {
            let transactions = getTransactions();
            const existingIndex = transactions.findIndex(t => t.id === transaction.id);
            if (existingIndex > -1) {
                transactions[existingIndex] = transaction; // Update existing
            } else {
                transactions.push(transaction); // Add new
            }
            localStorage.setItem('luccabet_transactions_v2', JSON.stringify(transactions));
        }

        function getTransactionsForUser(userId) {
            return getTransactions().filter(t => t.userId === userId);
        }

        // --- Credit Card Deposit Logic ---
        function renderCreditCardForm() {
            const cardInfoSection = document.getElementById('cartao-info-section');
            cardInfoSection.innerHTML = `
                <div class="space-y-3">
                    <div>
                        <label for="card-number" class="block text-sm font-medium mb-1">Número do Cartão</label>
                        <input type="text" id="card-number" placeholder="XXXX XXXX XXXX XXXX" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" maxlength="19">
                        <p id="card-number-error" class="text-red-400 text-xs mt-1 hidden">Número do cartão inválido.</p>
                    </div>
                    <div>
                        <label for="card-name" class="block text-sm font-medium mb-1">Nome no Cartão</label>
                        <input type="text" id="card-name" placeholder="Nome Completo" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600">
                        <p id="card-name-error" class="text-red-400 text-xs mt-1 hidden">Nome deve ter no mínimo 5 letras.</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="card-expiry" class="block text-sm font-medium mb-1">Validade (MM/AA)</label>
                            <input type="text" id="card-expiry" placeholder="MM/AA" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" maxlength="5">
                            <p id="card-expiry-error" class="text-red-400 text-xs mt-1 hidden">Data de validade inválida.</p>
                        </div>
                        <div>
                            <label for="card-cvc" class="block text-sm font-medium mb-1">CVC</label>
                            <input type="text" id="card-cvc" placeholder="XXX" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-green-600" maxlength="3">
                            <p id="card-cvc-error" class="text-red-400 text-xs mt-1 hidden">CVC inválido.</p>
                        </div>
                    </div>
                </div>
            `;
            // Add input masks
            document.getElementById('card-number').addEventListener('input', formatCardNumber);
            document.getElementById('card-expiry').addEventListener('input', formatExpiryDate);
        }

        function formatCardNumber(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            e.target.value = value;
        }

        function formatExpiryDate(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        }

        function validateCreditCardForm() {
            let isValid = true;
            const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
            const cardName = document.getElementById('card-name').value.trim();
            const cardExpiry = document.getElementById('card-expiry').value;
            const cardCVC = document.getElementById('card-cvc').value;

            // Clear previous errors
            document.getElementById('card-number-error').classList.add('hidden');
            document.getElementById('card-name-error').classList.add('hidden');
            document.getElementById('card-expiry-error').classList.add('hidden');
            document.getElementById('card-cvc-error').classList.add('hidden');

            // Validate Card Number (Luhn Algorithm)
            if (!luhnCheck(cardNumber) || cardNumber.length !== 16) {
                document.getElementById('card-number-error').classList.remove('hidden');
                isValid = false;
            }

            // Validate Card Name
            if (cardName.length < 5 || !/^[a-zA-Z\s]+$/.test(cardName)) {
                document.getElementById('card-name-error').classList.remove('hidden');
                isValid = false;
            }

            // Validate Expiry Date (MM/AA)
            const [month, year] = cardExpiry.split('/').map(Number);
            const currentYear = new Date().getFullYear() % 100; // Last two digits
            const currentMonth = new Date().getMonth() + 1; // 1-12
            if (!month || !year || month < 1 || month > 12 || year < currentYear || (year === currentYear && month < currentMonth)) {
                document.getElementById('card-expiry-error').classList.remove('hidden');
                isValid = false;
            }

            // Validate CVC
            if (!/^\d{3}$/.test(cardCVC)) {
                document.getElementById('card-cvc-error').classList.remove('hidden');
                isValid = false;
            }

            return isValid;
        }

        function luhnCheck(num) {
            let sum = 0;
            let double = false;
            for (let i = num.length - 1; i >= 0; i--) {
                let digit = parseInt(num.charAt(i), 10);
                if (double) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                sum += digit;
                double = !double;
            }
            return (sum % 10) === 0;
        }

        function processCreditCardDeposit(amount, transaction) {
            if (!validateCreditCardForm()) {
                showNotification('Por favor, corrija os dados do cartão.', 'red');
                return;
            }

            const confirmBtn = document.getElementById('confirm-deposit');
            confirmBtn.disabled = true;
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processando...';

            setTimeout(() => {
                updateUserBalance(currentUser.balance + amount, true);
                showNotification(`Depósito de R$${amount.toFixed(2)} via Cartão de Crédito aprovado!`, 'green');
                transaction.status = 'Aprovado';
                saveTransaction(transaction);
                showReceipt('Depósito - Cartão de Crédito', amount, 'Aprovado', transaction.id);
                document.getElementById('deposit-modal').classList.add('hidden');
                document.getElementById('deposit-amount').value = '';
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            }, 2000);
        }

        // --- Boleto Bancário Logic ---
        function renderBoletoForm() {
            const boletoInfoSection = document.getElementById('boleto-info-section');
            const amount = parseFloat(document.getElementById('deposit-amount').value);

            if (isNaN(amount) || amount < 10) {
                boletoInfoSection.innerHTML = `<p class="text-sm text-center text-red-400">Por favor, insira um valor de depósito válido (mínimo R$10) antes de gerar o boleto.</p>`;
                return;
            }

            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 3); // 3 days from now

            const barcode = generateBoletoBarcode(amount);

            boletoInfoSection.innerHTML = `
                <div class="space-y-3">
                    <h4 class="font-medium mb-2 text-center">Detalhes do Boleto</h4>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Valor:</span>
                        <span class="font-bold text-green-500">R$ ${amount.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Vencimento:</span>
                        <span class="font-bold">${dueDate.toLocaleDateString('pt-BR')}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Banco:</span>
                        <span class="font-bold">Banco LUCCABET S/A</span>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Linha Digitável:</label>
                        <div class="flex items-center justify-between bg-black p-3 rounded">
                            <span id="boleto-barcode" class="font-mono text-sm break-all">${barcode}</span>
                            <button id="copy-boleto-barcode" class="text-green-500 hover:text-green-400 ml-2">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-4">
                        <button id="print-boleto" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            <i class="fas fa-print mr-2"></i>Imprimir
                        </button>
                        <button id="confirm-boleto" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">
                            <i class="fas fa-check-circle mr-2"></i>Confirmar Boleto
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('copy-boleto-barcode').addEventListener('click', () => {
                const barcodeText = document.getElementById('boleto-barcode').textContent;
                navigator.clipboard.writeText(barcodeText);
                const copyBtn = document.getElementById('copy-boleto-barcode');
                const originalIcon = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check text-green-500"></i>';
                setTimeout(() => { copyBtn.innerHTML = originalIcon; }, 2000);
            });

            document.getElementById('print-boleto').addEventListener('click', () => {
                alert('Simulando impressão do boleto...');
                // In a real scenario, you'd open a new window with the boleto HTML/PDF
            });

            document.getElementById('confirm-boleto').addEventListener('click', () => {
                confirmBoleto(amount, barcode, dueDate.toISOString());
            });
        }

        function generateBoletoBarcode(amount) {
            // Simplified realistic-looking barcode generation (47 digits)
            // This is a simulation, not a real valid barcode
            const bankCode = '001'; // Banco do Brasil (example)
            const currencyCode = '9'; // R$
            const dueDateFactor = Math.floor(Math.random() * 9999) + 1000; // Random factor for due date
            const value = String(Math.round(amount * 100)).padStart(10, '0'); // Amount in cents, 10 digits
            const freeField = String(Math.floor(Math.random() * 10**25)).padStart(25, '0'); // 25 random digits

            let barcode = bankCode + currencyCode + dueDateFactor + value + freeField;
            
            // Add a simulated check digit (simple sum modulo 10)
            let sum = 0;
            for (let i = 0; i < barcode.length; i++) {
                sum += parseInt(barcode[i]);
            }
            const checkDigit = sum % 10;
            barcode = barcode.substring(0, 4) + checkDigit + barcode.substring(4); // Insert check digit at position 5

            // Format into 5 blocks for display (47 digits total)
            return `${barcode.substring(0, 5)}.${barcode.substring(5, 10)} ${barcode.substring(10, 21)}.${barcode.substring(21, 32)} ${barcode.substring(32, 43)}.${barcode.substring(43, 47)}`;
        }

        function confirmBoleto(amount, barcode, dueDate) {
            const transaction = {
                id: `TRX${Date.now()}-${Math.floor(Math.random() * 1000)}`,
                userId: currentUser.email,
                amount: amount,
                date: new Date().toISOString(),
                status: 'Aguardando Pagamento',
                type: 'Depósito',
                method: 'Boleto Bancário',
                boletoBarcode: barcode,
                boletoDueDate: dueDate
            };
            saveTransaction(transaction);
            showNotification(`Boleto de R$${amount.toFixed(2)} gerado. Aguardando pagamento.`, 'yellow');
            showReceipt('Depósito - Boleto Bancário', amount, 'Aguardando Pagamento', transaction.id);
            document.getElementById('deposit-modal').classList.add('hidden');
            document.getElementById('deposit-amount').value = '';
        }

        function checkBoletoPayments() {
            if (!currentUser) return;
            let transactions = getTransactions();
            let updated = false;

            transactions.forEach(t => {
                if (t.userId === currentUser.email && t.method === 'Boleto Bancário' && t.status === 'Aguardando Pagamento') {
                    const transactionDate = new Date(t.date);
                    const now = new Date();
                    const diffHours = Math.abs(now - transactionDate) / (1000 * 60 * 60);

                    if (diffHours >= 24) { // Simulate 24 hours for compensation
                        t.status = 'Aprovado';
                        updateUserBalance(currentUser.balance + t.amount, true);
                        showNotification(`Seu boleto de R$${t.amount.toFixed(2)} foi compensado! Saldo creditado.`, 'green');
                        updated = true;
                    }
                }
            });

            if (updated) {
                localStorage.setItem('luccabet_transactions_v2', JSON.stringify(transactions));
            }
        }

        // Withdraw Modal
        document.getElementById('withdraw-btn').addEventListener('click', () => {
            document.getElementById('withdraw-modal').classList.remove('hidden');
            document.getElementById('withdraw-balance-info').textContent = `R$ ${currentUser.balance.toFixed(2)}`;
        });
        document.getElementById('close-withdraw-modal').addEventListener('click', () => {
            document.getElementById('withdraw-modal').classList.add('hidden');
        });
        
        function handleWithdraw() {
            const amountInput = document.getElementById('withdraw-amount');
            const amount = parseFloat(amountInput.value);
            const pixKeyInput = document.getElementById('withdraw-pix-key');
            const pixKey = pixKeyInput.value.trim();

            if (isNaN(amount) || amount < 50) {
                showNotification('O valor mínimo para saque é R$50,00.', 'red');
                return;
            }
            if (!pixKey) {
                showNotification('Por favor, insira uma chave PIX válida.', 'red');
                return;
            }
            if (amount > currentUser.balance) {
                showNotification('Saldo insuficiente para realizar este saque.', 'red');
                return;
            }

            updateUserBalance(currentUser.balance - amount, false);
            
            // NEW: Mark as pending if > 500 or by random chance (simulates processing error)
            const isPending = amount > 500 || Math.random() < 0.1;

            if (isPending) {
                const withdrawalRequest = {
                    id: `wd-${Date.now()}`,
                    userId: currentUser.email,
                    userName: currentUser.fullName,
                    amount: amount,
                    pixKey: pixKey,
                    date: new Date().toISOString(),
                    status: 'Pendente'
                };
                let existingRequests = JSON.parse(localStorage.getItem('luccabet_pending_withdrawals') || '[]');
                existingRequests.push(withdrawalRequest);
                localStorage.setItem('luccabet_pending_withdrawals', JSON.stringify(existingRequests));
                showNotification(`Sua solicitação de saque de R$${amount.toFixed(2)} foi enviada para análise.`, 'yellow');
                showReceipt('Saque (Solicitação)', amount, 'Pendente');
                updatePanelNotifications();
            } else {
                // Simulate automatic approval
                showNotification(`Saque de R$${amount.toFixed(2)} aprovado e enviado para a chave PIX.`, 'green');
                showReceipt('Saque (Automático)', amount, 'Aprovado');
            }


            document.getElementById('withdraw-modal').classList.add('hidden');
            amountInput.value = '';
            pixKeyInput.value = '';
        }
        document.getElementById('confirm-withdraw').addEventListener('click', handleWithdraw);

        // Dice Game Event Listener
        if(document.getElementById('dice-roll')) document.getElementById('dice-roll').addEventListener('click', rollDice);

        const bgMusic = document.getElementById('bg-music');
        const toggleBtn = document.getElementById('toggle-music');

        toggleBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("A reprodução da música foi bloqueada pelo navegador."));
                toggleBtn.innerHTML = 'Música Ligada 🔊';
            } else {
                bgMusic.pause();
                toggleBtn.innerHTML = 'Música Desligada 🎵';
            }
        });
        
        // Auto-play music on first user interaction (if not already playing)
        document.body.addEventListener('click', () => {
            if (!bgMusic.paused && toggleBtn.innerHTML.includes('Ligada')) {
                 bgMusic.play().catch(e => {});
            }
        }, { once: true });

        const receiptModal = document.getElementById('receipt-modal');
        const closeReceiptModal = document.getElementById('close-receipt-modal');
        const closeReceiptBtn = document.getElementById('close-receipt-btn');
        const copyReceiptBtn = document.getElementById('copy-receipt');

        function showReceipt(type, amount, status, transactionId) {
            const now = new Date();
            const dateTime = now.toLocaleString('pt-BR');

            document.getElementById('receipt-type').textContent = type;
            document.getElementById('receipt-amount').textContent = `R$ ${amount.toFixed(2)}`;
            const statusEl = document.getElementById('receipt-status');
            statusEl.textContent = status;
            
            statusEl.className = 'font-bold'; // Reset classes
            if(status === 'Aprovado') statusEl.classList.add('text-green-500');
            else if(status === 'Rejeitado') statusEl.classList.add('text-red-500');
            else statusEl.classList.add('text-yellow-500'); // Pending

            document.getElementById('receipt-datetime').textContent = dateTime;
            document.getElementById('receipt-id').textContent = transactionId;

            // Apply fullscreen style for mobile
            if(window.innerWidth < 640) {
                receiptModal.classList.add('fullscreen-mobile');
            } else {
                receiptModal.classList.remove('fullscreen-mobile');
            }

            receiptModal.classList.remove('hidden');
        }

        function closeReceipt() {
            receiptModal.classList.add('hidden');
        }

        closeReceiptModal.addEventListener('click', closeReceipt);
        closeReceiptBtn.addEventListener('click', closeReceipt);

        copyReceiptBtn.addEventListener('click', () => {
            // Get all text content from receipt items
            const receiptText = Array.from(document.querySelectorAll('#receipt-details .receipt-item')).map(item => item.innerText.replace('\t', ' ')).join('\n');
            navigator.clipboard.writeText(receiptText);
            const originalText = copyReceiptBtn.innerHTML;
            copyReceiptBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Copiado!';
            setTimeout(() => { copyReceiptBtn.innerHTML = originalText; }, 2000);
        });

        document.getElementById('copy-affiliate-link').addEventListener('click', function() {
            const link = document.getElementById('affiliate-user-link').textContent;
            navigator.clipboard.writeText(link);
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check mr-2"></i>Copiado!';
            setTimeout(() => { this.innerHTML = originalText; }, 2000);
        });

        let timeUpdateInterval;
        async function updateUserLocationTime() {
            const locationEl = document.getElementById('user-location-info');
            if(timeUpdateInterval) clearInterval(timeUpdateInterval); // Clear any existing interval
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const locationText = `📍 ${data.city || 'Desconhecida'}, ${data.country_code || 'BR'}`;
                const update = () => { locationEl.textContent = `${locationText} — 🕒 ${new Date().toLocaleTimeString('pt-BR')}`; };
                update(); // Initial update
                timeUpdateInterval = setInterval(update, 1000); // Update every second
            } catch (error) {
                console.error("Erro ao buscar localização:", error);
                const update = () => { locationEl.textContent = `📍 Localização indisponível — 🕒 ${new Date().toLocaleTimeString('pt-BR')}`; };
                update(); // Initial update with fallback
                timeUpdateInterval = setInterval(update, 1000); // Update every second
            }
        }

        const toggleStatsBtn = document.getElementById('toggle-stats-btn');
        const statsPanel = document.getElementById('stats-panel');

        if (toggleStatsBtn && statsPanel) {
            toggleStatsBtn.addEventListener('click', () => {
                statsPanel.classList.toggle('hidden');
            });
        }
        
        // ================================================================== //
        // START: LÓGICA DO NOVO SISTEMA DE PAINEL ADMIN E DONO               //
        // ================================================================== //
        const OWNER_EMAIL = 'prudencioguilherme7@gmail.com';
        const OWNER_NAME = 'Guilherme Prudêncio De Melo';
        
        // NEW: Redeem code logic
        document.getElementById('redeem-code-btn').addEventListener('click', redeemCode);
        
        function redeemCode() {
            const input = document.getElementById('redeem-code-input');
            const messageEl = document.getElementById('redeem-message');
            const code = input.value.trim().toUpperCase();

            if (!code) { 
                messageEl.textContent = 'Por favor, insira um código.';
                messageEl.className = 'p-3 rounded-lg text-sm font-semibold bg-red-800 text-red-300 show';
                setTimeout(() => messageEl.classList.remove('show'), 3000);
                return; 
            }

            const codeIndex = generatedBonusCodes.findIndex(c => c.code === code);
            
            let message = '';
            let messageClass = '';

            if (codeIndex !== -1) {
                const bonus = generatedBonusCodes[codeIndex];
                if (!bonus.used) {
                    updateUserBalance(currentUser.balance + bonus.amount, true);
                    bonus.used = true; // Mark as used
                    localStorage.setItem('luccabet_bonus_codes_v2', JSON.stringify(generatedBonusCodes));
                    
                    message = `✅ Sucesso! R$${bonus.amount.toFixed(2)} foram adicionados ao seu saldo.`;
                    messageClass = 'bg-green-800 text-green-300';
                    showNotification(message, 'green');
                } else {
                    message = '❌ Este código já foi utilizado.';
                    messageClass = 'bg-yellow-800 text-yellow-300';
                }
            } else {
                message = '❌ Código inválido ou expirado.';
                messageClass = 'bg-red-800 text-red-300';
            }
            
            messageEl.textContent = message;
            messageEl.className = `p-3 rounded-lg text-sm font-semibold ${messageClass} show`;
            input.value = '';

            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 4000);
        }

        document.addEventListener('keydown', (e) => {
            if (!currentUser) return;
            
            const isOwner = currentUser.email === OWNER_EMAIL && currentUser.fullName === OWNER_NAME;

            // Shortcut for Owner Panel (Ctrl + Shift + U)
            if (e.ctrlKey && e.shiftKey && e.key === 'U') {
                e.preventDefault();
                if (isOwner) {
                    openOwnerPanel();
                } else {
                    showNotification('🚫 Acesso restrito ao administrador autorizado.', 'red');
                }
            }
            
            // Shortcut for Admin Panel (Ctrl + Shift + A)
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                 if (isOwner) { // Only owner can access both panels
                    openAdminPanel();
                } else {
                    showNotification('🚫 Acesso restrito ao administrador autorizado.', 'red');
                }
            }
        });

        function openOwnerPanel() {
            const loadingScreen = document.getElementById('ceo-loading-screen');
            const ownerPanel = document.getElementById('owner-panel');
            
            loadingScreen.classList.remove('hidden');
            
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                ownerPanel.classList.remove('hidden');
                populateOwnerPanel();
            }, 2000); // Simulate loading time
        }
        
        function openAdminPanel() {
            document.getElementById('admin-panel').classList.remove('hidden');
            populateAdminPanel();
        }

        function populateOwnerPanel() {
            const users = Object.values(usersDB.getUsers());
            const totalBalance = users.reduce((acc, user) => acc + user.balance, 0);
            
            document.getElementById('ceo-total-balance').textContent = `R$ ${totalBalance.toFixed(2)}`;
            document.getElementById('ceo-total-users').textContent = users.length;
            // Simulate online users (random number up to half of total users)
            document.getElementById('ceo-online-users').textContent = Math.floor(Math.random() * (users.length / 2)) + 1; 
            document.getElementById('ceo-profit-7d').textContent = `R$ ${(Math.random() * 5000 + 1000).toFixed(2)}`; // Simulated profit
            document.getElementById('ceo-bet-today').textContent = `R$ ${(Math.random() * 20000 + 5000).toFixed(2)}`; // Simulated bets today
            
            populateWithdrawalsList('ceo-withdrawals-list');
            populateAuditLog();
            updatePanelNotifications();
        }

        function populateAdminPanel() {
             populateWithdrawalsList('admin-withdrawals-list', true); // Pass true for admin table format
             const users = Object.values(usersDB.getUsers());
             const usersListEl = document.getElementById('admin-users-list');
             usersListEl.innerHTML = users.map(user => `
                <tr class="border-b border-gray-800 hover:bg-gray-800">
                    <td class="p-2">${user.fullName}</td>
                    <td class="p-2">${user.email}</td>
                    <td class="p-2 text-green-500">R$ ${user.balance.toFixed(2)}</td>
                </tr>
             `).join('');
             updatePanelNotifications();
        }
        
        function logAdminAction(request, isApproved) {
            let auditLog = JSON.parse(localStorage.getItem('luccabet_audit_log_v2') || '[]');
            const logEntry = {
                admin: currentUser.fullName,
                action: isApproved ? 'APROVADO' : 'REJEITADO',
                targetUser: request.userName,
                amount: request.amount,
                pixLast4: request.pixKey.slice(-4), // Last 4 digits of PIX key
                timestamp: new Date().toISOString(),
                ip: `187.65.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}` // Simulated IP
            };
            auditLog.unshift(logEntry); // Add to the beginning
            localStorage.setItem('luccabet_audit_log_v2', JSON.stringify(auditLog));
        }
        
        function populateAuditLog() {
            const auditLog = JSON.parse(localStorage.getItem('luccabet_audit_log_v2') || '[]');
            const logEl = document.getElementById('ceo-audit-log');
            if (auditLog.length === 0) {
                 logEl.innerHTML = `<p class="text-gray-500">Nenhuma ação registrada.</p>`;
                 return;
            }
            logEl.innerHTML = auditLog.map(log => {
                const actionClass = log.action === 'APROVADO' ? 'text-green-400' : 'text-red-400';
                return `
                    <div class="bg-gray-900 p-2 rounded">
                        <p><span class="font-bold ${actionClass}">${log.action}</span> por ${log.admin}</p>
                        <p class="text-gray-400">R$${log.amount.toFixed(2)} para ${log.targetUser} (PIX ...${log.pixLast4})</p>
                        <p class="text-gray-500">${new Date(log.timestamp).toLocaleString('pt-BR')} - IP: ${log.ip}</p>
                    </div>
                `
            }).join('');
        }

        function handleWithdrawal(withdrawalId, isApproved) {
            let withdrawals = JSON.parse(localStorage.getItem('luccabet_pending_withdrawals') || '[]');
            const request = withdrawals.find(w => w.id === withdrawalId);
            if (!request) return;

            logAdminAction(request, isApproved); // Log the action

            if (isApproved) {
                showNotification(`Saque de R$${request.amount.toFixed(2)} para ${request.userName} APROVADO.`, 'green');
                 // In a real scenario, this would trigger the payment API. Here, we just log it.
            } else {
                // Return balance to user
                const user = usersDB.findUser(request.userId);
                if(user) {
                    const newBalance = user.balance + request.amount;
                    usersDB.updateUser(user.email, { balance: newBalance });
                     // If the rejected withdrawal belongs to the current user, update their UI
                    if(currentUser && currentUser.email === user.email) {
                        updateUserBalance(newBalance, null); // Update UI without win/loss animation
                    }
                }
                showNotification(`Saque de R$${request.amount.toFixed(2)} para ${request.userName} REJEITADO. Saldo estornado.`, 'red');
            }

            // Remove from pending list
            const updatedWithdrawals = withdrawals.filter(w => w.id !== withdrawalId);
            localStorage.setItem('luccabet_pending_withdrawals', JSON.stringify(updatedWithdrawals));

            // Refresh panels
            if (!document.getElementById('owner-panel').classList.contains('hidden')) populateOwnerPanel();
            if (!document.getElementById('admin-panel').classList.contains('hidden')) populateAdminPanel();
        }
        
        // Function to open balance adjustment modal for CEO
        function ceo_openBalanceModal(action) {
            const title = action === 'add' ? 'Injetar Saldo' : 'Remover Saldo';
            const buttonText = action === 'add' ? 'Adicionar' : 'Remover';
            const buttonClass = action === 'add' ? 'bg-green-600' : 'bg-red-600';

            // Remove any existing modal to prevent duplicates
            let panel = document.getElementById('ceo-balance-modal');
            if(panel) panel.remove();

            const overlay = document.createElement("div");
            overlay.id = 'ceo-balance-modal';
            overlay.className = "fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[101]";
            overlay.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">${title}</h3>
                        <button onclick="this.closest('#ceo-balance-modal').remove()" class="text-gray-400 hover:text-white">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm mb-1">Usuário (E-mail)</label>
                            <input type="text" id="ceo-target-user" placeholder="Digite o E-mail" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded" />
                        </div>
                        <div>
                            <label class="block text-sm mb-1">Valor (R$)</label>
                            <input id="ceo-amount" type="number" min="1" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded" />
                        </div>
                        <button onclick="ceo_executeBalanceAction('${action}')" class="w-full ${buttonClass} text-white font-bold py-2 px-4 rounded">
                            ${buttonText}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // Function to execute balance adjustment for CEO
        function ceo_executeBalanceAction(action) {
            const identifier = document.getElementById('ceo-target-user').value;
            const value = parseFloat(document.getElementById('ceo-amount').value);
            if (!identifier || isNaN(value) || value <= 0) {
                showNotification("Identificador ou valor inválido.", "red"); return;
            }
            const target = usersDB.findUser(identifier);
            if (!target) {
                showNotification("Usuário não encontrado.", "red"); return;
            }
            
            const newBalance = action === 'add' ? target.balance + value : target.balance - value;
            if (newBalance < 0) {
                 showNotification("A remoção deixaria o saldo do usuário negativo.", "red"); return;
            }

            usersDB.updateUser(target.email, { balance: newBalance });
            showNotification(`Operação concluída para ${target.fullName}. Novo saldo: R$${newBalance.toFixed(2)}`, "green");
            
            // If the balance of the currently logged-in user is changed, update their UI
            if (currentUser.email === target.email) {
                updateUserBalance(newBalance, action === 'add');
            }
            document.getElementById('ceo-balance-modal').remove(); // Close modal
            populateOwnerPanel(); // Refresh owner panel stats
        }

        // Function to generate a bonus code for CEO
        function ceo_generateBonus() {
            const amountInput = document.getElementById('ceo-bonus-amount');
            const amount = parseFloat(amountInput.value);
            if(isNaN(amount) || amount <= 0) {
                showNotification("Insira um valor de bônus válido.", "red"); return;
            }
            // Generate a simple unique code
            const code = `LUCCAMAX${Math.floor(Math.random() * 900) + 100}`;
            
            generatedBonusCodes.push({ code: code, amount: amount, used: false });
            localStorage.setItem('luccabet_bonus_codes_v2', JSON.stringify(generatedBonusCodes));
            
            document.getElementById('ceo-bonus-result').innerHTML = `Código: <span class="text-green-400">${code}</span> | Valor: R$${amount.toFixed(2)}`;
            showNotification(`Código ${code} de R$${amount.toFixed(2)} criado!`, "green");
            amountInput.value = ''; // Clear input
        }

        // Function to update notification badges for pending withdrawals
        function updatePanelNotifications() {
            const withdrawals = JSON.parse(localStorage.getItem('luccabet_pending_withdrawals') || '[]');
            const count = withdrawals.length;
            const badgeCEO = document.getElementById('ceo-notification-badge');
            const badgeAdmin = document.getElementById('admin-notification-badge');
            
            [badgeCEO, badgeAdmin].forEach(badge => {
                if (badge) {
                     if (count > 0) {
                        badge.textContent = count;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            });
        }

        // Event listeners for notification bells to scroll to pending withdrawals
        document.getElementById('ceo-notification-bell').addEventListener('click', () => {
            document.getElementById('ceo-withdrawals-title').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('notification-sound').play(); // Play sound
        });
        document.getElementById('admin-notification-bell').addEventListener('click', () => {
            document.getElementById('admin-withdrawals-title').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('notification-sound').play(); // Play sound
        });
        // ================================================================== //
        // END: LÓGICA DO NOVO SISTEMA DE PAINEL ADMIN E DONO                 //
        // ================================================================== //

        // ================================================================== //
        // START: LÓGICA DE HISTÓRICO E CONFIGURAÇÕES DE PERFIL               //
        // ================================================================== //

        // Bet History Modal
        const betHistoryModal = document.getElementById('bet-history-modal');
        const closeHistoryModalBtn = document.getElementById('close-history-modal');
        const betHistoryList = document.getElementById('bet-history-list');
        const clearHistoryBtn = document.getElementById('clear-history-btn');

        historyLink.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('user-menu').classList.add('hidden'); // Hide dropdown
            showBetHistory();
        });

        closeHistoryModalBtn.addEventListener('click', () => {
            betHistoryModal.classList.add('hidden');
        });

        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Tem certeza que deseja limpar todo o histórico de apostas?')) {
                currentUser.betHistory = [];
                usersDB.updateUser(currentUser.email, { betHistory: [] });
                showBetHistory(); // Refresh the list
                showNotification('Histórico de apostas limpo.', 'green');
            }
        });

        function showBetHistory() {
            if (!currentUser || !currentUser.betHistory) {
                betHistoryList.innerHTML = '<tr><td colspan="4" class="px-4 py-2 text-center text-gray-500">Nenhum histórico de apostas encontrado.</td></tr>';
                betHistoryModal.classList.remove('hidden');
                return;
            }

            // Combine bet history and transaction history
            let combinedHistory = [...currentUser.betHistory];
            const userTransactions = getTransactionsForUser(currentUser.email);
            userTransactions.forEach(t => {
                combinedHistory.push({
                    date: new Date(t.date).toLocaleString('pt-BR'),
                    game: `Depósito (${t.method})`,
                    bet: `R$ ${t.amount.toFixed(2)}`,
                    result: t.status,
                    winLoss: `+R$ ${t.amount.toFixed(2)}` // For deposits, winLoss is the amount
                });
            });

            // Sort by date descending
            combinedHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (combinedHistory.length === 0) {
                betHistoryList.innerHTML = '<tr><td colspan="4" class="px-4 py-2 text-center text-gray-500">Nenhum histórico de apostas ou transações encontrado.</td></tr>';
            } else {
                betHistoryList.innerHTML = combinedHistory.map(entry => {
                    let statusClass = '';
                    if (entry.result === 'Aprovado' || entry.result === 'Vitória') {
                        statusClass = 'text-green-500';
                    } else if (entry.result === 'Perdeu' || entry.result === 'Rejeitado') {
                        statusClass = 'text-red-500';
                    } else if (entry.result === 'Aguardando Pagamento' || entry.result === 'Pendente') {
                        statusClass = 'text-yellow-500';
                    } else {
                        statusClass = 'text-gray-400';
                    }

                    return `
                        <tr class="border-b border-gray-700 hover:bg-gray-800">
                            <td class="px-4 py-2">${entry.date}</td>
                            <td class="px-4 py-2">${entry.game}</td>
                            <td class="px-4 py-2">${entry.bet}</td>
                            <td class="px-4 py-2 ${statusClass}">${entry.result} (${entry.winLoss})</td>
                        </tr>
                    `;
                }).join('');
            }
            betHistoryModal.classList.remove('hidden');
        }

        // Profile Settings Modal
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsModalBtn = document.getElementById('close-settings-modal');
        const profileUsernameInput = document.getElementById('profile-username');
        const avatarOptionsContainer = document.getElementById('avatar-options');
        const saveProfileChangesBtn = document.getElementById('save-profile-changes');

        const availableAvatars = [
            '💸', '😎', '🚀', '💎', '👑', '🍀', '🎲', '💰', '🏆', '🌟',
            '🐶', '🐱', '🦊', '🐻', '🐼', '🐯', '🦁', '🦄', '🐉', '🤖',
            '🧑‍💻', '👩‍💻', '👨‍🎤', '👩‍🎤', '🕵️', '🥷', '🧙', '🧚', '👽', '👾'
        ];
        let selectedAvatar = currentUser ? currentUser.profileAvatar : '💸'; // Default or current

        settingsLink.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('user-menu').classList.add('hidden'); // Hide dropdown
            showSettingsModal();
        });

        closeSettingsModalBtn.addEventListener('click', () => {
            settingsModal.classList.add('hidden');
        });

        saveProfileChangesBtn.addEventListener('click', saveProfileChanges);

        function showSettingsModal() {
            if (!currentUser) return;

            profileUsernameInput.value = currentUser.username;
            renderAvatarOptions();
            settingsModal.classList.remove('hidden');
        }

        function renderAvatarOptions() {
            avatarOptionsContainer.innerHTML = '';
            availableAvatars.forEach(avatar => {
                const div = document.createElement('div');
                div.className = `avatar-option w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center text-2xl cursor-pointer ${selectedAvatar === avatar ? 'selected' : ''}`;
                div.textContent = avatar;
                div.dataset.avatar = avatar;
                div.addEventListener('click', () => {
                    selectedAvatar = avatar;
                    renderAvatarOptions(); // Re-render to update selection highlight
                });
                avatarOptionsContainer.appendChild(div);
            });
        }

        function saveProfileChanges() {
            if (!currentUser) return;

            const newUsername = profileUsernameInput.value.trim();
            if (newUsername && newUsername !== currentUser.username) {
                currentUser.username = newUsername;
            }
            if (selectedAvatar !== currentUser.profileAvatar) {
                currentUser.profileAvatar = selectedAvatar;
            }

            usersDB.updateUser(currentUser.email, { 
                username: currentUser.username, 
                profileAvatar: currentUser.profileAvatar 
            });
            updateProfileUI(); // Update header and welcome section
            showNotification('Configurações de perfil salvas!', 'green');
            settingsModal.classList.add('hidden');
        }

        function updateProfileUI() {
            if (currentUser) {
                document.getElementById('user-menu-btn').textContent = currentUser.profileAvatar;
                welcomeUsername.textContent = currentUser.username;
            }
        }

        // Call updateProfileUI on initial load to set the correct avatar and username
        document.addEventListener('DOMContentLoaded', () => {
            if (currentUser) {
                updateProfileUI();
            }
        });

        // ================================================================== //
        // END: LÓGICA DE HISTÓRICO E CONFIGURAÇÕES DE PERFIL                 //
        // ================================================================== //
    </script>
</body>
</html>
